<!DOCTYPE html><html lang="pl"><head><meta charSet="utf-8"/><link rel="prefetch" href="https://allegrotechio.disqus.com/count.js"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="description" content="Allegro Tech to miejsce, w którym nasi inżynierowie dzielą się wiedzą oraz case study z wybranych projektów w firmie - w formie artykułów, podcastów oraz eventów."/><title>Allegro Tech</title><meta property="og:site_name" content="allegro.tech"/><meta property="og:title" content="allegro.tech"/><meta property="og:url" content="https://allegro.tech"/><meta property="og:type" content="site"/><meta property="og:image" content="https://allegro.tech/images/allegro-tech.png"/><link rel="shortcut icon" href="favicon.ico"/><link rel="canonical" href="https://allegro.tech" itemProp="url"/><link rel="preload" href="images/splash.jpg" as="image"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-1M1FJ5PXWW"></script><script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){dataLayer.push(arguments);}
                    gtag('js', new Date());
                    gtag('config', 'G-1M1FJ5PXWW');
                </script><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/b2014360ddad0b69a0c7.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b2014360ddad0b69a0c7.css" data-n-g=""/><link rel="preload" href="/_next/static/css/783ec9185bf5f4461a30.css" as="style"/><link rel="stylesheet" href="/_next/static/css/783ec9185bf5f4461a30.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-23f4f2620a057c84f895.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.b1290caeda235fc7bf40.js" as="script"/><link rel="preload" href="/_next/static/chunks/b651a894a35ea1e7d121ee74b6c7e8aa31faf049.71d68ec00d361c7548dd.js" as="script"/><link rel="preload" href="/_next/static/chunks/6753331a3a54fd35bc7d92cbaee2b67e833d028a.8bec33551a885abbb7ba.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-3ea8ca3d27590bc99614.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/index-93b51828b776106500ba.js" as="script"/></head><body><div id="__next"><header class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card Header_navbar__2vWRp m-color-bg_card"><nav class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-display-flex m-flex-justify-between m-flex-items-center"><a href="/"><img src="images/logo.svg" alt="Allegro Tech" width="205" height="45"/></a><div><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0 m-display-flex@lg m-display-none"><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://blog.allegro.tech">Blog</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://podcast.allegro.tech">Podcast</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://github.com/Allegro">Open Source</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://www.meetup.com/allegrotech/events">Wydarzenia</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://praca.allegro.pl">Praca</a></li></ul><button class="m-display-none@lg m-height_40 m-line-height_40 m-border-style-top_none m-border-style-right_none m-border-style-bottom_none m-border-style-left_none m-border-radius-top-left_2 m-border-radius-top-right_2 m-border-radius-bottom-left_2 m-border-radius-bottom-right_2 m-cursor_pointer m-overflow_hidden m-appearance_none m-padding-left_4 m-padding-right_4 m-padding-top_4 m-padding-bottom_4 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button" style="background:transparent" aria-label="Otwórz menu"><img src="https://assets.allegrostatic.com/metrum/icon/menu-23e046bf68.svg" alt="" class="m-icon" width="32" height="32"/></button></div></nav></header><div class="Header_hero__n5PN5"><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-display-flex m-flex-column m-flex-justify-end Header_image__15JNc"><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-color-bg_desk"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text  m-font-weight_100 m-font-size_32 m-font-size_43_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125">O nas</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">Allegro to jedna z najbardziej zaawansowanych technologicznie firm w naszej części Europy. Allegro to również ponad 1000 specjalistów IT, różnych specjalizacji, rozwijających nasz serwis. Unikatowa skala i złożoność problemów, które rozwiązujemy na co dzień, dają nam możliwość rozwoju przy bardzo różnorodnych projektach. Allegro Tech to miejsce, w którym nasi inżynierowie dzielą się wiedzą oraz case study z wybranych projektów w firmie – w formie artykułów, podcastów oraz eventów.</p></div></div></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Blog</h2><div class="m-display_flex m-flex-wrap_1 m-flex-grow_1 m-grid"><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2021/02/oauth-stateless-login.html" title="Implement stateless authentication like a pro using OAuth: A 100% correct approach"><img width="388" src="images/post-headers/default.png" alt="Implement stateless authentication like a pro using OAuth: A 100% correct approach" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2021/02/oauth-stateless-login.html" title="Implement stateless authentication like a pro using OAuth: A 100% correct approach" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Implement stateless authentication like a pro using OAuth: A 100% correct approach</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">12 dni temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/tech">#<!-- -->tech</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/security">#<!-- -->security</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/oauth">#<!-- -->oauth</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/authentication">#<!-- -->authentication</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/authorization">#<!-- -->authorization</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/jwt">#<!-- -->jwt</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/openid-connect">#<!-- -->openid-connect</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">Many of us spend most of their software development careers improving and extending applications protected by pre-existing security mechanisms. That’s why
we rarely address problems related…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__1CeVw"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Karol Kuc" src="https://blog.allegro.tech/img/authors/karol.kuc.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/karol.kuc">Karol Kuc</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2021/02/oauth-stateless-login.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2021/02/oauth-stateless-login.html">przejdź do wpisu</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2021/01/impact-of-the-data-model-on-the-MongoDB-database-size.html" title="Impact of data model on MongoDB database size"><img width="388" src="images/post-headers/mongodb.png" alt="Impact of data model on MongoDB database size" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2021/01/impact-of-the-data-model-on-the-MongoDB-database-size.html" title="Impact of data model on MongoDB database size" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Impact of data model on MongoDB database size</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">30 dni temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/mongodb">#<!-- -->mongodb</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">So I was tuning one of our services in order to speed up some MongoDB queries. Incidentally, my attention was caught by
the size of one…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__1CeVw"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Michał Knasiecki" src="https://blog.allegro.tech/img/authors/michal.knasiecki.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/michal.knasiecki">Michał Knasiecki</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2021/01/impact-of-the-data-model-on-the-MongoDB-database-size.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2021/01/impact-of-the-data-model-on-the-MongoDB-database-size.html">przejdź do wpisu</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2020/12/speeding-up-warm-builds.html" title="Speeding up warm builds in Xcode"><img width="388" src="images/post-headers/xcode.png" alt="Speeding up warm builds in Xcode" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2020/12/speeding-up-warm-builds.html" title="Speeding up warm builds in Xcode" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Speeding up warm builds in Xcode</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">około 2 miesiące temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/ios">#<!-- -->ios</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/xcode">#<!-- -->xcode</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/swift">#<!-- -->swift</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/objectivec">#<!-- -->objectivec</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">Programmers who have ever developed software for Apple platforms in the early days of Swift language might remember ridiculous
times it took to compile the whole…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__1CeVw"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Maciej Piotrowski" src="https://blog.allegro.tech/img/authors/maciej.piotrowski.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/maciej.piotrowski">Maciej Piotrowski</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2020/12/speeding-up-warm-builds.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2020/12/speeding-up-warm-builds.html">przejdź do wpisu</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2020/12/speeding-up-ios-builds-with-bazel.html" title="Speeding up iOS builds with Bazel"><img width="388" src="images/post-headers/bazel.png" alt="Speeding up iOS builds with Bazel" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2020/12/speeding-up-ios-builds-with-bazel.html" title="Speeding up iOS builds with Bazel" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Speeding up iOS builds with Bazel</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">około 2 miesiące temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/ios">#<!-- -->ios</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/bazel">#<!-- -->bazel</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">When we developed our Allegro iOS app adding new features and with more people contributing to the codebase, we noticed
that build times began to grow.…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__1CeVw"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Kamil Pyć" src="https://blog.allegro.tech/img/authors/kamil.pyc.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/kamil.pyc">Kamil Pyć</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2020/12/speeding-up-ios-builds-with-bazel.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2020/12/speeding-up-ios-builds-with-bazel.html">przejdź do wpisu</a></div></article></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech">Zobacz więcej wpisów</a></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Podcasty</h2><div class="m-display_flex m-flex-wrap_1 m-flex-grow_1 m-grid"><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/zbiory_danych_w_allegro" title="Zbiory danych w Allegro"><img src="images/podcast.png" alt="Zbiory danych w Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/zbiory_danych_w_allegro" title="Zbiory danych w Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Zbiory danych w Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">3 dni temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Czym zajmuje się inżynier danych? Jak powstało Big Data? Jak wykorzystuje się oraz kto korzysta z nowych zbiorów danych? Czym różni się Data Scientist od Data Engineera? Jak połączyć przetwarzanie streamingowe z przetwarzaniem batchowym? Z jakich narzędzi korzysta Data Engineer? Na te pytania odpowie Łukasz Ściga - Data Engineer w Allegro, którego pasją jest programowanie gier komputerowych.</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/zbiory_danych_w_allegro">Posłuchaj odcinka</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/badania_i_rozwoj_ml_w_allegro" title="Badania i rozwój ML w Allegro"><img src="images/podcast.png" alt="Badania i rozwój ML w Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/badania_i_rozwoj_ml_w_allegro" title="Badania i rozwój ML w Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Badania i rozwój ML w Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">8 miesięcy temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Gdzie kryje się Machine Learning w Allegro? Jakie projekty już dzisiaj korzystają z mocy sztucznej inteligencji? Jak na codzień pracuje grupa badaczy nie tylko aplikująca, ale też rozwijająca algorytmy uczenia maszynowego? Irek, Team Manager w grupie Allegro ML Research, opowiada więcej o tym jak się tworzy AI w Polsce.</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/badania_i_rozwoj_ml_w_allegro">Posłuchaj odcinka</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/projektowanie_ux_w_allegro" title="Projektowanie UX w Allegro, czyli wszystko zależy od doświadczenia"><img src="images/podcast.png" alt="Projektowanie UX w Allegro, czyli wszystko zależy od doświadczenia" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/projektowanie_ux_w_allegro" title="Projektowanie UX w Allegro, czyli wszystko zależy od doświadczenia" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Projektowanie UX w Allegro, czyli wszystko zależy od doświadczenia</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">8 miesięcy temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Projektowanie na styku produktu, biznesu i potrzeb użytkownika. Budzenie ciekawości, czyli czy jesteś w stanie zmienić coś, co sprawia problem tak wielu osobom na raz? Kasia opowiada o &quot;układaniu klocków&quot;, których użytkownik wie jak użyć.</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/projektowanie_ux_w_allegro">Posłuchaj odcinka</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/mobile_w_allegro" title="Mobile w Allegro"><img src="images/podcast.png" alt="Mobile w Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/mobile_w_allegro" title="Mobile w Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Mobile w Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">9 miesięcy temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Cały świat obserwuje jak telefony przejmują władzę nad Internetem. Ponad połowa ruchu na Allegro pochodzi z urządzeń mobilnych, a większość tego ruchu to aplikacje natywne. Żarty się skończyły ;) Kamil opowie Wam jak specjaliści mobilni z Allegro skalują development swojej aplikacji.</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/mobile_w_allegro">Posłuchaj odcinka</a></div></article></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech">Zobacz więcej podcastów</a></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Wydarzenia</h2><div class="m-display_flex m-flex-wrap_1 m-flex-grow_1 m-grid"><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/272249143/" title="Allegro Tech Talks #13 - Cyfrodziewczyny" class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="Allegro Tech Talks #13 - Cyfrodziewczyny"/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/272249143/" title="Allegro Tech Talks #13 - Cyfrodziewczyny" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Allegro Tech Talks #13 - Cyfrodziewczyny</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">6 miesięcy temu<!-- -->, <!-- -->Online event</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">Allegro Tech Live to nowa (w 100% zdalna) odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale tym razem to…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/272249143/">Szczegóły</a></article></div></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/271624844/" title="Allegro Tech Live #12 - Wszystko o licencjach Open Source" class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="Allegro Tech Live #12 - Wszystko o licencjach Open Source"/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/271624844/" title="Allegro Tech Live #12 - Wszystko o licencjach Open Source" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Allegro Tech Live #12 - Wszystko o licencjach Open Source</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">8 miesięcy temu<!-- -->, <!-- -->Online event</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">Allegro Tech Live to nowa (w 100% zdalna) odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale tym razem to…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/271624844/">Szczegóły</a></article></div></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/271396824/" title="Allegro Tech Live #11" class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="Allegro Tech Live #11"/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/271396824/" title="Allegro Tech Live #11" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Allegro Tech Live #11</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">8 miesięcy temu<!-- -->, <!-- -->Online event</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">Allegro Tech Live to nowa (w 100% zdalna) odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale tym razem to…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/271396824/">Szczegóły</a></article></div></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/271201706/" title="Allegro Tech Live #10 - ML" class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="Allegro Tech Live #10 - ML"/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/271201706/" title="Allegro Tech Live #10 - ML" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Allegro Tech Live #10 - ML</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">8 miesięcy temu<!-- -->, <!-- -->Online event</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">Allegro Tech Live to nowa (w 100% zdalna) odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale tym razem to…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/271201706/">Szczegóły</a></article></div></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/">Zobacz więcej wydarzeń</a></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Oferty pracy</h2><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto"><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Front-End Software Engineer</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Poznań, Warszawa</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999734961589-front-end-software-engineer?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Product Manager (Produktyzacja)</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Toruń, Poznań, Warszawa</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999734708244-product-manager-produktyzacja?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Data Analyst (UX &amp; Conversion)</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Poznań</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999734575802-data-analyst-ux-conversion?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">IT Security Specialist</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Poznań, Toruń</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999734423003-it-security-specialist?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Team Leader - Technology</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Poznań</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999734285388-team-leader-technology?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://allegro.pl/praca">Zobacz więcej ofert</a></div><footer class="m-color-bg_navy m-margin-top-32"><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24 m-padding-bottom-24 m-display-flex@sm m-flex-justify-between m-flex-items-center m-text-align_center"><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-color_white m-padding-left-24@sm">Proudly built by Allegro Tech engineers</p><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0 m-display-flex m-flex-justify-center"><li style="filter:brightness(0) invert(1);opacity:0.5" class="m-margin-right-8 m-margin-top-16 m-margin-top-0@sm m-color_white"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://github.com/allegro"><img src="https://assets.allegrostatic.com/metrum/icon/github-6a18df1729.svg" alt="Github" class="m-icon"/></a></li><li style="filter:brightness(0) invert(1);opacity:0.5" class="m-margin-right-8 m-margin-top-16 m-margin-top-0@sm m-color_white"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://www.facebook.com/allegro.tech/"><img src="https://assets.allegrostatic.com/metrum/icon/facebook-a2b92f9dcb.svg" alt="Facebook" class="m-icon"/></a></li><li style="filter:brightness(0) invert(1);opacity:0.5" class="m-margin-right-8 m-margin-top-16 m-margin-top-0@sm m-color_white"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/allegrotech"><img src="https://assets.allegrostatic.com/metrum/icon/twitter-25164a58aa.svg" alt="Twitter" class="m-icon"/></a></li></ul></div></footer><div style="visibility:hidden;height:0;overflow:hidden;position:relative"><img alt="doubleclick" width="1" height="1" style="position:absolute" src="https://pubads.g.doubleclick.net/activity;dc_iu=/21612525419/DFPAudiencePixel;ord=3876449427675.5522;dc_seg=507368552?"/><img alt="fb" height="1" width="1" style="position:absolute" src="https://www.facebook.com/tr?id=1650870088530325&amp;ev=PageView&amp;noscript=1"/></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"title":"Implement stateless authentication like a pro using OAuth: A 100% correct approach","link":"https://blog.allegro.tech/2021/02/oauth-stateless-login.html","pubDate":"Mon, 01 Feb 2021 00:00:00 +0100","authors":{"author":[{"name":["Karol Kuc"],"photo":["https://blog.allegro.tech/img/authors/karol.kuc.jpg"],"url":["https://blog.allegro.tech/authors/karol.kuc"]}]},"content":"\u003cp\u003eMany of us spend most of their software development careers improving and extending applications protected by pre-existing security mechanisms. That’s why\nwe rarely address problems related directly to authentication and authorization unless we build apps from scratch.\nRegardless of your experience I still hope you will find this article interesting.\nIt’s not meant to be a tutorial. I would like to focus on clarifying basic concepts and highlighting common misconceptions.\u003c/p\u003e\n\n\u003ch4 id=\"alpha-disclaimer\"\u003eAlpha disclaimer:\u003c/h4\u003e\n\u003cp\u003eSorry to disappoint you, but the title of this article is just a cheap click-bait.\nIt doesn’t matter whether you started reading because you disagree with\nthe title or because you hoped to find the holy grail\nof securing web applications. There is a chance you will find something for yourself anyway.\u003c/p\u003e\n\n\u003ch4 id=\"beta-disclaimer\"\u003eBeta disclaimer:\u003c/h4\u003e\n\u003cp\u003eThis post is not meant to answer the “how does the login with Facebook work“ question.\nWe will spend some time on it, but just to provoke a discussion, not to go through a tutorial.\u003c/p\u003e\n\n\u003ch4 id=\"gamma-disclaimer\"\u003eGamma disclaimer:\u003c/h4\u003e\n\u003cp\u003eI have never built a full-fledged auth process from scratch myself in a commercial web app.\nI’m no security expert, so you read at your own risk.\u003c/p\u003e\n\n\u003ch2 id=\"authentication-vs-authorization\"\u003eAuthentication vs Authorization\u003c/h2\u003e\n\u003cp\u003eWow! If you are still reading, cool!\nLet’s start with a short recap on these two basic concepts. Authentication is about verifying \u003cstrong\u003ewho you are\u003c/strong\u003e.\nYou need to prove your identity, that’s all. You may authenticate, for example, by using a password or your fingerprint.\nYou may need to use a token (hard or soft), an authentication-app-generated code or a text message sent to your phone number.\nI hope you tend to use at least two of these. Anyway, once you’ve done it, you are in.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-02-01-oauth-stateless-login/password.png\" alt=\"Say the password and enter\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eAuthorization is about verifying \u003cem\u003ewhat you are allowed to do\u003c/em\u003e. I’m not going to copy-paste bookish definitions here. For example, when entering a university library, you authenticate by presenting your ID.\nThe librarian checks the authenticity of the document and analyzes whether you are the one on the photograph or not.\nThe authorization process starts right away.\nTo keep things simple, the librarian checks, based on your confirmed identity, whether you are a professor or a student. This implies which books you can borrow and how many you can take home.\nThis is where the privileges or permissions come into play.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-02-01-oauth-stateless-login/authorization.jpeg\" alt=\"But only if you are a friend\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eIf you are already bored with the most obvious meme I could use, let me give you another obvious example of authorization.\nWhen entering a military zone, you also present your ID for authentication. You can’t get in unless you ARE, e.g. a military officer. It’s not the authentication that failed then.\nThe guardian knows who you are now.\nYou are forbidden to enter as you have not been granted such an authority.\u003c/p\u003e\n\n\u003cp\u003eOne last meme, I promise.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-02-01-oauth-stateless-login/authority_not_granted.png\" alt=\"Authority is not granted to you\" /\u003e\u003c/p\u003e\n\n\u003ch2 id=\"oauth-20-why-is-it-not-about-authenticating-the-user\"\u003eOAuth 2.0: why is it not about authenticating the user?\u003c/h2\u003e\n\n\u003cp\u003eI started with the above trivia because the concepts of authorization and authentication are mingled so often that, even when you know them, you may still get a headache\nwhen reading about OAuth (from now on, I will omit the 2.0 specification version).\u003c/p\u003e\n\n\u003cp\u003eWhat is OAuth? I hate copy-pasting definitions from official docs and other blogs. What I hate even more is copy-pasting them, rephrasing and selling as my own.\nSo, unless you already did, please stop reading and check out the \u003ca href=\"https://tools.ietf.org/html/rfc6749\"\u003edocs\u003c/a\u003e, \u003ca href=\"https://oauth.net/2/\"\u003ethis website\u003c/a\u003e and then \u003ca href=\"https://auth0.com/docs/protocols/protocol-oauth2\"\u003ethe auth0 website\u003c/a\u003e. If you liked the latter, you may also check out \u003ca href=\"https://auth0.com/blog/\"\u003etheir blog\u003c/a\u003e in general.\nI assume you’ve read the suggested docs so I will move on to using the traditional OAuth lingo (grants, flows, resources, third-party servers etc).\u003c/p\u003e\n\n\u003ch3 id=\"oauth-flows-revisited\"\u003eOAuth flows revisited\u003c/h3\u003e\n\u003cp\u003eThe OAuth specification describes this framework as available in \u003ca href=\"https://tools.ietf.org/html/rfc6749#section-1.3\"\u003efour flavours\u003c/a\u003e:\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003eAuthorization Code\u003c/li\u003e\n  \u003cli\u003eImplicit\u003c/li\u003e\n  \u003cli\u003eResource Owner Credentials\u003c/li\u003e\n  \u003cli\u003eClient Credentials\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eSo 2012.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-02-01-oauth-stateless-login/i-built-a-time-machine-to-travel-through-time.jpg\" alt=\"Ten years later\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eThe \u003ca href=\"https://auth0.com/docs/flows/resource-owner-password-flow\"\u003eResource Owner Credentials\u003c/a\u003e (User Credentials) flow is already legacy and \u003ca href=\"https://tools.ietf.org/html/draft-ietf-oauth-security-topics-13#section-3.4\"\u003eofficially banned by IETF\u003c/a\u003e.\n    The latest OAuth 2.0 Security Best Current Practice disallows the password grant entirely.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://oauth.net/2/grant-types/password/\"\u003eSource\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThe same applies to the \u003ca href=\"https://oauth.net/2/grant-types/implicit/\"\u003eImplicit\u003c/a\u003e flow, also discouraged in its \u003ca href=\"https://tools.ietf.org/html/rfc6749#section-1.3.2\"\u003eoriginal form\u003c/a\u003e.\nSome experts analyze whether it is already \u003ca href=\"https://developer.okta.com/blog/2019/05/01/is-the-oauth-implicit-flow-dead\"\u003edead\u003c/a\u003e or not.\nIn the following two \u003cem\u003e“login with..“\u003c/em\u003e examples you should understand OAuth as limited to the \u003ca href=\"https://auth0.com/docs/flows/authorization-code-flow\"\u003eAuthorization Code\u003c/a\u003e grant. The \u003ca href=\"https://auth0.com/docs/flows/client-credentials-flow\"\u003eClient Credentials\u003c/a\u003e grant is a completely different story, handled\nin a further part of the article.\u003c/p\u003e\n\n\u003ch3 id=\"its-hello-world-time\"\u003eIt’s \u003cstrong\u003eHello World\u003c/strong\u003e Time\u003c/h3\u003e\n\u003cp\u003eI prefer to think of OAuth as a set of guidelines and best practices that help you solve a common problem related to authorization, as opposed to a strict framework or protocol.\nThis common problem may be for instance the following. Damn, how the hell did these guys implement the cool \u003cem\u003elog in with Facebook\u003c/em\u003e feature in their app (not so cool anymore, let’s be honest it’s 2021 not 2015).\nLet’s call this app fb64.com .\nTo be precise, how did those guys use the Facebook API to delegate the process of asking the user whether or not fb64.com can access some of their Facebook account data?\nYou may find an analogous scenario described in virtually EVERY SINGLE blog post referring to OAuth, but there is a good reason why I do it here too. I use it because it sucks and introduces misunderstandigs regarding real-life\n\u003cstrong\u003edelegated authorization\u003c/strong\u003e and \u003cstrong\u003elog in with a third party identity provider\u003c/strong\u003e scenarios.\nLet’s consider the dumbest example ever.\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eThe \u003cem\u003eresource\u003c/em\u003e is your Facebook wall and everything you’ve posted on it.\u003c/li\u003e\n  \u003cli\u003eThe \u003cem\u003eresource owner\u003c/em\u003e is, well, just you.\u003c/li\u003e\n  \u003cli\u003eThe \u003cem\u003eresource server\u003c/em\u003e is Facebook.\u003c/li\u003e\n  \u003cli\u003eThe \u003cem\u003eclient\u003c/em\u003e is the fb64.com app. Its cool feature is presenting your 10 recent posts\nas Base64 encoded strings.\u003c/li\u003e\n  \u003cli\u003eThe \u003cem\u003eauthorization server\u003c/em\u003e is also Facebook itself.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-02-01-oauth-stateless-login/legit.jpg\" alt=\"Phishing level master\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eSo, in the above scenario, you get the cool feature without giving these guys your Facebook login and password. When you are redirected to the Facebook login page\nfirst you give your consent for fb64.com to access a specific subset of your profile data. Next you type in your credentials (you send them to facebook.com, not to fb64.com) and\nwhen you get redirected back to fb64.com you are already logged-in and see an awesome black-and-white website with your Base64 encoded posts.\u003c/p\u003e\n\n\u003cp\u003eWhat have you done? You’ve \u003cstrong\u003egranted\u003c/strong\u003e some \u003cstrong\u003eclient\u003c/strong\u003e app access to your \u003cstrong\u003eprotected resource\u003c/strong\u003e data without sharing your \u003cstrong\u003ecredentials\u003c/strong\u003e with it. Full stop.\u003c/p\u003e\n\n\u003cp\u003eBut is that what we meant? Is that the kind of \u003cstrong\u003eresource sharing\u003c/strong\u003e and \u003cstrong\u003edelegated authorization\u003c/strong\u003e you expect when you want to, for example, log in to Booking, via Facebook, to book a hotel room but don’t want to set up an account?\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-02-01-oauth-stateless-login/no-no-no-thank-you.jpg\" alt=\"Thanks but thanks\" /\u003e\u003c/p\u003e\n\n\u003ch3 id=\"its-real-life-scenario-time\"\u003eIt’s \u003cstrong\u003eReal Life Scenario\u003c/strong\u003e Time\u003c/h3\u003e\n\n\u003cp\u003eLet’s come up with a more \u003cem\u003ereal-life-ish\u003c/em\u003e scenario.\nWhen you choose a \u003cstrong\u003ethird party identity provider login\u003c/strong\u003e you probably expect to get an account without wasting time to sign-up and come up with Yet Another Password.\nBefore you click \u003cem\u003econtinue as John Smith\u003c/em\u003e you are assured that:\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003ewhat the website will have access to are your name, surname, email and profile picture,\u003c/li\u003e\n  \u003cli\u003eit will not be allowed to post on your wall.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eSo what is the resource you are granting some app access to? Your identity! You use Facebook to let Booking know your name, surname, email and picture.\nObviously, in the meantime, Facebook needs to check and confirm that \u003cem\u003eyou are who you say you are\u003c/em\u003e, e.g. john.smith@somemail.com. So sharing your identity,\nwhich is the actual resource you are authorizing booking.com to access, implies being authenticated behind the scenes. \u003cstrong\u003eProving\u003c/strong\u003e your identity is \u003cstrong\u003eauthentication\u003c/strong\u003e while \u003cstrong\u003esharing\u003c/strong\u003e it is \u003cstrong\u003eauthorization\u003c/strong\u003e.\u003c/p\u003e\n\u003ch4 id=\"digression\"\u003eDigression:\u003c/h4\u003e\n\u003cp\u003eSeriously, how often do people use and authorize post, tweet or photo importing apps? Apps that post to your wall? I cannot name even one. Importing contacts from Gmail or one social network while logging in to another\nsocial network is the only everyday use case I can think of, apart from identity resource sharing.\u003c/p\u003e\n\n\u003ch3 id=\"oauth-based-authentication\"\u003eOAuth based \u003cstrong\u003e“authentication“\u003c/strong\u003e\u003c/h3\u003e\n\n\u003cp\u003eOAuth does not say a word about the way the authorization server should authenticate the user before letting them authorize the client app.\nHow does OAuth help in authenticating the user then? It doesn’t! The authentication happens transparently to the client app, sort of in-between the ongoing authorization process.\nIt depends on the authorization server’s internal authentication implementation. When you get redirected to Facebook and you type\nin your email and password and hit enter, it could even trigger basic authentication underneath and send your Base64 encoded plain-text credentials in the \u003cem\u003eAuthorization\u003c/em\u003e (sic!) HTTP header.\nOr it could trigger a three factor authentication process including a hard token and a magic link sent to your email.\nNever forget that OAuth is an authorization framework when you go to job interviews.\u003c/p\u003e\n\n\u003ch4 id=\"first-get-in\"\u003eFirst, get in\u003c/h4\u003e\n\n\u003cp\u003eWhy do we say that we \u003cem\u003elog in to Booking with Facebook using OAuth\u003c/em\u003e? I guess the reason of one of the common misunderstandings regarding the purpose of the framework is just this unfortunate mental shortcut. And the fact that most of us think \u003cem\u003elog in\u003c/em\u003e === \u003cem\u003eauthenticate\u003c/em\u003e (which is not wrong, I refuse to elaborate on the semantics in this case).\nWe should rather say that we \u003cem\u003eauthorize Booking to delegate authentication to Facebook and use the confirmed identity\u003c/em\u003e, in the background of logging in to Booking. We do all that instead of logging in to Booking directly.\nI guess it’s just too long and convoluted ;).\u003c/p\u003e\n\n\u003ch4 id=\"then-stay-inside\"\u003eThen, stay inside\u003c/h4\u003e\n\u003cp\u003eI can’t stress this enough: OAuth based authorization implies authentication performed by the authorization server. But to keep you logged in, the client app needs\nto use some other mechanism underneath, e.g. HTTP session based on cookies. That’s another blank spot on the OAuth map. Which is not wrong, it’s just not the concern of this framework.\nJust, please, don’t use the access token as a session ID.\u003c/p\u003e\n\n\u003ch4 id=\"authorizer-and-authorizee-\"\u003eAuthorizer and authorizee ;)\u003c/h4\u003e\n\u003cp\u003eYou build the sign-in layer of your app using OAuth as the authorization framework. The user gets authenticated by the third party and allows your app to access their identity data. Let’s clarify another common misconception\nrelated to the part OAuth plays here. Who is the one being authorized? The user? No, it’s your app. The client app is being authorized - by the user - to access a resource, via the authorization server.\nDoes that imply authorizing the user, too? Yes, it may when you think of it the other way round. You cannot authorize the client app to do something that you are not yourself authorized to do in the resource server.\nThis is where \u003ca href=\"https://tools.ietf.org/html/rfc6749#page-23\"\u003eaccess token scopes\u003c/a\u003e grow out of resource owner privileges, permissions, roles etc.\nCan the shared identity resource also contain some permissions and privileges granted to the user within the authorization server? Yes, they can and they often do, e.g. as a \u003cem\u003epermissions\u003c/em\u003e or \u003cem\u003eroles\u003c/em\u003e field in the access token returned by the authorization server.\nI specifically think of \u003ca href=\"https://auth0.com/docs/tokens/access-tokens\"\u003eJson Web Tokens\u003c/a\u003e and their custom claims.\nForgive me for not pasting in an example of a JWT, but I’m allergic to pasting things you have probably seen a hundred times elsewhere.\u003c/p\u003e\n\n\u003ch2 id=\"oauth-based-authentication-no-quotes\"\u003eOAuth based \u003cstrong\u003eauthentication\u003c/strong\u003e (no quotes)\u003c/h2\u003e\n\n\u003cp\u003eYep, here \u003cstrong\u003e100% correct approach\u003c/strong\u003e is not just a clickbait title.\u003c/p\u003e\n\n\u003cp\u003eA corresponding authentication framework which you can use to implement the identity layer of your\napplication is \u003ca href=\"https://auth0.com/docs/protocols/openid-connect-protocol\"\u003eOpen ID Connect\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eWhile the purpose of OAuth is Delegated Authorization, what describes OpenID Connect best is Federated Identity Management.\nWhat does it mean?\u003c/p\u003e\n\n\u003cp\u003eOK, I lied. Brace yourselves, for a citation is coming:\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eWhile OAuth 2.0 is about resource access and sharing, OIDC is all about user authentication.\nIts purpose is to give you one login for multiple sites.\nEach time you need to log in to a website using OIDC, you are redirected to your OpenID site where you login,\nand then taken back to the website.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eI guess you’ve just said: “Wait, wait, whaaat???“\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003e… you are redirected to your OpenID site where you login, and then taken back to the website\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eNow you may think: “We’ve just gone through that, haven’t we? You’ve just swapped one framework for another to make the post longer.“\u003c/p\u003e\n\n\u003cp\u003eNo, it’s just that OIDC is not loosely based on OAuth, it’s actually plugged into it, filling all the authentication\ngaps we’ve mentioned before. It’s best suited to develop your own Identity Provider or more likely an internal security component\nof a system you are building. It may also be a universal login and authorization service for a broader environment of applications\nand systems in your or your client’s company. We will not dig deeper into OIDC in this post, as it deserves\na post of its own. The fact that OIDC perfectly fits into OAuth is best illustrated by the following. While OAuth lets you control access to given resources (like user identity)\nby issuing either JWT access tokens or UUID access tokens, OIDC handles user identity with ID tokens. Access tokens are opaque from the client’s perspective.\nID tokens MUST be a JWT user identity state representation because the ID token, unlike the access token, is readable for the client.\nOIDC does all what was \u003cem\u003ebehind the scenes\u003c/em\u003e and \u003cem\u003edepending on the identity provider\u003c/em\u003e implementation.\u003c/p\u003e\n\n\u003ch2 id=\"client-authentication\"\u003eClient authentication\u003c/h2\u003e\n\n\u003cp\u003eThe biggest lie in OAuth is that it has nothing to do with authentication. It’s true only for the resource owner.\nThe client needs to authenticate itself every time it asks for an access token. Usually it implies sending the client ID and secret as Basic Authentication plain-text string.\nSPA applications have no way of “storing“ the secret securely, as it would have to be included in the source code.\nThat’s why the simplified Implicit flow, devised for JavaScript applications as they were understood almost a decade ago, is now officially\nbanned. It omits the client secret, uses only the client ID, and imposes several other limitations. As per storing the client secret on the client side, when using the Authorization Code grant, mobile and native apps have been believed to be\nsecure enough to do it. \u003ca href=\"https://www.youtube.com/watch?v=H6MxsFMAoP8\"\u003eThey are not\u003c/a\u003e.\nThe only way traditional Authorization Code grant can be used securely is by rendering your web application server-side.\nA huge step forward for OAuth for SPA and mobile apps is enriching the Authorization Code with \u003ca href=\"https://developer.okta.com/blog/2018/12/13/oauth-2-for-native-and-mobile-apps\"\u003ePKCE\u003c/a\u003e, which I only link here,\nas it deserves an article of its own.\u003c/p\u003e\n\n\u003ch2 id=\"stateless-is-a-techie-euphemism-for-useless\"\u003eStateless is a techie euphemism for useless\u003c/h2\u003e\n\n\u003cp\u003eAnother matter I find very often misunderstood is how OAuth as an authorization framework and OIDC as an authentication framework\ncan be used to secure an app using a completely stateless implementation.\u003c/p\u003e\n\n\u003cp\u003eImplementing (\u003cstrong\u003efully\u003c/strong\u003e) stateless authorization and authentication mechanisms requires\nabandoning the traditional battle-tested server-side sessions with identifiers stored client-side as cookies\nfor (stateless) Json Web Tokens (or some other isomorphic solution).\u003c/p\u003e\n\n\u003cp\u003eBy stateless JWT I mean an approach where the whole identity and access control context is fetched \u003cstrong\u003eonce\u003c/strong\u003e when the user logs in (or upon token refresh). Then it’s sent back and forth in form of JWT tokens as cookies (sic!), HTTP request headers or body.\nI will not dig into the pros and cons of where to store and how to transfer JWTs as this would mean copying and pasting half\nof the software-literate Internet. You will find the details in the expert articles I link in further sections.\u003c/p\u003e\n\n\u003cp\u003eI treat this section as a challenge to prove that an article can be built virtually out of citations only.\nWith minimal intellectual effort from the author. Let’s get started:\n    Unlike sessions - which can be invalidated by the server\n    whenever it feels like it - individual stateless JWT tokens\n    cannot be invalidated. By design, they will be valid until\n    they expire, no matter what happens. This means that you cannot,\n    for example, invalidate the session of an attacker after detecting\n    a compromise. You also cannot invalidate old sessions when a user\n    changes their password.\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eYou are essentially powerless, and cannot ‘kill’ a session\nwithout building complex (and stateful!) infrastructure to\nexplicitly detect and reject them, defeating the entire\npoint of using stateless JWT tokens to begin with.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThe above and below citations by Sven Slootweg come from \u003ca href=\"http://cryto.net/%7Ejoepie91/blog/2016/06/13/stop-using-jwt-for-sessions/\"\u003ethis\u003c/a\u003e\nand \u003ca href=\"http://cryto.net/~joepie91/blog/2016/06/19/stop-using-jwt-for-sessions-part-2-why-your-solution-doesnt-work/\"\u003ethis\u003c/a\u003e article.\u003c/p\u003e\n\n\u003cp\u003eRegarding the highlighted session invalidation concerns, the same applies to challenges related to revoking only some of the user privileges without logging them out, so I will not\ndifferentiate between these two cases.\nBy stateful JWT you should understand any hybrid that tries to balance what is necessary to store (and potentially invalidate)\nserver-side and the data that can be stored in the browser and transferred in an encoded, encrypted and signed form with every request\nuntil it automatically expires. The question is: if something does not require a real-time invalidation - be it a user session or a user privilege -\nare we still talking about stateless authentication and authorization? Or just about some user data that may be stale so there is no need to fetch them\nwith every request? That’s an entirely different story.\u003c/p\u003e\n\n\u003cp\u003eI have an auto-reloading citation clip in my gun:\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eThis can mean that a token contains some outdated information like an old website URL that somebody changed\nin their profile - but more seriously, it can also mean somebody has a token with a role of admin,\neven though you’ve just revoked their admin role. Because you can’t invalidate tokens either,\nthere’s no way for you to remove their administrator access,\nshort of shutting down the entire system.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eI would appreciate if you suggested an example of an application\nthat needs some security mechanisms but it is not critical to be able to\nrevoke or invalidate them in real time.\u003c/p\u003e\n\n\u003cp\u003eI have once read that losing a JWT token is like losing your house keys. Be it true or not, you can always say that\nyou can leave your apartment door open for several minutes if you just go down to the groceries and will be right back. Of course you can, you could also\nleave your bank account without logging out on a university library computer, there is a good chance the session will expire before someone\nsteals your money. The same applies to the expiry of a JWT session or access token which is not either whitelisted\nor blacklisted server-side.\u003c/p\u003e\n\n\u003cp\u003eWhen I imagine myself discovering that once I’ve changed my Gmail account password using the desktop app\nI’m still logged in (even if only for the remaining four minutes) on my mobile app then… Well it’s embarrassing and frightening at the same time, when you think of all the accounts\nyou could potentially reset passwords for by taking over someone’s email account. But yeah, go ahead and just remove the user’s token from local storage.\u003c/p\u003e\n\n\u003cp\u003eOK, sit down, it’s citation break:\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eIf you are concerned about somebody intercepting your session cookie,\nyou should just be using TLS instead - any kind of session implementation\nwill be interceptable if you don’t use TLS, including JWT.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eMe discovering someone took over the evergreen refresh token to my mail account:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-02-01-oauth-stateless-login/refresh_token.jpg\" alt=\"Me discovering someone took over the evergreen refresh token linked to my mail account\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eThere is no you-meme-it-wrong record I couldn’t break.\u003c/p\u003e\n\n\u003cp\u003eAnother citation (same source):\u003c/p\u003e\n\u003cblockquote\u003e\n  \u003cp\u003eSimply put, using cookies is not optional, regardless of whether you use JWT or not.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eYet Another Citation\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eTrue statelessness and revocation are mutually exclusive.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003ePlease do look it up in \u003ca href=\"https://lmgtfy.app/?q=%22statelessness+and+revocation+are+mutually+exclusive%22\"\u003ethese articles\u003c/a\u003e\nor at least notice how many of them come up.\u003c/p\u003e\n\n\u003cp\u003eNow that I’m done with throwing angry links at you, let’s focus on the other side of the problem.\u003c/p\u003e\n\n\u003ch2 id=\"statelessness-is-a-key-to-easier-scalability\"\u003eStatelessness is a key to easier scalability\u003c/h2\u003e\n\n\u003cp\u003eIt’s not true that introducing stateless elements to your authentication and authorization is something wrong.\nMy intention was to play bad cop to emphasize things you have to be careful about.\nHDD (Hype Driven Development) is a bad practice in general, but as far as security is concerned it’s the shortest path to\ngetting hacked.\nEvery reasonable JWT-based security implementation is a hybrid of stateless, token-based solutions and stateful,\nserver-side-stored solutions. If moving away from traditional, fully stateful implementations is a challenge for\nyour team, you may start \u003ca href=\"https://auth0.com/blog/stateless-auth-for-stateful-minds/\"\u003ewith this auth0 article\u003c/a\u003e\nwhich may make the mind shift easier.\u003c/p\u003e\n\n\u003cp\u003eOne of the key points from my point of view:\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eOne of the cool things about session IDs is that they are opaque.\n“Opaque” means no data can be extracted from it by third parties (other than the issuer).\nThe association between session ID and data is entirely done server-side.\nAre there any other ways of achieving something of the sort without relying on state?\nEnter cryptography.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThe general idea, as mentioned in the OIDC section, is that access tokens should be\nseen by the client as UUIDs or other meaningless text. It’s the server that should be able to interpret them.\nThat obviously works for traditional session IDs and can be achieved in the JWT-based\napproach using encryption. Obviously, to achieve revocation you need to store those tokens\nanyway.\u003c/p\u003e\n\n\u003cp\u003eThis is where the critics of introducing JWTs in the main authorization flows, as opposed to one-time operations or server-side machine-to-machine communication, hit you hard:\n\u003cimg src=\"/img/articles/2021-02-01-oauth-stateless-login/jwt-flowchart.png\" alt=\"Authority is not granted to you\" /\u003e\n\u003ca href=\"http://cryto.net/~joepie91/blog/2016/06/19/stop-using-jwt-for-sessions-part-2-why-your-solution-doesnt-work/\"\u003eSource: again the Slootweg article\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThis positions us somewhere between the second and the third “swimlane“ on the above chart, which means\nkeeping a blacklist of revocations to invalidate or storing ID in the token and rest of the data server-side.\u003c/p\u003e\n\n\u003cp\u003eIt brings you either to:\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eYour blacklisting/authenticaiton server goes down. What now?\nOnce the attacker takes down the server he has free roam and there is nothing\nyou can do to stop him.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eor to:\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eCongratulations! You’ve reinvented sessions, with all their problems (notably,\ntheir need for central state) and gained nothing in the process. But the implementation\nyou are using is less battle tested and you run a higher risk of vulnerabilities.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eYay, time for pasting a JWT body example like in all these other articles:\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"sub\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"some_user_id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e//no\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003ereasonable\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003ecase\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003efor\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003eit\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003eto\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003ego\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003estale\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003ebut\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003edangerous\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003eif\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003ecompromised\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Jason William Toak\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e//highly\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003eunlikely\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003eto\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003echange\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003ebut\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003eit's\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003esensitive\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003edata\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"email\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"j.w.toak@somemail.com\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e//stale\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003eemail\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003emay\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003eobviously\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003ebe\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003ea\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003esecurity\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003eissue\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"scope\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"admin\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e//this\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003ereally\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003esucks\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003eif\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003ethe\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003etoken\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003eis\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003enot\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003erevocable\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"user\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eObviously, the above token needs to be \u003ca href=\"https://tools.ietf.org/html/rfc7515\"\u003esigned\u003c/a\u003e so that you are sure that no one changed\nits content and it needs to be \u003ca href=\"https://tools.ietf.org/html/rfc7516\"\u003eencrypted\u003c/a\u003e as it contains sensitive data. There is a \u003ca href=\"https://auth0.com/blog/json-web-token-signing-algorithms-overview/\"\u003echoice of algorithms\u003c/a\u003e available.\nAn interesting fact \u003ca href=\"https://auth0.com/blog/stateless-auth-for-stateful-minds/#The-Technical-Magic--JWTs--Digital-Signatures-and-Encryption\"\u003ementioned\u003c/a\u003e by Sebastian Peyrott from the auth0 team:\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003eA typical encryption scheme uses an already signed JWT as the payload for encryption. This is known as a nested JWT. It is acceptable to use the same key for encryption and validation.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eI guess there is a bottom line that somehow finds a common denominator for both Slootweg and Peyrott manifestos. I do not put these articles in opposition to each other, just as points of view on the same problems from different angles and with different bias.\nThis bottom line, as I see it, is as follows:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eAlthough JWTs are validated cryptographically, most systems need to use some storage for tokens anyway. By most systems I mean all using refresh tokens, which on its own should, in my opinion, mean virtually each end every token-based application.\u003c/li\u003e\n  \u003cli\u003eThe storage, depending on the application’s requirements, would be either a blacklist or a whitelist of tokens. These\ncan include short-lived access tokens, long-lived refresh tokens, ID tokens or a cartesian product of all the mentioned options.\u003c/li\u003e\n  \u003cli\u003eThe only way for the token storage to prevent leakage is checking every applicable token\nagainst the white/black list.\u003c/li\u003e\n  \u003cli\u003eYou can either call it “reinventing sessions“ or “negating some benefits of the token-based approach“, but revocation and statelessness\nare mutually exclusive and nothing can change it.\u003c/li\u003e\n  \u003cli\u003eThe more you reduce the tokens’ TTL, the less \u003cem\u003ebenefit of statelessness\u003c/em\u003e you get. I mean that reducing access tokens’ TTL to a reasonable minimum is probably a must-have in\nmost real-life scenarios. Refreshing them is based on refresh tokens stored server-side anyway and a short access tokens’ TTL requires frequent calls to a single point of failure.\nOne still benefits on using a semi-stateless solution, yet the fully stateless one is usually fiction. “The Benefits of Going Stateless“, a slogan which starts Peyrott’s article, is actually just a figure of speech.\u003c/li\u003e\n  \u003cli\u003eFor some systems even a five seconds long access token validity may be a security breach.\u003c/li\u003e\n  \u003cli\u003eRolling the signing key is always an option, but it’s like a nuclear suicide attack on your users’ sessions.\u003c/li\u003e\n  \u003cli\u003eEven if you check every token against some kind of storage, this does not mean you are back\nto centralized sessions, you still greatly reduce the number of HTTP calls regarding user identity, privilege and other\ndata you choose to fit into a token.\u003c/li\u003e\n  \u003cli\u003eLet’s emphasize that again: there is a huge difference between accessing a VALID/INVALID key-value storage with every request versus querying\na set of storages for distributed user-related data, and aggregating them for every request.\u003c/li\u003e\n  \u003cli\u003eIn a microservice architecture it’s a COLOSSAL, crucial change, which means a difference\nbetween a system that barely crawls and one that performs very well.\u003c/li\u003e\n  \u003cli\u003eIn an event-driven microservice architecture, you can handle both user log-outs and privilege revocation or stale data\nwith events invalidating corresponding tokens. Generating a new token does not necessarily mean fetching all data again, it depends on the granularity\nof information included in the event.\u003c/li\u003e\n  \u003cli\u003eDoes it mean latency, possible race conditions, eventual consistency? Well, yeah, just as pretty much everything does nowadays.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"summary\"\u003eSummary\u003c/h2\u003e\n\n\u003cp\u003e\u003cem\u003eAuthorization, authentication, statelessness, revocation, tokens, sessions.\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eLots of stuff easy to misunderstand, implement the wrong way, oversimplify and wrongly criticise.\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eOAuth, JWT, OpenID Connect, Authorization Code Grant, Implicit Flow, User and Client Credentials, Third-Party Identity Providers,\nDelegated Authorization, Federated Identity Management.\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eThat’s again a lot of words and it’s not even a sentence, though a nice SEO booster ;)  We’ve gone more or less through\nall of that, but studying all these terms in detail here was impossible. Should there be at least one thing this article made clear to you and if you\nfeel some misconceptions have been clarified, I’m very happy. If there is at least one comment\nbelow this article which will prove me wrong in some or most of views on this broad subject, I will be\nmore than happy to learn something and exchange opinions. As I’ve mentioned in\nthe beginning of the article, security is not something most of us can study, implement and\nwork with every day. Please feel invited to share your knowledge and experience, also including stuff\nthat looks good on paper, but didn’t work for you in production. I will appreciate it a lot.\u003c/p\u003e\n","contentSnippet":"Many of us spend most of their software development careers improving and extending applications protected by pre-existing security mechanisms. That’s why\nwe rarely address problems related directly to authentication and authorization unless we build apps from scratch.\nRegardless of your experience I still hope you will find this article interesting.\nIt’s not meant to be a tutorial. I would like to focus on clarifying basic concepts and highlighting common misconceptions.\nAlpha disclaimer:\nSorry to disappoint you, but the title of this article is just a cheap click-bait.\nIt doesn’t matter whether you started reading because you disagree with\nthe title or because you hoped to find the holy grail\nof securing web applications. There is a chance you will find something for yourself anyway.\nBeta disclaimer:\nThis post is not meant to answer the “how does the login with Facebook work“ question.\nWe will spend some time on it, but just to provoke a discussion, not to go through a tutorial.\nGamma disclaimer:\nI have never built a full-fledged auth process from scratch myself in a commercial web app.\nI’m no security expert, so you read at your own risk.\nAuthentication vs Authorization\nWow! If you are still reading, cool!\nLet’s start with a short recap on these two basic concepts. Authentication is about verifying who you are.\nYou need to prove your identity, that’s all. You may authenticate, for example, by using a password or your fingerprint.\nYou may need to use a token (hard or soft), an authentication-app-generated code or a text message sent to your phone number.\nI hope you tend to use at least two of these. Anyway, once you’ve done it, you are in.\n\nAuthorization is about verifying what you are allowed to do. I’m not going to copy-paste bookish definitions here. For example, when entering a university library, you authenticate by presenting your ID.\nThe librarian checks the authenticity of the document and analyzes whether you are the one on the photograph or not.\nThe authorization process starts right away.\nTo keep things simple, the librarian checks, based on your confirmed identity, whether you are a professor or a student. This implies which books you can borrow and how many you can take home.\nThis is where the privileges or permissions come into play.\n\nIf you are already bored with the most obvious meme I could use, let me give you another obvious example of authorization.\nWhen entering a military zone, you also present your ID for authentication. You can’t get in unless you ARE, e.g. a military officer. It’s not the authentication that failed then.\nThe guardian knows who you are now.\nYou are forbidden to enter as you have not been granted such an authority.\nOne last meme, I promise.\n\nOAuth 2.0: why is it not about authenticating the user?\nI started with the above trivia because the concepts of authorization and authentication are mingled so often that, even when you know them, you may still get a headache\nwhen reading about OAuth (from now on, I will omit the 2.0 specification version).\nWhat is OAuth? I hate copy-pasting definitions from official docs and other blogs. What I hate even more is copy-pasting them, rephrasing and selling as my own.\nSo, unless you already did, please stop reading and check out the docs, this website and then the auth0 website. If you liked the latter, you may also check out their blog in general.\nI assume you’ve read the suggested docs so I will move on to using the traditional OAuth lingo (grants, flows, resources, third-party servers etc).\nOAuth flows revisited\nThe OAuth specification describes this framework as available in four flavours:\nAuthorization Code\nImplicit\nResource Owner Credentials\nClient Credentials\nSo 2012.\n\nThe Resource Owner Credentials (User Credentials) flow is already legacy and officially banned by IETF.\n    The latest OAuth 2.0 Security Best Current Practice disallows the password grant entirely.\nSource\nThe same applies to the Implicit flow, also discouraged in its original form.\nSome experts analyze whether it is already dead or not.\nIn the following two “login with..“ examples you should understand OAuth as limited to the Authorization Code grant. The Client Credentials grant is a completely different story, handled\nin a further part of the article.\nIt’s Hello World Time\nI prefer to think of OAuth as a set of guidelines and best practices that help you solve a common problem related to authorization, as opposed to a strict framework or protocol.\nThis common problem may be for instance the following. Damn, how the hell did these guys implement the cool log in with Facebook feature in their app (not so cool anymore, let’s be honest it’s 2021 not 2015).\nLet’s call this app fb64.com .\nTo be precise, how did those guys use the Facebook API to delegate the process of asking the user whether or not fb64.com can access some of their Facebook account data?\nYou may find an analogous scenario described in virtually EVERY SINGLE blog post referring to OAuth, but there is a good reason why I do it here too. I use it because it sucks and introduces misunderstandigs regarding real-life\ndelegated authorization and log in with a third party identity provider scenarios.\nLet’s consider the dumbest example ever.\nThe resource is your Facebook wall and everything you’ve posted on it.\nThe resource owner is, well, just you.\nThe resource server is Facebook.\nThe client is the fb64.com app. Its cool feature is presenting your 10 recent posts\nas Base64 encoded strings.\nThe authorization server is also Facebook itself.\n\nSo, in the above scenario, you get the cool feature without giving these guys your Facebook login and password. When you are redirected to the Facebook login page\nfirst you give your consent for fb64.com to access a specific subset of your profile data. Next you type in your credentials (you send them to facebook.com, not to fb64.com) and\nwhen you get redirected back to fb64.com you are already logged-in and see an awesome black-and-white website with your Base64 encoded posts.\nWhat have you done? You’ve granted some client app access to your protected resource data without sharing your credentials with it. Full stop.\nBut is that what we meant? Is that the kind of resource sharing and delegated authorization you expect when you want to, for example, log in to Booking, via Facebook, to book a hotel room but don’t want to set up an account?\n\nIt’s Real Life Scenario Time\nLet’s come up with a more real-life-ish scenario.\nWhen you choose a third party identity provider login you probably expect to get an account without wasting time to sign-up and come up with Yet Another Password.\nBefore you click continue as John Smith you are assured that:\nwhat the website will have access to are your name, surname, email and profile picture,\nit will not be allowed to post on your wall.\nSo what is the resource you are granting some app access to? Your identity! You use Facebook to let Booking know your name, surname, email and picture.\nObviously, in the meantime, Facebook needs to check and confirm that you are who you say you are, e.g. john.smith@somemail.com. So sharing your identity,\nwhich is the actual resource you are authorizing booking.com to access, implies being authenticated behind the scenes. Proving your identity is authentication while sharing it is authorization.\nDigression:\nSeriously, how often do people use and authorize post, tweet or photo importing apps? Apps that post to your wall? I cannot name even one. Importing contacts from Gmail or one social network while logging in to another\nsocial network is the only everyday use case I can think of, apart from identity resource sharing.\nOAuth based “authentication“\nOAuth does not say a word about the way the authorization server should authenticate the user before letting them authorize the client app.\nHow does OAuth help in authenticating the user then? It doesn’t! The authentication happens transparently to the client app, sort of in-between the ongoing authorization process.\nIt depends on the authorization server’s internal authentication implementation. When you get redirected to Facebook and you type\nin your email and password and hit enter, it could even trigger basic authentication underneath and send your Base64 encoded plain-text credentials in the Authorization (sic!) HTTP header.\nOr it could trigger a three factor authentication process including a hard token and a magic link sent to your email.\nNever forget that OAuth is an authorization framework when you go to job interviews.\nFirst, get in\nWhy do we say that we log in to Booking with Facebook using OAuth? I guess the reason of one of the common misunderstandings regarding the purpose of the framework is just this unfortunate mental shortcut. And the fact that most of us think log in === authenticate (which is not wrong, I refuse to elaborate on the semantics in this case).\nWe should rather say that we authorize Booking to delegate authentication to Facebook and use the confirmed identity, in the background of logging in to Booking. We do all that instead of logging in to Booking directly.\nI guess it’s just too long and convoluted ;).\nThen, stay inside\nI can’t stress this enough: OAuth based authorization implies authentication performed by the authorization server. But to keep you logged in, the client app needs\nto use some other mechanism underneath, e.g. HTTP session based on cookies. That’s another blank spot on the OAuth map. Which is not wrong, it’s just not the concern of this framework.\nJust, please, don’t use the access token as a session ID.\nAuthorizer and authorizee ;)\nYou build the sign-in layer of your app using OAuth as the authorization framework. The user gets authenticated by the third party and allows your app to access their identity data. Let’s clarify another common misconception\nrelated to the part OAuth plays here. Who is the one being authorized? The user? No, it’s your app. The client app is being authorized - by the user - to access a resource, via the authorization server.\nDoes that imply authorizing the user, too? Yes, it may when you think of it the other way round. You cannot authorize the client app to do something that you are not yourself authorized to do in the resource server.\nThis is where access token scopes grow out of resource owner privileges, permissions, roles etc.\nCan the shared identity resource also contain some permissions and privileges granted to the user within the authorization server? Yes, they can and they often do, e.g. as a permissions or roles field in the access token returned by the authorization server.\nI specifically think of Json Web Tokens and their custom claims.\nForgive me for not pasting in an example of a JWT, but I’m allergic to pasting things you have probably seen a hundred times elsewhere.\nOAuth based authentication (no quotes)\nYep, here 100% correct approach is not just a clickbait title.\nA corresponding authentication framework which you can use to implement the identity layer of your\napplication is Open ID Connect.\nWhile the purpose of OAuth is Delegated Authorization, what describes OpenID Connect best is Federated Identity Management.\nWhat does it mean?\nOK, I lied. Brace yourselves, for a citation is coming:\nWhile OAuth 2.0 is about resource access and sharing, OIDC is all about user authentication.\nIts purpose is to give you one login for multiple sites.\nEach time you need to log in to a website using OIDC, you are redirected to your OpenID site where you login,\nand then taken back to the website.\nI guess you’ve just said: “Wait, wait, whaaat???“\n… you are redirected to your OpenID site where you login, and then taken back to the website\nNow you may think: “We’ve just gone through that, haven’t we? You’ve just swapped one framework for another to make the post longer.“\nNo, it’s just that OIDC is not loosely based on OAuth, it’s actually plugged into it, filling all the authentication\ngaps we’ve mentioned before. It’s best suited to develop your own Identity Provider or more likely an internal security component\nof a system you are building. It may also be a universal login and authorization service for a broader environment of applications\nand systems in your or your client’s company. We will not dig deeper into OIDC in this post, as it deserves\na post of its own. The fact that OIDC perfectly fits into OAuth is best illustrated by the following. While OAuth lets you control access to given resources (like user identity)\nby issuing either JWT access tokens or UUID access tokens, OIDC handles user identity with ID tokens. Access tokens are opaque from the client’s perspective.\nID tokens MUST be a JWT user identity state representation because the ID token, unlike the access token, is readable for the client.\nOIDC does all what was behind the scenes and depending on the identity provider implementation.\nClient authentication\nThe biggest lie in OAuth is that it has nothing to do with authentication. It’s true only for the resource owner.\nThe client needs to authenticate itself every time it asks for an access token. Usually it implies sending the client ID and secret as Basic Authentication plain-text string.\nSPA applications have no way of “storing“ the secret securely, as it would have to be included in the source code.\nThat’s why the simplified Implicit flow, devised for JavaScript applications as they were understood almost a decade ago, is now officially\nbanned. It omits the client secret, uses only the client ID, and imposes several other limitations. As per storing the client secret on the client side, when using the Authorization Code grant, mobile and native apps have been believed to be\nsecure enough to do it. They are not.\nThe only way traditional Authorization Code grant can be used securely is by rendering your web application server-side.\nA huge step forward for OAuth for SPA and mobile apps is enriching the Authorization Code with PKCE, which I only link here,\nas it deserves an article of its own.\nStateless is a techie euphemism for useless\nAnother matter I find very often misunderstood is how OAuth as an authorization framework and OIDC as an authentication framework\ncan be used to secure an app using a completely stateless implementation.\nImplementing (fully) stateless authorization and authentication mechanisms requires\nabandoning the traditional battle-tested server-side sessions with identifiers stored client-side as cookies\nfor (stateless) Json Web Tokens (or some other isomorphic solution).\nBy stateless JWT I mean an approach where the whole identity and access control context is fetched once when the user logs in (or upon token refresh). Then it’s sent back and forth in form of JWT tokens as cookies (sic!), HTTP request headers or body.\nI will not dig into the pros and cons of where to store and how to transfer JWTs as this would mean copying and pasting half\nof the software-literate Internet. You will find the details in the expert articles I link in further sections.\nI treat this section as a challenge to prove that an article can be built virtually out of citations only.\nWith minimal intellectual effort from the author. Let’s get started:\n    Unlike sessions - which can be invalidated by the server\n    whenever it feels like it - individual stateless JWT tokens\n    cannot be invalidated. By design, they will be valid until\n    they expire, no matter what happens. This means that you cannot,\n    for example, invalidate the session of an attacker after detecting\n    a compromise. You also cannot invalidate old sessions when a user\n    changes their password.\nYou are essentially powerless, and cannot ‘kill’ a session\nwithout building complex (and stateful!) infrastructure to\nexplicitly detect and reject them, defeating the entire\npoint of using stateless JWT tokens to begin with.\nThe above and below citations by Sven Slootweg come from this\nand this article.\nRegarding the highlighted session invalidation concerns, the same applies to challenges related to revoking only some of the user privileges without logging them out, so I will not\ndifferentiate between these two cases.\nBy stateful JWT you should understand any hybrid that tries to balance what is necessary to store (and potentially invalidate)\nserver-side and the data that can be stored in the browser and transferred in an encoded, encrypted and signed form with every request\nuntil it automatically expires. The question is: if something does not require a real-time invalidation - be it a user session or a user privilege -\nare we still talking about stateless authentication and authorization? Or just about some user data that may be stale so there is no need to fetch them\nwith every request? That’s an entirely different story.\nI have an auto-reloading citation clip in my gun:\nThis can mean that a token contains some outdated information like an old website URL that somebody changed\nin their profile - but more seriously, it can also mean somebody has a token with a role of admin,\neven though you’ve just revoked their admin role. Because you can’t invalidate tokens either,\nthere’s no way for you to remove their administrator access,\nshort of shutting down the entire system.\nI would appreciate if you suggested an example of an application\nthat needs some security mechanisms but it is not critical to be able to\nrevoke or invalidate them in real time.\nI have once read that losing a JWT token is like losing your house keys. Be it true or not, you can always say that\nyou can leave your apartment door open for several minutes if you just go down to the groceries and will be right back. Of course you can, you could also\nleave your bank account without logging out on a university library computer, there is a good chance the session will expire before someone\nsteals your money. The same applies to the expiry of a JWT session or access token which is not either whitelisted\nor blacklisted server-side.\nWhen I imagine myself discovering that once I’ve changed my Gmail account password using the desktop app\nI’m still logged in (even if only for the remaining four minutes) on my mobile app then… Well it’s embarrassing and frightening at the same time, when you think of all the accounts\nyou could potentially reset passwords for by taking over someone’s email account. But yeah, go ahead and just remove the user’s token from local storage.\nOK, sit down, it’s citation break:\nIf you are concerned about somebody intercepting your session cookie,\nyou should just be using TLS instead - any kind of session implementation\nwill be interceptable if you don’t use TLS, including JWT.\nMe discovering someone took over the evergreen refresh token to my mail account:\n\nThere is no you-meme-it-wrong record I couldn’t break.\nAnother citation (same source):\nSimply put, using cookies is not optional, regardless of whether you use JWT or not.\nYet Another Citation\nTrue statelessness and revocation are mutually exclusive.\nPlease do look it up in these articles\nor at least notice how many of them come up.\nNow that I’m done with throwing angry links at you, let’s focus on the other side of the problem.\nStatelessness is a key to easier scalability\nIt’s not true that introducing stateless elements to your authentication and authorization is something wrong.\nMy intention was to play bad cop to emphasize things you have to be careful about.\nHDD (Hype Driven Development) is a bad practice in general, but as far as security is concerned it’s the shortest path to\ngetting hacked.\nEvery reasonable JWT-based security implementation is a hybrid of stateless, token-based solutions and stateful,\nserver-side-stored solutions. If moving away from traditional, fully stateful implementations is a challenge for\nyour team, you may start with this auth0 article\nwhich may make the mind shift easier.\nOne of the key points from my point of view:\nOne of the cool things about session IDs is that they are opaque.\n“Opaque” means no data can be extracted from it by third parties (other than the issuer).\nThe association between session ID and data is entirely done server-side.\nAre there any other ways of achieving something of the sort without relying on state?\nEnter cryptography.\nThe general idea, as mentioned in the OIDC section, is that access tokens should be\nseen by the client as UUIDs or other meaningless text. It’s the server that should be able to interpret them.\nThat obviously works for traditional session IDs and can be achieved in the JWT-based\napproach using encryption. Obviously, to achieve revocation you need to store those tokens\nanyway.\nThis is where the critics of introducing JWTs in the main authorization flows, as opposed to one-time operations or server-side machine-to-machine communication, hit you hard:\n\nSource: again the Slootweg article\nThis positions us somewhere between the second and the third “swimlane“ on the above chart, which means\nkeeping a blacklist of revocations to invalidate or storing ID in the token and rest of the data server-side.\nIt brings you either to:\nYour blacklisting/authenticaiton server goes down. What now?\nOnce the attacker takes down the server he has free roam and there is nothing\nyou can do to stop him.\nor to:\nCongratulations! You’ve reinvented sessions, with all their problems (notably,\ntheir need for central state) and gained nothing in the process. But the implementation\nyou are using is less battle tested and you run a higher risk of vulnerabilities.\nYay, time for pasting a JWT body example like in all these other articles:\n\n    {\n        \"sub\": \"some_user_id\", //no reasonable case for it to go stale, but dangerous if compromised\n        \"name\": \"Jason William Toak\", //highly unlikely to change, but it's sensitive data\n        \"email\": \"j.w.toak@somemail.com\", //stale email may obviously be a security issue\n        \"scope\": [\n            \"admin\", //this really sucks if the token is not revocable\n            \"user\"\n        ]\n    }\n\n\nObviously, the above token needs to be signed so that you are sure that no one changed\nits content and it needs to be encrypted as it contains sensitive data. There is a choice of algorithms available.\nAn interesting fact mentioned by Sebastian Peyrott from the auth0 team:\nA typical encryption scheme uses an already signed JWT as the payload for encryption. This is known as a nested JWT. It is acceptable to use the same key for encryption and validation.\nI guess there is a bottom line that somehow finds a common denominator for both Slootweg and Peyrott manifestos. I do not put these articles in opposition to each other, just as points of view on the same problems from different angles and with different bias.\nThis bottom line, as I see it, is as follows:\nAlthough JWTs are validated cryptographically, most systems need to use some storage for tokens anyway. By most systems I mean all using refresh tokens, which on its own should, in my opinion, mean virtually each end every token-based application.\nThe storage, depending on the application’s requirements, would be either a blacklist or a whitelist of tokens. These\ncan include short-lived access tokens, long-lived refresh tokens, ID tokens or a cartesian product of all the mentioned options.\nThe only way for the token storage to prevent leakage is checking every applicable token\nagainst the white/black list.\nYou can either call it “reinventing sessions“ or “negating some benefits of the token-based approach“, but revocation and statelessness\nare mutually exclusive and nothing can change it.\nThe more you reduce the tokens’ TTL, the less benefit of statelessness you get. I mean that reducing access tokens’ TTL to a reasonable minimum is probably a must-have in\nmost real-life scenarios. Refreshing them is based on refresh tokens stored server-side anyway and a short access tokens’ TTL requires frequent calls to a single point of failure.\nOne still benefits on using a semi-stateless solution, yet the fully stateless one is usually fiction. “The Benefits of Going Stateless“, a slogan which starts Peyrott’s article, is actually just a figure of speech.\nFor some systems even a five seconds long access token validity may be a security breach.\nRolling the signing key is always an option, but it’s like a nuclear suicide attack on your users’ sessions.\nEven if you check every token against some kind of storage, this does not mean you are back\nto centralized sessions, you still greatly reduce the number of HTTP calls regarding user identity, privilege and other\ndata you choose to fit into a token.\nLet’s emphasize that again: there is a huge difference between accessing a VALID/INVALID key-value storage with every request versus querying\na set of storages for distributed user-related data, and aggregating them for every request.\nIn a microservice architecture it’s a COLOSSAL, crucial change, which means a difference\nbetween a system that barely crawls and one that performs very well.\nIn an event-driven microservice architecture, you can handle both user log-outs and privilege revocation or stale data\nwith events invalidating corresponding tokens. Generating a new token does not necessarily mean fetching all data again, it depends on the granularity\nof information included in the event.\nDoes it mean latency, possible race conditions, eventual consistency? Well, yeah, just as pretty much everything does nowadays.\nSummary\nAuthorization, authentication, statelessness, revocation, tokens, sessions.\nLots of stuff easy to misunderstand, implement the wrong way, oversimplify and wrongly criticise.\nOAuth, JWT, OpenID Connect, Authorization Code Grant, Implicit Flow, User and Client Credentials, Third-Party Identity Providers,\nDelegated Authorization, Federated Identity Management.\nThat’s again a lot of words and it’s not even a sentence, though a nice SEO booster ;)  We’ve gone more or less through\nall of that, but studying all these terms in detail here was impossible. Should there be at least one thing this article made clear to you and if you\nfeel some misconceptions have been clarified, I’m very happy. If there is at least one comment\nbelow this article which will prove me wrong in some or most of views on this broad subject, I will be\nmore than happy to learn something and exchange opinions. As I’ve mentioned in\nthe beginning of the article, security is not something most of us can study, implement and\nwork with every day. Please feel invited to share your knowledge and experience, also including stuff\nthat looks good on paper, but didn’t work for you in production. I will appreciate it a lot.","guid":"https://blog.allegro.tech/2021/02/oauth-stateless-login.html","categories":["tech","security","oauth","authentication","authorization","jwt","openid-connect"],"isoDate":"2021-01-31T23:00:00.000Z","thumbnail":"images/post-headers/default.png"},{"title":"Impact of data model on MongoDB database size","link":"https://blog.allegro.tech/2021/01/impact-of-the-data-model-on-the-MongoDB-database-size.html","pubDate":"Thu, 14 Jan 2021 00:00:00 +0100","authors":{"author":[{"name":["Michał Knasiecki"],"photo":["https://blog.allegro.tech/img/authors/michal.knasiecki.jpg"],"url":["https://blog.allegro.tech/authors/michal.knasiecki"]}]},"content":"\u003cp\u003eSo I was tuning one of our services in order to speed up some MongoDB queries. Incidentally, my attention was caught by\nthe size of one of the collections that contains archived objects and therefore is rarely used. Unfortunately I wasn’t\nable to reduce the size of the documents stored there, but I started to wonder: is it possible to store the same data\nin a more compact way? Mongo stores \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eJSON\u003c/code\u003e that allows many different ways of expressing similar data, so there seems\nto be room for improvements.\u003c/p\u003e\n\n\u003cp\u003eIt is worth asking: why make such an effort in the era of Big Data and unlimited resources? There are several reasons.\u003c/p\u003e\n\n\u003cp\u003eFirst of all, the resources are not unlimited and at the end we have physical drives that cost money to buy, replace,\nmaintain, and be supplied with power.\u003c/p\u003e\n\n\u003cp\u003eSecondly, less stored data results in less time to access it. Moreover, less data means that more of it will fit into\ncache, so the next data access will be an order of magnitude faster.\u003c/p\u003e\n\n\u003cp\u003eI decided to do some experiments and check how the model design affects the size of database files.\u003c/p\u003e\n\n\u003cp\u003eI used a local MongoDB Community Edition 4.4 installation and I initially tested collections containing 1\nmillion and 10 million documents. One of the variants contained up to 100 million, but the results were proportional\n(nearly linear). Therefore, in the end I decided to stop at 1M collections, because loading the data was simply much faster.\u003c/p\u003e\n\n\u003cp\u003eHaving access to local database files, I could easily check the size of the files storing individual collections.\nHowever, it turned out to be unnecessary, because the same data can be obtained with the command:\u003c/p\u003e\n\n\u003cdiv class=\"language-sql highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetCollection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'COLLECTION_NAME'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003estats\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-01-14-impact-of-the-data-model-on-the-MongoDB-database-size/collection-stats.png\" alt=\"Collection stats\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eThe following fields are expressed in bytes:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003esize\u003c/code\u003e: size of all collection documents, before compression,\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eavgObjSize\u003c/code\u003e: average document size, before compression,\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003estorageSize\u003c/code\u003e: file size on the disk; this is the value after the data is compressed, the same value is returned by\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003els\u003c/code\u003e command,\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003efreeStorageSize\u003c/code\u003e: size of unused space allocated for the data; Mongo does not increase the file size byte-by-byte,\nbut allocates a percentage of the current file size and this value indicates how much data will still fit into the file.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eTo present the results I used (storageSize - freeStorageSize) value that indicates the actual space occupied by the data.\u003c/p\u003e\n\n\u003cp\u003eMy local MongoDB instance had compression enabled. Not every storage engine has this option enabled by default, so when\nyou start your own analysis it is worth checking how it is in your particular case.\u003c/p\u003e\n\n\u003ch3 id=\"id-field-type\"\u003eId field type\u003c/h3\u003e\n\n\u003cp\u003eIn the beginning I decided to check \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eID\u003c/code\u003e fields. Not the collection primary key, mind you – it is ‘ObjectId’ type by\ndefault and generally shouldn’t be changed. I decided to focus on user\nand offers identifiers which, although numerical, are often saved as String in Mongo. I believe it comes partly due to\nthe contract of our services - identifiers in \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eJSON\u003c/code\u003e most often come as Strings and in this form they are later stored\nin our databases.\u003c/p\u003e\n\n\u003cp\u003eLet’s start with some theory: the number of \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eint32\u003c/code\u003e type in Mongo has a fixed size of 4 bytes. The same number\nwritten as a \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eString\u003c/code\u003e of characters has a size dependent on the number of digits; additionally it contains the length of\nthe text (4 bytes) and a terminator character. For example, the text “0” is 12 bytes long and “1234567890” is 25 bytes\nlong. So in theory we should get interesting results, but what does it look like in reality?\u003c/p\u003e\n\n\u003cp\u003eI prepared 2 collections, one million documents each, containing the following documents:\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"_id\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eand\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"_id\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThe values of identifiers were consecutive natural numbers. Here is the comparison of results:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-01-14-impact-of-the-data-model-on-the-MongoDB-database-size/chart-id.png\" alt=\"String vs int32 size\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eAs you can see the difference is significant since the size on disk decreased by half. Additionally, it is worth\nnoting here that my data is synthetic and the identifiers start from 1. The advantage of a numerical identifier over a\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eString\u003c/code\u003e increases the more digits a number has, so benefits should be even better for the real life data.\u003c/p\u003e\n\n\u003cp\u003eEncouraged by the success I decided to check if field type had any influence on the size of an index created on it. In\nthis case, unfortunately, I got disappointed: the sizes were similar. This is due to the fact that MongoDB\nuses a hash function when creating indexes, so physically both indexes are composed of numerical values.\nHowever, if we are dealing with hashing, maybe at least searching by index in a numerical field is faster?\u003c/p\u003e\n\n\u003cp\u003eI made a comparison of searching for a million and 10 million documents by indexed key in a random but the same order\nfor both collections. Again, a missed shot: both tests ended up with a similar result, so the conclusion is this:\nit is worth using numerical identifiers, because they require less disk space, but we will not get additional benefits\nassociated with indexes on these fields.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-01-14-impact-of-the-data-model-on-the-MongoDB-database-size/chart-search-1M.png\" alt=\"String vs int32 search time 1M\" /\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-01-14-impact-of-the-data-model-on-the-MongoDB-database-size/chart-search-10M.png\" alt=\"String vs int32 search time 10M\" /\u003e\u003c/p\u003e\n\n\u003ch3 id=\"simple-and-complex-structures\"\u003eSimple and complex structures\u003c/h3\u003e\n\n\u003cp\u003eLet’s move on to more complex data. Our models are often built from smaller structures grouping data such as user,\norder or offer. I decided to compare the size of documents storing such structures and their flat counterparts:\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"_id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"user\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Jan\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"surname\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Nowak\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eand\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"_id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"userName\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Jan\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"userSurname\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Nowak\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIn both cases we store identical data, the documents differ only in the schema. Take a look at the result:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-01-14-impact-of-the-data-model-on-the-MongoDB-database-size/chart-struct-1.png\" alt=\"complex vs simple size\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eThere is a slight reduction by 0.4MB. It may seem not much compared to the effect we achieved for the field\ncontaining an ID. However, we have to bear in mind that in this case we were dealing with a more complex document. It\ncontained – in addition to the compared fields – a numerical type identifier that, as we remember from previous\nexperiments, takes up about 5MB of disk space.\u003c/p\u003e\n\n\u003cp\u003eTaking this into account in the above results we are talking about a decrease from 3.4MB to 3MB. It actually looks\nbetter as percentage - we saved 12% of the space needed to store personal data.\u003c/p\u003e\n\n\u003cp\u003eLet’s go back to the discussed documents for a moment:\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"_id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"user\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Jan\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"surname\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Nowak\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eand\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"_id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"userName\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Jan\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"userSurname\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Nowak\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eA watchful eye will notice that I used longer field names in the document after flattening. So instead of \u003ccode class=\"language-plaintext highlighter-rouge\"\u003euser.name\u003c/code\u003e\nand \u003ccode class=\"language-plaintext highlighter-rouge\"\u003euser.surname\u003c/code\u003e I made \u003ccode class=\"language-plaintext highlighter-rouge\"\u003euserName\u003c/code\u003e and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003euserSurname\u003c/code\u003e. I did it automatically, a bit unconsciously, to make the\nresulting \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eJSON\u003c/code\u003e more readable.  However, if by changing only the schema of the document from compound to flat we managed\nto reduce the size of the data, maybe it is worth to go a step further and shorten the field names?\u003c/p\u003e\n\n\u003cp\u003eI decided to add a third document for comparison, flattened and with shorter field names:\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"_id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Jan\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"surname\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Nowak\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThe results are shown in the chart below:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-01-14-impact-of-the-data-model-on-the-MongoDB-database-size/chart-struct-2.png\" alt=\"complex vs simple vs short size\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eThe result is even better than just flattening. Apart from the document’s key size, we achieved a decrease from\n3.4MB to 2MB. Why does this happen even though we store exactly the same data?\u003c/p\u003e\n\n\u003cp\u003eThe reason for the decrease is the nature of NoSQL databases that, unlike the relational ones, do not have a schema\ndefined at the level of the entire collection. If someone is very stubborn, they can store user data, offers, orders and\npayments in one collection. It would still be possible to read, index and search that data. This is because the\ndatabase, in addition to the data itself, stores its schema with each document. Thus, the total size of a document\nconsists of its data and its schema. And that explains the whole puzzle. By reducing the size of the schema, we also\nreduce the size of each document, i.e. the size of the final file with the collection data. It is worth taking this into\naccount when designing a collection schema in order not to blow it up too much. Of course, you cannot go to extremes, because\nthat would lead us to fields named \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ea\u003c/code\u003e, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eb\u003c/code\u003e and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ec\u003c/code\u003e, what would make the collection completely illegible for a human.\u003c/p\u003e\n\n\u003cp\u003eFor very large collections, however, this approach is used, an example of which is the MongoDB operation log\nthat contains fields called:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eh\u003c/li\u003e\n  \u003cli\u003eop\u003c/li\u003e\n  \u003cli\u003ens\u003c/li\u003e\n  \u003cli\u003eo\u003c/li\u003e\n  \u003cli\u003eo2\u003c/li\u003e\n  \u003cli\u003eb\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3 id=\"empty-fields\"\u003eEmpty fields\u003c/h3\u003e\n\n\u003cp\u003eSince we are at the document’s schema, it is still worth looking at the problem of blank fields. In the case of\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eJSON\u003c/code\u003e the lack of value in a certain field can be written in two ways, either directly - by writing null in its value -\nor by not serializing the field at all. I prepared a comparison of documents with the following structure:\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eand\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"phone\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThe meaning of the data in both documents is identical - the user has no phone number. However, the schema of the second\ndocument is different from the first one because it contains two fields.\u003c/p\u003e\n\n\u003cp\u003eHere are the results:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-01-14-impact-of-the-data-model-on-the-MongoDB-database-size/chart-null.png\" alt=\"null vs empty size\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eThe results are quite surprising: saving a million null’s is quite expensive as it takes more than 1MB on a disk.\u003c/p\u003e\n\n\u003ch3 id=\"enumerated-types\"\u003eEnumerated types\u003c/h3\u003e\n\n\u003cp\u003eNow, let’s also look at the enumerated types. You can store them in two ways, either by using a label:\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"_id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"source\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"ALLEGRO\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eor by ordinal value:\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"_id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"source\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eHere an analogy with the first experiment can be found: again we replace a character string with a numerical value.\nSince we got a great result the first time, maybe we could repeat it here?\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-01-14-impact-of-the-data-model-on-the-MongoDB-database-size/chart-enums-1.png\" alt=\"label vs index size\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eUnfortunately, the result is disappointing and the reduction in size is small. However, if we think more deeply, we will\ncome to the conclusion that it could not have been otherwise. The enumerated types are not unique identifiers. We are\ndealing only with a few possible values, appearing many times in the whole collection, so it’s a great chance for\nMongoDB data compression to prove its worth. Most likely the values from the first collection have been automatically replaced by the\nengine to its corresponding ordinal values. Additionally, we don’t have any profit on the schema here, because they are\nthe same in both cases. The situation might be different for collections that do not have data compression enabled.\u003c/p\u003e\n\n\u003cp\u003eThis is a good time to take a closer look at how \u003ca href=\"https://www.mongodb.com/blog/post/new-compression-options-mongodb-30\"\u003esnappy\u003c/a\u003e\ncompression works in MongoDB. I’ve prepared two more collections, with identical data, but with data compression\nturned off. The results are shown in the chart below, compiled together with the collections with data compression turned on.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-01-14-impact-of-the-data-model-on-the-MongoDB-database-size/chart-enums-2.png\" alt=\"snappy vs plain size\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eIt is clear that the use of an ordinal value instead of a label of the enumerated type brings considerable profit for\ncollections with data compression disabled. In case of lack of compression it is definitely worth considering using numerical\nvalues.\u003c/p\u003e\n\n\u003ch3 id=\"useless-_class-field\"\u003eUseless _class field\u003c/h3\u003e\n\n\u003cp\u003eIf we use \u003ccode class=\"language-plaintext highlighter-rouge\"\u003espring-data\u003c/code\u003e, each of our collections additionally contains a \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e_class\u003c/code\u003e field storing the package and the\nname of the entity class containing the mapping for documents from this collection. This mechanism is used to support\ninheritance of model classes, that is not widely used. In most cases this field stores exactly the same values for each\ndocument what makes it useless. And how much does it cost? Let’s compare the following documents:\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"_id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eand\u003c/p\u003e\n\n\u003cdiv class=\"language-json highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"_id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"_class\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"pl.allegro.some.project.domain.sample\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-01-14-impact-of-the-data-model-on-the-MongoDB-database-size/chart-class.png\" alt=\"_class field size\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eThe difference is considerable, over 50%. Bearing in mind that the compression is enabled, I believe that the impact of\nthe data itself is small and the result is caused by the schema of the collection containing only the key being half as small\nas the one with the key (1 field vs 2 fields). After removal of the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e_class\u003c/code\u003e field from a document with more fields,\nthe difference expressed in percent will be much smaller of course. However, storing useless data does not make sense.\u003c/p\u003e\n\n\u003ch3 id=\"useless-indexes\"\u003eUseless indexes\u003c/h3\u003e\n\n\u003cp\u003eWhen investigating the case with identifiers stored as strings, I checked whether manipulating the data type could reduce\nthe index size. Unfortunately I did not succeed, so I decided to focus on the problem of redundant indexes.\u003c/p\u003e\n\n\u003cp\u003eIt is usually a good practice to cover each query with an index so that the number of \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ecollscan\u003c/code\u003e operations is as small as\npossible. This often leads to situations where we have too many indexes. We add more queries, create new indexes for\nthem, and often it turns out that this newly created index takes over the queries of another one.\nAs a result, we have to maintain many unnecessary indexes, wasting disk space and CPU time.\u003c/p\u003e\n\n\u003cp\u003eFortunately, it is possible to check the number of index uses with the query:\u003c/p\u003e\n\n\u003cdiv class=\"language-sql highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCOLLECTION_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eaggregate\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"err\"\u003e{$\u003c/span\u003e\u003cspan class=\"n\"\u003eindexStats\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"err\"\u003e{}}\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIt allows you to find indexes that are not used so you can safely delete them.\u003c/p\u003e\n\n\u003cp\u003eAnd finally, one more thing. Indexes can be removed quickly, but they take much longer to rebuild. This means that the\nconsequences of removal of an index by mistake can be severe. Therefore it is better to make sure that the index to be\ndeleted is definitely not used by any query. The latest MongoDB 4.4 provides a command that helps to avoid errors:\u003c/p\u003e\n\n\u003cdiv class=\"language-sql highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCOLLECTION_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehideIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eindex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThe above-mentioned command hides the index from the query optimizer. It does not take this index into account when\nbuilding the query execution plan, but the index is still updated when modifying documents. Thanks to that, if it turns\nout that it was needed, we are able to restore it immediately and it will still be up-to-date.\u003c/p\u003e\n\n\u003ch3 id=\"conclusion\"\u003eConclusion\u003c/h3\u003e\n\n\u003cp\u003eUsing a few simple techniques, preparing several versions of the schema and using stats() command we are able to design\na model which does not overload our infrastructure. I encourage you to experiment with your own databases. Maybe you too\ncan save some disk space and CPU time.\u003c/p\u003e\n","contentSnippet":"So I was tuning one of our services in order to speed up some MongoDB queries. Incidentally, my attention was caught by\nthe size of one of the collections that contains archived objects and therefore is rarely used. Unfortunately I wasn’t\nable to reduce the size of the documents stored there, but I started to wonder: is it possible to store the same data\nin a more compact way? Mongo stores JSON that allows many different ways of expressing similar data, so there seems\nto be room for improvements.\nIt is worth asking: why make such an effort in the era of Big Data and unlimited resources? There are several reasons.\nFirst of all, the resources are not unlimited and at the end we have physical drives that cost money to buy, replace,\nmaintain, and be supplied with power.\nSecondly, less stored data results in less time to access it. Moreover, less data means that more of it will fit into\ncache, so the next data access will be an order of magnitude faster.\nI decided to do some experiments and check how the model design affects the size of database files.\nI used a local MongoDB Community Edition 4.4 installation and I initially tested collections containing 1\nmillion and 10 million documents. One of the variants contained up to 100 million, but the results were proportional\n(nearly linear). Therefore, in the end I decided to stop at 1M collections, because loading the data was simply much faster.\nHaving access to local database files, I could easily check the size of the files storing individual collections.\nHowever, it turned out to be unnecessary, because the same data can be obtained with the command:\n\ndb.getCollection('COLLECTION_NAME').stats()\n\n\n\nThe following fields are expressed in bytes:\nsize: size of all collection documents, before compression,\navgObjSize: average document size, before compression,\nstorageSize: file size on the disk; this is the value after the data is compressed, the same value is returned by\nls command,\nfreeStorageSize: size of unused space allocated for the data; Mongo does not increase the file size byte-by-byte,\nbut allocates a percentage of the current file size and this value indicates how much data will still fit into the file.\nTo present the results I used (storageSize - freeStorageSize) value that indicates the actual space occupied by the data.\nMy local MongoDB instance had compression enabled. Not every storage engine has this option enabled by default, so when\nyou start your own analysis it is worth checking how it is in your particular case.\nId field type\nIn the beginning I decided to check ID fields. Not the collection primary key, mind you – it is ‘ObjectId’ type by\ndefault and generally shouldn’t be changed. I decided to focus on user\nand offers identifiers which, although numerical, are often saved as String in Mongo. I believe it comes partly due to\nthe contract of our services - identifiers in JSON most often come as Strings and in this form they are later stored\nin our databases.\nLet’s start with some theory: the number of int32 type in Mongo has a fixed size of 4 bytes. The same number\nwritten as a String of characters has a size dependent on the number of digits; additionally it contains the length of\nthe text (4 bytes) and a terminator character. For example, the text “0” is 12 bytes long and “1234567890” is 25 bytes\nlong. So in theory we should get interesting results, but what does it look like in reality?\nI prepared 2 collections, one million documents each, containing the following documents:\n\n{ \"_id\" : 1 }\n\n\nand\n\n{ \"_id\" : \"1\" }\n\n\nThe values of identifiers were consecutive natural numbers. Here is the comparison of results:\n\nAs you can see the difference is significant since the size on disk decreased by half. Additionally, it is worth\nnoting here that my data is synthetic and the identifiers start from 1. The advantage of a numerical identifier over a\nString increases the more digits a number has, so benefits should be even better for the real life data.\nEncouraged by the success I decided to check if field type had any influence on the size of an index created on it. In\nthis case, unfortunately, I got disappointed: the sizes were similar. This is due to the fact that MongoDB\nuses a hash function when creating indexes, so physically both indexes are composed of numerical values.\nHowever, if we are dealing with hashing, maybe at least searching by index in a numerical field is faster?\nI made a comparison of searching for a million and 10 million documents by indexed key in a random but the same order\nfor both collections. Again, a missed shot: both tests ended up with a similar result, so the conclusion is this:\nit is worth using numerical identifiers, because they require less disk space, but we will not get additional benefits\nassociated with indexes on these fields.\n\n\nSimple and complex structures\nLet’s move on to more complex data. Our models are often built from smaller structures grouping data such as user,\norder or offer. I decided to compare the size of documents storing such structures and their flat counterparts:\n\n{\"_id\": 1, \"user\": {\"name\": \"Jan\", \"surname\": \"Nowak\"}}\n\n\nand\n\n{\"_id\": 1, \"userName\": \"Jan\", \"userSurname\": \"Nowak\"}\n\n\nIn both cases we store identical data, the documents differ only in the schema. Take a look at the result:\n\nThere is a slight reduction by 0.4MB. It may seem not much compared to the effect we achieved for the field\ncontaining an ID. However, we have to bear in mind that in this case we were dealing with a more complex document. It\ncontained – in addition to the compared fields – a numerical type identifier that, as we remember from previous\nexperiments, takes up about 5MB of disk space.\nTaking this into account in the above results we are talking about a decrease from 3.4MB to 3MB. It actually looks\nbetter as percentage - we saved 12% of the space needed to store personal data.\nLet’s go back to the discussed documents for a moment:\n\n{\"_id\": 1, \"user\": {\"name\": \"Jan\", \"surname\": \"Nowak\"}}\n\n\nand\n\n{\"_id\": 1, \"userName\": \"Jan\", \"userSurname\": \"Nowak\"}\n\n\nA watchful eye will notice that I used longer field names in the document after flattening. So instead of user.name\nand user.surname I made userName and userSurname. I did it automatically, a bit unconsciously, to make the\nresulting JSON more readable.  However, if by changing only the schema of the document from compound to flat we managed\nto reduce the size of the data, maybe it is worth to go a step further and shorten the field names?\nI decided to add a third document for comparison, flattened and with shorter field names:\n\n{\"_id\": 1, \"name\": \"Jan\", \"surname\": \"Nowak\"}\n\n\nThe results are shown in the chart below:\n\nThe result is even better than just flattening. Apart from the document’s key size, we achieved a decrease from\n3.4MB to 2MB. Why does this happen even though we store exactly the same data?\nThe reason for the decrease is the nature of NoSQL databases that, unlike the relational ones, do not have a schema\ndefined at the level of the entire collection. If someone is very stubborn, they can store user data, offers, orders and\npayments in one collection. It would still be possible to read, index and search that data. This is because the\ndatabase, in addition to the data itself, stores its schema with each document. Thus, the total size of a document\nconsists of its data and its schema. And that explains the whole puzzle. By reducing the size of the schema, we also\nreduce the size of each document, i.e. the size of the final file with the collection data. It is worth taking this into\naccount when designing a collection schema in order not to blow it up too much. Of course, you cannot go to extremes, because\nthat would lead us to fields named a, b and c, what would make the collection completely illegible for a human.\nFor very large collections, however, this approach is used, an example of which is the MongoDB operation log\nthat contains fields called:\nh\n  \nop\nns\no\n  \no2\nb\n\n\nEmpty fields\nSince we are at the document’s schema, it is still worth looking at the problem of blank fields. In the case of\nJSON the lack of value in a certain field can be written in two ways, either directly - by writing null in its value -\nor by not serializing the field at all. I prepared a comparison of documents with the following structure:\n\n{ \"id\" : 1 }\n\n\nand\n\n{ \"id\" : 1, \"phone\" : null}\n\n\nThe meaning of the data in both documents is identical - the user has no phone number. However, the schema of the second\ndocument is different from the first one because it contains two fields.\nHere are the results:\n\nThe results are quite surprising: saving a million null’s is quite expensive as it takes more than 1MB on a disk.\nEnumerated types\nNow, let’s also look at the enumerated types. You can store them in two ways, either by using a label:\n\n{\"_id\": 1, \"source\": \"ALLEGRO\"}\n\n\nor by ordinal value:\n\n{\"_id\": 1, \"source\": 1}\n\n\nHere an analogy with the first experiment can be found: again we replace a character string with a numerical value.\nSince we got a great result the first time, maybe we could repeat it here?\n\nUnfortunately, the result is disappointing and the reduction in size is small. However, if we think more deeply, we will\ncome to the conclusion that it could not have been otherwise. The enumerated types are not unique identifiers. We are\ndealing only with a few possible values, appearing many times in the whole collection, so it’s a great chance for\nMongoDB data compression to prove its worth. Most likely the values from the first collection have been automatically replaced by the\nengine to its corresponding ordinal values. Additionally, we don’t have any profit on the schema here, because they are\nthe same in both cases. The situation might be different for collections that do not have data compression enabled.\nThis is a good time to take a closer look at how snappy\ncompression works in MongoDB. I’ve prepared two more collections, with identical data, but with data compression\nturned off. The results are shown in the chart below, compiled together with the collections with data compression turned on.\n\nIt is clear that the use of an ordinal value instead of a label of the enumerated type brings considerable profit for\ncollections with data compression disabled. In case of lack of compression it is definitely worth considering using numerical\nvalues.\nUseless _class field\nIf we use spring-data, each of our collections additionally contains a _class field storing the package and the\nname of the entity class containing the mapping for documents from this collection. This mechanism is used to support\ninheritance of model classes, that is not widely used. In most cases this field stores exactly the same values for each\ndocument what makes it useless. And how much does it cost? Let’s compare the following documents:\n\n{\"_id\": 1}\n\n\nand\n\n{\"_id\": 1, \"_class\": \"pl.allegro.some.project.domain.sample\"}\n\n\n\nThe difference is considerable, over 50%. Bearing in mind that the compression is enabled, I believe that the impact of\nthe data itself is small and the result is caused by the schema of the collection containing only the key being half as small\nas the one with the key (1 field vs 2 fields). After removal of the _class field from a document with more fields,\nthe difference expressed in percent will be much smaller of course. However, storing useless data does not make sense.\nUseless indexes\nWhen investigating the case with identifiers stored as strings, I checked whether manipulating the data type could reduce\nthe index size. Unfortunately I did not succeed, so I decided to focus on the problem of redundant indexes.\nIt is usually a good practice to cover each query with an index so that the number of collscan operations is as small as\npossible. This often leads to situations where we have too many indexes. We add more queries, create new indexes for\nthem, and often it turns out that this newly created index takes over the queries of another one.\nAs a result, we have to maintain many unnecessary indexes, wasting disk space and CPU time.\nFortunately, it is possible to check the number of index uses with the query:\n\ndb.COLLECTION_NAME.aggregate([{$indexStats:{}}])\n\n\nIt allows you to find indexes that are not used so you can safely delete them.\nAnd finally, one more thing. Indexes can be removed quickly, but they take much longer to rebuild. This means that the\nconsequences of removal of an index by mistake can be severe. Therefore it is better to make sure that the index to be\ndeleted is definitely not used by any query. The latest MongoDB 4.4 provides a command that helps to avoid errors:\n\ndb.COLLECTION_NAME.hideIndex(\u003cindex\u003e)\n\n\nThe above-mentioned command hides the index from the query optimizer. It does not take this index into account when\nbuilding the query execution plan, but the index is still updated when modifying documents. Thanks to that, if it turns\nout that it was needed, we are able to restore it immediately and it will still be up-to-date.\nConclusion\nUsing a few simple techniques, preparing several versions of the schema and using stats() command we are able to design\na model which does not overload our infrastructure. I encourage you to experiment with your own databases. Maybe you too\ncan save some disk space and CPU time.","guid":"https://blog.allegro.tech/2021/01/impact-of-the-data-model-on-the-MongoDB-database-size.html","categories":["mongodb"],"isoDate":"2021-01-13T23:00:00.000Z","thumbnail":"images/post-headers/mongodb.png"},{"title":"Speeding up warm builds in Xcode","link":"https://blog.allegro.tech/2020/12/speeding-up-warm-builds.html","pubDate":"Mon, 28 Dec 2020 00:00:00 +0100","authors":{"author":[{"name":["Maciej Piotrowski"],"photo":["https://blog.allegro.tech/img/authors/maciej.piotrowski.jpg"],"url":["https://blog.allegro.tech/authors/maciej.piotrowski"]}]},"content":"\u003cp\u003eProgrammers who have ever developed software for Apple platforms in the early days of \u003cstrong\u003eSwift\u003c/strong\u003e language might remember ridiculous\ntimes it took to compile the whole project. For large and complicated codebase times used to range from 10 up to 40 minutes.\nOver the years our toolset has improved alongside with compilation times, but slow build times of source code can still be a nightmare.\u003c/p\u003e\n\n\u003cp\u003eWhen we wait a few minutes for a build, we navigate ourselves towards different activities and start e.g. watching funny animal pictures or\nYouTube videos, easily \u003cstrong\u003eloosing context\u003c/strong\u003e of the task at hand. What becomes annoying for us is \u003cstrong\u003eslow feedback\u003c/strong\u003e of code correctness.\u003c/p\u003e\n\n\u003cp\u003eIn the \u003ca href=\"https://allegro.tech/2020/12/speeding-up-ios-builds-with-bazel.html\"\u003epast issue\u003c/a\u003e my colleague has written about a solution\nto slow \u003cstrong\u003eclean\u003c/strong\u003e builds.In this post I will focus on \u003cstrong\u003ewarm\u003c/strong\u003e builds improvement.\u003c/p\u003e\n\n\u003ch2 id=\"clean-and-incremental-builds\"\u003eClean and incremental builds\u003c/h2\u003e\n\n\u003cp\u003eThere are two terms used in the realm of \u003ca href=\"https://developer.apple.com/xcode/\"\u003eXcode\u003c/a\u003e when it comes to distinguishing types of\ncompilation: \u003cstrong\u003eclean\u003c/strong\u003e and \u003cstrong\u003eincremental\u003c/strong\u003e build. The first refers to the time it takes to build a project from scratch. The latter is the time\nit takes to build only whatever changed since the last build and to integrate the changes into a build product.\u003c/p\u003e\n\n\u003cp\u003eYou might also be familiar with the term \u003cstrong\u003ewarm\u003c/strong\u003e build. It’s used interchangeably with \u003cstrong\u003eincremental\u003c/strong\u003e build term, but for the sake of this\npost I will be using it to refer to \u003cem\u003ethe time it takes to build a product since the last clean build without introducing any source code\nchanges\u003c/em\u003e.\u003c/p\u003e\n\n\u003ch2 id=\"why-and-what-for\"\u003eWhy and what for\u003c/h2\u003e\n\n\u003cp\u003eWhy bothering with improving \u003cstrong\u003ewarm\u003c/strong\u003e build times? Well, for a small projects built on super fast workstations it might take a fraction of a\nsecond to do a warm build, but as projects grow and multiple \u003cem\u003eBuild Phases\u003c/em\u003e get added to a target so grow the build times. These times\nare noticeable especially when one builds the target without an introduction of changes to the source code.\u003c/p\u003e\n\n\u003cp\u003eBefore we started improving the warm build of the Allegro app for iOS platform it took 18 seconds to perform the build on our\nContinuous Integration (CI) servers (Mac Mini, 6-Core 3.2 GHz CPU, 32 GB Ram).\u003c/p\u003e\n\n\u003cp\u003eIs 18 seconds too much? When you put it into a perspective of 1 year:\u003c/p\u003e\n\n\u003cblockquote\u003e\n  \u003cp\u003e18 seconds × 6 builds per hour × 8 hours per day × 20 days per month × 12 months per year = 207360 seconds = 3456 minutes = 57\nhours 36 minutes\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eIt means that on average a programmer spends around 57 hours 36 minutes yearly to wait for a feedback if their code is correct. Is it\nmuch? I leave the answer to you, but it definitely hinders developer’s experience and distracts the developer from their job.\u003c/p\u003e\n\n\u003cp\u003eTo make the developer’s experience better, we, the iOS Mobile Core Team at Allegro, have set the goal to minimize the time developers\nspend between hitting the build button and getting the feedback on their code as quickly as possible.\u003c/p\u003e\n\n\u003cp\u003eHow could the goal be achieved? Well, before I answer that, let’s put some light onto how to actually measure build times.\u003c/p\u003e\n\n\u003ch2 id=\"measurements\"\u003eMeasurements\u003c/h2\u003e\n\n\u003cp\u003eDevelopers building software for Apple platforms use the \u003ca href=\"https://developer.apple.com/xcode/\"\u003eXcode\u003c/a\u003e application which has a command\nline interface called \u003ccode class=\"language-plaintext highlighter-rouge\"\u003excodebuild\u003c/code\u003e. The Xcode has an option to output times for build phases from the menu\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eProduct \u0026gt; Perform Action \u0026gt; Build With Timing Summary\u003c/code\u003e (doesn’t seem to work on Xcode 12.2 at the time of writing this\nblog post). To get build times with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003excodebuild\u003c/code\u003e for our Allegro app for each build phase of the main target the following command\ncan be used:\u003c/p\u003e\n\n\u003cdiv class=\"language-sh highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003excodebuild \u003cspan class=\"nt\"\u003e-workspace\u003c/span\u003e \u003cspan class=\"s1\"\u003e'Allegro/Allegro.xcworkspace'\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e-scheme\u003c/span\u003e \u003cspan class=\"s1\"\u003e'Allegro'\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e-configuration\u003c/span\u003e \u003cspan class=\"s1\"\u003e'Debug'\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e-sdk\u003c/span\u003e \u003cspan class=\"s1\"\u003e'iphonesimulator'\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e-arch\u003c/span\u003e \u003cspan class=\"s1\"\u003e'x86_64'\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e-showBuildTimingSummary\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\nbuild \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n| \u003cspan class=\"nb\"\u003esed\u003c/span\u003e \u003cspan class=\"nt\"\u003e-n\u003c/span\u003e \u003cspan class=\"nt\"\u003e-e\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/Build Timing Summary/,$p'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIn the case of the Allegro app it outputs the following lines when I do a \u003cstrong\u003eclean\u003c/strong\u003e build with Xcode 12.2’s \u003ccode class=\"language-plaintext highlighter-rouge\"\u003excodebuild\u003c/code\u003e\n(Mac Book Pro 2.2 GHz 6-Core Intel Core i7 CPU, 32 GB RAM):\u003c/p\u003e\n\n\u003cdiv class=\"language-sh highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003eBuild Timing Summary\n\nCompileC \u003cspan class=\"o\"\u003e(\u003c/span\u003e49 tasks\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 174.459 seconds\n\nCompileSwiftSources \u003cspan class=\"o\"\u003e(\u003c/span\u003e3 tasks\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 31.747 seconds\n\nCompileStoryboard \u003cspan class=\"o\"\u003e(\u003c/span\u003e6 tasks\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 29.057 seconds\n\nPhaseScriptExecution \u003cspan class=\"o\"\u003e(\u003c/span\u003e8 tasks\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 22.320 seconds\n\nDitto \u003cspan class=\"o\"\u003e(\u003c/span\u003e21 tasks\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 22.282 seconds\n\nLd \u003cspan class=\"o\"\u003e(\u003c/span\u003e3 tasks\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 13.432 seconds\n\nCompileAssetCatalog \u003cspan class=\"o\"\u003e(\u003c/span\u003e1 task\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 6.620 seconds\n\nValidateEmbeddedBinary \u003cspan class=\"o\"\u003e(\u003c/span\u003e2 tasks\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 6.528 seconds\n\nCompileXIB \u003cspan class=\"o\"\u003e(\u003c/span\u003e1 task\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 5.000 seconds\n\nCodeSign \u003cspan class=\"o\"\u003e(\u003c/span\u003e3 tasks\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 1.419 seconds\n\nCopyPNGFile \u003cspan class=\"o\"\u003e(\u003c/span\u003e3 tasks\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 1.236 seconds\n\nTouch \u003cspan class=\"o\"\u003e(\u003c/span\u003e4 tasks\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 0.318 seconds\n\nLibtool \u003cspan class=\"o\"\u003e(\u003c/span\u003e1 task\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 0.241 seconds\n\nLinkStoryboards \u003cspan class=\"o\"\u003e(\u003c/span\u003e2 tasks\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 0.108 seconds\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThere’s a lot of tasks. When it comes to source code compilation process, we can lower down build times by splitting the source code\ninto modular frameworks, using binary caching techniques and adding explicit types for expressions in Swift.\u003c/p\u003e\n\n\u003cp\u003eIn the case of a \u003cstrong\u003ewarm build\u003c/strong\u003e the only phases listed are:\u003c/p\u003e\n\n\u003cdiv class=\"language-sh highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003eBuild Timing Summary\n\nPhaseScriptExecution \u003cspan class=\"o\"\u003e(\u003c/span\u003e6 tasks\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 23.350 seconds\n\nValidateEmbeddedBinary \u003cspan class=\"o\"\u003e(\u003c/span\u003e2 tasks\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 2.424 seconds\n\n\u003cspan class=\"k\"\u003e**\u003c/span\u003e BUILD SUCCEEDED \u003cspan class=\"k\"\u003e**\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e27.238 sec]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThanks to performing the \u003cstrong\u003ewarm build\u003c/strong\u003e it can be easily noticed that there’s a room for improvement when it comes to\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePhaseScriptExecution\u003c/code\u003e part of the build process. This is actually the part over which we have the control of. Let’s see, what we can\ndo in order to speed up the build time by playing with what and how scripts get executed.\u003c/p\u003e\n\n\u003ch2 id=\"cleaning-up-run-scripts\"\u003eCleaning up run scripts\u003c/h2\u003e\n\n\u003cp\u003eFirst thing we did with for our iOS application target was selecting scripts which can be run only for Release builds. There’s an easy way\nin Xcode to mark them as runnable for such builds only - just select \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eFor install builds only\u003c/code\u003e checkbox.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2020-12-28-speeding-up-warm-builds/xcode-run-for-release.png\" alt=\"Run script: For install builds only - checkbox in Xcode\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eWhat jobs are great for running only for Release builds? We selected a few:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003euploading debug symbols to 3rd party monitoring services\u003c/li\u003e\n  \u003cli\u003esetting endpoints or enabling Apple Transport Security (ATS) for Debug/Release builds\u003c/li\u003e\n  \u003cli\u003eselecting proper \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.plist\u003c/code\u003e files for Debug/Release builds\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eNot all tasks can be selected as Release - only. Some of them need to be run for Debug and Release builds, but they don’t have to be\nrun for every build. Xcode 12 introduced a neat feature - running the script based on dependency analysis.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2020-12-28-speeding-up-warm-builds/xcode-dependency-analysis.png\" alt=\"Run script: Based on dependency analysis - checkbox in Xcode\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eSelecting the checkbox isn’t enough to benefit from dependency analysis. Xcode analyses dependencies of a script, i.e. it verifies if the\ninputs of the script have changed since the last run and if the outputs of the script exist. The potential problem occurred for scripts in our\nproject - they didn’t have explicit inputs and outputs defined so we couldn’t tap into the brand new feature of Xcode.\u003c/p\u003e\n\n\u003ch2 id=\"defining-inputs-and-outputs-for-scripts\"\u003eDefining inputs and outputs for scripts\u003c/h2\u003e\n\n\u003cp\u003eOne of the scripts in our project which is time-consuming copies bundles with resources of each module. Our Xcode workspace consists\nof multiple projects. The main project contains the application target which depends on modules built by other projects. The projects\ncontain static frameworks with resources. The resources for each framework are wrapped in \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.bundle\u003c/code\u003e wrapper and are embedded in\nthe framework. All frameworks are linked statically to the application and their bundles are copied by the script to the application\nwrapper (\u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.app\u003c/code\u003e).\u003c/p\u003e\n\n\u003cp\u003eThe list with \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.bundle\u003c/code\u003e files to be copied became an input to our script. We also created a list with paths to which bundles are copied.\nXcode uses a \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e.xcfilelist\u003c/code\u003e format for such lists, but it’s just a file with newline-separated values. The\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ecopy-bundles-input.xcfilelist\u003c/code\u003e input to our script looks as such:\u003c/p\u003e\n\n\u003cdiv class=\"language-sh highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"si\"\u003e$(\u003c/span\u003eBUILT_PRODUCTS_DIR\u003cspan class=\"si\"\u003e)\u003c/span\u003e/ModuleX.framework/ModuleX.bundle\n\u003cspan class=\"si\"\u003e$(\u003c/span\u003eBUILT_PRODUCTS_DIR\u003cspan class=\"si\"\u003e)\u003c/span\u003e/ModuleY.framework/ModuleY.bundle\n\u003cspan class=\"si\"\u003e$(\u003c/span\u003eBUILT_PRODUCTS_DIR\u003cspan class=\"si\"\u003e)\u003c/span\u003e/ModuleZ.framework/ModuleZ.bundle\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eand the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ecopy-bundles-output.xcfilelist\u003c/code\u003e output:\u003c/p\u003e\n\n\u003cdiv class=\"language-sh highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"si\"\u003e$(\u003c/span\u003eTARGET_BUILD_DIR\u003cspan class=\"si\"\u003e)\u003c/span\u003e/\u003cspan class=\"si\"\u003e$(\u003c/span\u003eEXECUTABLE_FOLDER_PATH\u003cspan class=\"si\"\u003e)\u003c/span\u003e/ModuleX.bundle\n\u003cspan class=\"si\"\u003e$(\u003c/span\u003eTARGET_BUILD_DIR\u003cspan class=\"si\"\u003e)\u003c/span\u003e/\u003cspan class=\"si\"\u003e$(\u003c/span\u003eEXECUTABLE_FOLDER_PATH\u003cspan class=\"si\"\u003e)\u003c/span\u003e/ModuleY.bundle\n\u003cspan class=\"si\"\u003e$(\u003c/span\u003eTARGET_BUILD_DIR\u003cspan class=\"si\"\u003e)\u003c/span\u003e/\u003cspan class=\"si\"\u003e$(\u003c/span\u003eEXECUTABLE_FOLDER_PATH\u003cspan class=\"si\"\u003e)\u003c/span\u003e/ModuleZ.bundle\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eFile lists can be accessed in a script through environment variables. Each script can have many of them and they are indexed from 0:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eSCRIPT_INPUT_FILE_LIST_0\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e…\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eSCRIPT_INPUT_FILE_LIST_1024\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eSCRIPT_OUTPUT_FILE_LIST_0\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e…\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eSCRIPT_OUTPUT_FILE_LIST_1024\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThere is also a possibility to use input and output files instead of a list (not shown on the screens):\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eSCRIPT_INPUT_FILE_0\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e…\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eSCRIPT_INPUT_FILE_1024\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eSCRIPT_OUTPUT_FILE_0\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003e…\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eSCRIPT_OUTPUT_FILE_1024\u003c/code\u003e\u003c/li\u003e\n  \u003cli\u003eand additionally the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eSCRIPT_INPUT_FILE_COUNT\u003c/code\u003e and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eSCRIPT_OUTPUT_FILE_COUNT\u003c/code\u003e can be used\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWe based our script copying resource bundles only on file lists and it’s actually quite simple - it just copies files from the\ninput file list to the destination which is the path to the executable.\u003c/p\u003e\n\n\u003cdiv class=\"language-sh highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003edestination\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eTARGET_BUILD_DIR\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e/\u003c/span\u003e\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eEXECUTABLE_FOLDER_PATH\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\n\u003cspan class=\"nb\"\u003egrep\u003c/span\u003e \u003cspan class=\"nt\"\u003e-v\u003c/span\u003e \u003cspan class=\"s1\"\u003e'^ *#'\u003c/span\u003e \u0026lt; \u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eSCRIPT_INPUT_FILE_LIST_0\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e | \u003cspan class=\"k\"\u003ewhile \u003c/span\u003e\u003cspan class=\"nv\"\u003eIFS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eread\u003c/span\u003e \u003cspan class=\"nt\"\u003e-r\u003c/span\u003e bundle_path\n\u003cspan class=\"k\"\u003edo\n    if\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"nt\"\u003e-d\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"nv\"\u003e$bundle_path\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\n        \u003c/span\u003ersync \u003cspan class=\"nt\"\u003e-auv\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003ebundle_path\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003edestination\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"nb\"\u003eexit \u003c/span\u003e1\n    \u003cspan class=\"k\"\u003efi\ndone\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIn the end we tapped into using Xcode’s dependency analysis for a few run scripts and it allowed us to improve warm build time.\u003c/p\u003e\n\n\u003cdiv class=\"language-sh highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003eBuild Timing Summary\n\nPhaseScriptExecution \u003cspan class=\"o\"\u003e(\u003c/span\u003e6 tasks\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 3.666 seconds\n\nValidateEmbeddedBinary \u003cspan class=\"o\"\u003e(\u003c/span\u003e2 tasks\u003cspan class=\"o\"\u003e)\u003c/span\u003e | 2.314 seconds\n\n\u003cspan class=\"k\"\u003e**\u003c/span\u003e BUILD SUCCEEDED \u003cspan class=\"k\"\u003e**\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e7.500 sec]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2020-12-28-speeding-up-warm-builds/warm-build-graph.png\" alt=\"Allegro iOS - graph depicting Warm Build Time change over months\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eAt the time of writing the \u003cstrong\u003ewarm build time\u003c/strong\u003e on our CI machines takes \u003cstrong\u003e4 seconds\u003c/strong\u003e. The overall goal of speeding up builds is so that\nthe \u003cstrong\u003eclean build\u003c/strong\u003e time becomes equal to \u003cstrong\u003ewarm build\u003c/strong\u003e.\u003c/p\u003e\n\n\u003ch2 id=\"links\"\u003eLinks\u003c/h2\u003e\n\n\u003cp\u003eSome useful links related to improving compilation times for Xcode projects:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ca href=\"https://www.onswiftwings.com/posts/build-time-optimization-part1/\"\u003eXcode Build Time Optimization - Part 1\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"https://www.onswiftwings.com/posts/build-time-optimization-part2/\"\u003eXcode Build Time Optimization - Part 2\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"https://eisel.me/signing\"\u003eDisabling code signing for Debug builds\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","contentSnippet":"Programmers who have ever developed software for Apple platforms in the early days of Swift language might remember ridiculous\ntimes it took to compile the whole project. For large and complicated codebase times used to range from 10 up to 40 minutes.\nOver the years our toolset has improved alongside with compilation times, but slow build times of source code can still be a nightmare.\nWhen we wait a few minutes for a build, we navigate ourselves towards different activities and start e.g. watching funny animal pictures or\nYouTube videos, easily loosing context of the task at hand. What becomes annoying for us is slow feedback of code correctness.\nIn the past issue my colleague has written about a solution\nto slow clean builds.In this post I will focus on warm builds improvement.\nClean and incremental builds\nThere are two terms used in the realm of Xcode when it comes to distinguishing types of\ncompilation: clean and incremental build. The first refers to the time it takes to build a project from scratch. The latter is the time\nit takes to build only whatever changed since the last build and to integrate the changes into a build product.\nYou might also be familiar with the term warm build. It’s used interchangeably with incremental build term, but for the sake of this\npost I will be using it to refer to the time it takes to build a product since the last clean build without introducing any source code\nchanges.\nWhy and what for\nWhy bothering with improving warm build times? Well, for a small projects built on super fast workstations it might take a fraction of a\nsecond to do a warm build, but as projects grow and multiple Build Phases get added to a target so grow the build times. These times\nare noticeable especially when one builds the target without an introduction of changes to the source code.\nBefore we started improving the warm build of the Allegro app for iOS platform it took 18 seconds to perform the build on our\nContinuous Integration (CI) servers (Mac Mini, 6-Core 3.2 GHz CPU, 32 GB Ram).\nIs 18 seconds too much? When you put it into a perspective of 1 year:\n18 seconds × 6 builds per hour × 8 hours per day × 20 days per month × 12 months per year = 207360 seconds = 3456 minutes = 57\nhours 36 minutes\nIt means that on average a programmer spends around 57 hours 36 minutes yearly to wait for a feedback if their code is correct. Is it\nmuch? I leave the answer to you, but it definitely hinders developer’s experience and distracts the developer from their job.\nTo make the developer’s experience better, we, the iOS Mobile Core Team at Allegro, have set the goal to minimize the time developers\nspend between hitting the build button and getting the feedback on their code as quickly as possible.\nHow could the goal be achieved? Well, before I answer that, let’s put some light onto how to actually measure build times.\nMeasurements\nDevelopers building software for Apple platforms use the Xcode application which has a command\nline interface called xcodebuild. The Xcode has an option to output times for build phases from the menu\nProduct \u003e Perform Action \u003e Build With Timing Summary (doesn’t seem to work on Xcode 12.2 at the time of writing this\nblog post). To get build times with xcodebuild for our Allegro app for each build phase of the main target the following command\ncan be used:\n\nxcodebuild -workspace 'Allegro/Allegro.xcworkspace' \\\n-scheme 'Allegro' \\\n-configuration 'Debug' \\\n-sdk 'iphonesimulator' \\\n-arch 'x86_64' \\\n-showBuildTimingSummary \\\nbuild \\\n| sed -n -e '/Build Timing Summary/,$p'\n\n\nIn the case of the Allegro app it outputs the following lines when I do a clean build with Xcode 12.2’s xcodebuild\n(Mac Book Pro 2.2 GHz 6-Core Intel Core i7 CPU, 32 GB RAM):\n\nBuild Timing Summary\n\nCompileC (49 tasks) | 174.459 seconds\n\nCompileSwiftSources (3 tasks) | 31.747 seconds\n\nCompileStoryboard (6 tasks) | 29.057 seconds\n\nPhaseScriptExecution (8 tasks) | 22.320 seconds\n\nDitto (21 tasks) | 22.282 seconds\n\nLd (3 tasks) | 13.432 seconds\n\nCompileAssetCatalog (1 task) | 6.620 seconds\n\nValidateEmbeddedBinary (2 tasks) | 6.528 seconds\n\nCompileXIB (1 task) | 5.000 seconds\n\nCodeSign (3 tasks) | 1.419 seconds\n\nCopyPNGFile (3 tasks) | 1.236 seconds\n\nTouch (4 tasks) | 0.318 seconds\n\nLibtool (1 task) | 0.241 seconds\n\nLinkStoryboards (2 tasks) | 0.108 seconds\n\n\nThere’s a lot of tasks. When it comes to source code compilation process, we can lower down build times by splitting the source code\ninto modular frameworks, using binary caching techniques and adding explicit types for expressions in Swift.\nIn the case of a warm build the only phases listed are:\n\nBuild Timing Summary\n\nPhaseScriptExecution (6 tasks) | 23.350 seconds\n\nValidateEmbeddedBinary (2 tasks) | 2.424 seconds\n\n** BUILD SUCCEEDED ** [27.238 sec]\n\n\nThanks to performing the warm build it can be easily noticed that there’s a room for improvement when it comes to\nPhaseScriptExecution part of the build process. This is actually the part over which we have the control of. Let’s see, what we can\ndo in order to speed up the build time by playing with what and how scripts get executed.\nCleaning up run scripts\nFirst thing we did with for our iOS application target was selecting scripts which can be run only for Release builds. There’s an easy way\nin Xcode to mark them as runnable for such builds only - just select For install builds only checkbox.\n\nWhat jobs are great for running only for Release builds? We selected a few:\nuploading debug symbols to 3rd party monitoring services\nsetting endpoints or enabling Apple Transport Security (ATS) for Debug/Release builds\nselecting proper .plist files for Debug/Release builds\nNot all tasks can be selected as Release - only. Some of them need to be run for Debug and Release builds, but they don’t have to be\nrun for every build. Xcode 12 introduced a neat feature - running the script based on dependency analysis.\n\nSelecting the checkbox isn’t enough to benefit from dependency analysis. Xcode analyses dependencies of a script, i.e. it verifies if the\ninputs of the script have changed since the last run and if the outputs of the script exist. The potential problem occurred for scripts in our\nproject - they didn’t have explicit inputs and outputs defined so we couldn’t tap into the brand new feature of Xcode.\nDefining inputs and outputs for scripts\nOne of the scripts in our project which is time-consuming copies bundles with resources of each module. Our Xcode workspace consists\nof multiple projects. The main project contains the application target which depends on modules built by other projects. The projects\ncontain static frameworks with resources. The resources for each framework are wrapped in .bundle wrapper and are embedded in\nthe framework. All frameworks are linked statically to the application and their bundles are copied by the script to the application\nwrapper (.app).\nThe list with .bundle files to be copied became an input to our script. We also created a list with paths to which bundles are copied.\nXcode uses a .xcfilelist format for such lists, but it’s just a file with newline-separated values. The\ncopy-bundles-input.xcfilelist input to our script looks as such:\n\n$(BUILT_PRODUCTS_DIR)/ModuleX.framework/ModuleX.bundle\n$(BUILT_PRODUCTS_DIR)/ModuleY.framework/ModuleY.bundle\n$(BUILT_PRODUCTS_DIR)/ModuleZ.framework/ModuleZ.bundle\n\n\nand the copy-bundles-output.xcfilelist output:\n\n$(TARGET_BUILD_DIR)/$(EXECUTABLE_FOLDER_PATH)/ModuleX.bundle\n$(TARGET_BUILD_DIR)/$(EXECUTABLE_FOLDER_PATH)/ModuleY.bundle\n$(TARGET_BUILD_DIR)/$(EXECUTABLE_FOLDER_PATH)/ModuleZ.bundle\n\n\nFile lists can be accessed in a script through environment variables. Each script can have many of them and they are indexed from 0:\nSCRIPT_INPUT_FILE_LIST_0\n…\n  \nSCRIPT_INPUT_FILE_LIST_1024\nSCRIPT_OUTPUT_FILE_LIST_0\n…\n  \nSCRIPT_OUTPUT_FILE_LIST_1024\nThere is also a possibility to use input and output files instead of a list (not shown on the screens):\nSCRIPT_INPUT_FILE_0\n…\n  \nSCRIPT_INPUT_FILE_1024\nSCRIPT_OUTPUT_FILE_0\n…\n  \nSCRIPT_OUTPUT_FILE_1024\nand additionally the SCRIPT_INPUT_FILE_COUNT and SCRIPT_OUTPUT_FILE_COUNT can be used\nWe based our script copying resource bundles only on file lists and it’s actually quite simple - it just copies files from the\ninput file list to the destination which is the path to the executable.\n\ndestination=\"${TARGET_BUILD_DIR}/${EXECUTABLE_FOLDER_PATH}\"\ngrep -v '^ *#' \u003c \"${SCRIPT_INPUT_FILE_LIST_0}\" | while IFS= read -r bundle_path\ndo\n    if [ -d \"$bundle_path\" ]; then\n        rsync -auv \"${bundle_path}\" \"${destination}\" || exit 1\n    fi\ndone\n\n\nIn the end we tapped into using Xcode’s dependency analysis for a few run scripts and it allowed us to improve warm build time.\n\nBuild Timing Summary\n\nPhaseScriptExecution (6 tasks) | 3.666 seconds\n\nValidateEmbeddedBinary (2 tasks) | 2.314 seconds\n\n** BUILD SUCCEEDED ** [7.500 sec]\n\n\n\nAt the time of writing the warm build time on our CI machines takes 4 seconds. The overall goal of speeding up builds is so that\nthe clean build time becomes equal to warm build.\nLinks\nSome useful links related to improving compilation times for Xcode projects:\nXcode Build Time Optimization - Part 1\nXcode Build Time Optimization - Part 2\nDisabling code signing for Debug builds","guid":"https://blog.allegro.tech/2020/12/speeding-up-warm-builds.html","categories":["ios","xcode","swift","objectivec"],"isoDate":"2020-12-27T23:00:00.000Z","thumbnail":"images/post-headers/xcode.png"},{"title":"Speeding up iOS builds with Bazel","link":"https://blog.allegro.tech/2020/12/speeding-up-ios-builds-with-bazel.html","pubDate":"Thu, 17 Dec 2020 00:00:00 +0100","authors":{"author":[{"name":["Kamil Pyć"],"photo":["https://blog.allegro.tech/img/authors/kamil.pyc.jpg"],"url":["https://blog.allegro.tech/authors/kamil.pyc"]}]},"content":"\u003cp\u003eWhen we developed our Allegro iOS app adding new features and with more people contributing to the codebase, we noticed\nthat build times began to grow. In order to have precise metrics, we started to track clean build time as well as the\namount of code we had. Do these two metrics grow at the same pace?\u003c/p\u003e\n\n\u003ch3 id=\"slowing-down\"\u003eSlowing down\u003c/h3\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2020-12-17-speeding-up-ios-builds-with-bazel/build_time_chart.png\" alt=\"Build time chart\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eOur measurements started in May 2019 with combined 300k lines of Objective-C and Swift code that took around\n~177 seconds to compile. One year later we increased code size by 33% but compilation time grew by 50%.\nIt’s worth noting that this time is measured on our CI machine which is more powerful than a laptop machine —\nbuild times are about 50% slower on our work Macbooks. To put it into perspective - on average developers do 8\nclean builds each day and they will now take about 40 minutes of their work. As we have 25 developers contributing\nto the project, this will add up to 16 hours each day and over 300 hours monthly!\nWe had to make some changes in order to not spend most of our time waiting for the app to compile.\nEven if we have split application into smaller projects it all needs to be built into one single application.\nSince it’s a monolith that needs to be linked together, one “service” cannot be changed in a running app as you would\nin microservice backend infrastructure.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2020-12-17-speeding-up-ios-builds-with-bazel/build_details.png\" alt=\"Build details\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eAt first we tried to speed things up with building our 3rd party dependencies with Carthage. However, this was not very\nefficient being only a small fraction of our code base. Any improvement was quickly eaten up by adding new code that\nneeded time to compile. The direction of not compiling the same code over and over was what we were aiming for.\u003c/p\u003e\n\n\u003ch3 id=\"bazel\"\u003eBazel\u003c/h3\u003e\n\n\u003cp\u003eBefore we started looking for a solution we outlined what was important for us:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eIdeally it should be transparent to our developers - they should only notice an increase in speed\u003c/li\u003e\n  \u003cli\u003eIt should work with modules that mix Obj-C and Swift\u003c/li\u003e\n  \u003cli\u003eIt should be easy to turn off and switch to standard building Xcode if something goes sideways\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eBasically, this meant we wanted to keep our current setup while adding a mechanism letting us to share compiled\nartifacts(preferably without any special developer integration). Our eyes turned to the open source build\nsystems - \u003ca href=\"https://bazel.build\"\u003eBazel\u003c/a\u003e and \u003ca href=\"https://buck.build\"\u003eBuck\u003c/a\u003e. Comparing these two, we chose Bazel since it\nprovides better support for custom actions\nwith its Starlak language and it’s more popular in the iOS community.\u003c/p\u003e\n\n\u003cp\u003eBazel is Google’s build system that supports C++, Android, iOS, Go and a wide variety of other\nlanguage platforms on Windows, macOS, and Linux. One of its key features is its caching mechanism - both local and\nremote.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2020-12-17-speeding-up-ios-builds-with-bazel/bazel_logo.png\" alt=\"Bazel logo\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eBazel already provides sets of Apple rules that can build a complete application but it didn’t meet our requirements\nsince mixing Swift and Obj-C is not possible. Another problem is that we would need to do the whole transition at once\nsince you cannot simply migrate only a part of the project. We decided to create a custom rule that would use\nxcodebuild to build frameworks - this means we would use the same build system we currently use in everyday development\nand we wouldn’t have to change our current project.\u003c/p\u003e\n\n\u003cp\u003eCustom rules can be written in Starlak language. In our case we needed to wrap\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003excodebuild\u003c/code\u003e into a \u003ccode class=\"language-plaintext highlighter-rouge\"\u003esh_binary\u003c/code\u003e action:\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003esh_binary\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"xcodebuild\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esrcs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"/usr/bin/xcodebuild\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"n\"\u003evisibility\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"//visibility:public\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThen, we can create a rule that will call \u003ccode class=\"language-plaintext highlighter-rouge\"\u003excodebuild\u003c/code\u003e and produce \u003ccode class=\"language-plaintext highlighter-rouge\"\u003etarget.framework\u003c/code\u003e:\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003e_impl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elabel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\n  \u003cspan class=\"n\"\u003epbxProj\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eproject\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eoutput_config\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"CONFIGURATION_BUILD_DIR=../%s\"\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoutputs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eframework\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edirname\u003c/span\u003e\n\n  \u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eactions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003einputs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003epbxProj\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efiles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esrcs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eoutputs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoutputs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eframework\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n        \u003cspan class=\"n\"\u003earguments\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"-project\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epbxProj\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"-scheme\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput_config\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eprogress_message\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Building framework %s\"\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eexecutable\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexecutable\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003excodebuild\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eframework\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eimplementation\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_impl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eattrs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e\"srcs\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eattr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_list\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eallow_files\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e\"project\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eattr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elabel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eallow_single_file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emandatory\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e\"xcodebuild\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eattr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elabel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eexecutable\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecfg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"host\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eallow_files\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edefault\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eLabel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"//bazel/xcodebuild\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e),\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eoutputs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"framework\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"%{name}.framework\"\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWith that we can now build any project we want to, in this case AFNetworking library:\u003c/p\u003e\n\n\u003cdiv class=\"language-python highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\n\u003cspan class=\"n\"\u003eload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"//bazel:xcodebuild.bzl\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"framework\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eframework\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"AFNetworking\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eproject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Pods/AFNetworking.xcodeproj\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"n\"\u003esrcs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eglob\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Pods/AFNetworking/**/*\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]),\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThen we can call:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e./bazel/bazelisk build //:AFNetworking\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eand this should be given as an output:\u003c/p\u003e\n\n\u003cdiv class=\"language-shell highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003e**\u003c/span\u003e BUILD SUCCEEDED \u003cspan class=\"k\"\u003e**\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e11.279 sec]\n\nTarget //:AFNetworking:\n  bazel-bin/AFNetworking.framework\nINFO: Elapsed \u003cspan class=\"nb\"\u003etime\u003c/span\u003e: 12.427s, Critical Path: 12.28s\nINFO: 1 process: 1 local.\nINFO: Build completed successfully, 2 total actions\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThanks to Bazel, build will only be performed once and rebuild only when any of the target files change.\nOnce we point to a remote cache with –remote_http_cache we can share this artefact in a shared remote cache.\nIt’s amazing how easy it is to set up a remote cache.\u003c/p\u003e\n\n\u003cp\u003eHow can we use Bazel from Xcode, though? Unfortunately, Xcode is not known for great support of external build systems\nand there is no way of doing it ourselves since it’s closed source. The only way of extending it are plugins whose\ncapabilities are very limited. Fortunately, there is a way: we can use Build Phases that are run each time a project is\nbuilt. It’s a simple Run Script phase that invokes Bazel and copies created frameworks to BUILT_PRODUCTS_DIR.\nWhen developers are not working on a given module, we use our special tool that will generate a workspace without it\nand this target will be built with Bazel in this Build Phase. Thanks to shared remote cache, most of the time instead\nof compiling it we would just download precompiled frameworks.\u003c/p\u003e\n\n\u003cp\u003eAfter migrating all of our modules to Bazel we were able to significantly reduce our clean build time. It dropped over\nthreefold, going from 260s to just 85s. Developers’ experience improved as well, because Xcode is a lot more responsive\nthan before because of reducing the number of projects included in the workspace.\u003c/p\u003e\n\n\u003cp\u003eIt’s worth noting that if any of our scripts or build artefacts contain e.g. local paths they will cause misses in\nour cache. To prevent this we monitor our local and CI builds times and cache hits to detect such situations.\u003c/p\u003e\n\n\u003ch3 id=\"tests\"\u003eTests\u003c/h3\u003e\n\n\u003cp\u003eA couple years ago we moved all of our iOS projects to a single monorepo.\nThis has drastically simplified development since we don’t have to maintain a pyramid of hundreds of dependencies\nbetween dozens of repositories anymore. One downside is that all projects combined produce over 15.000 unit tests that\ntake over an hour to build and run. We didn’t want to wait that long in each PR, so we decided to run only a selected\nportion of tests affected by introduced changes. To achieve this we had to maintain a list of dependencies between\ndifferent projects and that was obviously very error prone.\nThe chart below shows just a small portion of our dependency tree (generated in Bazel).\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2020-12-17-speeding-up-ios-builds-with-bazel/dependency_graph.png\" alt=\"Dependency graph\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eAfter the migration to Bazel we can query our dependency graph to get a list of targets that a given file affects\nand run unit tests for that target. That improved our experience since we used to manually maintain list of\ndependencies beetwen our module which was error prone and time consuming.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2020-12-17-speeding-up-ios-builds-with-bazel/query.png\" alt=\"Sample query\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eBuild results can be cached the same way as build artifacts.\nThis has dramatically reduced test times of our master branch test plan, as we can run \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ebazel test //...\u003c/code\u003e and only test\ntargets that have not been run previously. Take a look at the below chart to see how good our result are:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2020-12-17-speeding-up-ios-builds-with-bazel/tests_time_chart.png\" alt=\"Tests time chart\" /\u003e\u003c/p\u003e\n\n\u003ch3 id=\"conclusion\"\u003eConclusion\u003c/h3\u003e\n\n\u003cp\u003eIntegrating Bazel into an iOS project requires some effort, but in our opinion it’s worth it, especially in large scale\nprojects. We observe more and more companies struggling with fast and scalable builds. Some of the key tech players,\nincluding Lyft, Pinterest and LinkedIn, switched to Bazel for building iOS apps as well. It’s worth watching Keith\nSmiley \u0026amp; Dave Lee \u003ca href=\"https://www.youtube.com/watch?v=NAPeWoimGx8\"\u003etalk\u003c/a\u003e from Bazel Conf about migration of Lyft app to\nBazel.\u003c/p\u003e\n\n\u003cp\u003eWe still have the main app target with a large amount of source code that always needs to be compiled.\nCurrently we are working on splitting the app target into modules, so we can cache this code as well and reduce build\ntime even further. In the future we will try to make the same Bazel migration with our Android application to achieve\nthe same build speed improvement and have single build tool for both platforms. We will also try out try another\npromising feature, called Remote Execution - so we can use remote workers to perform remote builds. We estimate that\nafter completion of these plans, we can further reduce our build times to about 10 seconds.\u003c/p\u003e\n","contentSnippet":"When we developed our Allegro iOS app adding new features and with more people contributing to the codebase, we noticed\nthat build times began to grow. In order to have precise metrics, we started to track clean build time as well as the\namount of code we had. Do these two metrics grow at the same pace?\nSlowing down\n\nOur measurements started in May 2019 with combined 300k lines of Objective-C and Swift code that took around\n~177 seconds to compile. One year later we increased code size by 33% but compilation time grew by 50%.\nIt’s worth noting that this time is measured on our CI machine which is more powerful than a laptop machine —\nbuild times are about 50% slower on our work Macbooks. To put it into perspective - on average developers do 8\nclean builds each day and they will now take about 40 minutes of their work. As we have 25 developers contributing\nto the project, this will add up to 16 hours each day and over 300 hours monthly!\nWe had to make some changes in order to not spend most of our time waiting for the app to compile.\nEven if we have split application into smaller projects it all needs to be built into one single application.\nSince it’s a monolith that needs to be linked together, one “service” cannot be changed in a running app as you would\nin microservice backend infrastructure.\n\nAt first we tried to speed things up with building our 3rd party dependencies with Carthage. However, this was not very\nefficient being only a small fraction of our code base. Any improvement was quickly eaten up by adding new code that\nneeded time to compile. The direction of not compiling the same code over and over was what we were aiming for.\nBazel\nBefore we started looking for a solution we outlined what was important for us:\nIdeally it should be transparent to our developers - they should only notice an increase in speed\nIt should work with modules that mix Obj-C and Swift\nIt should be easy to turn off and switch to standard building Xcode if something goes sideways\nBasically, this meant we wanted to keep our current setup while adding a mechanism letting us to share compiled\nartifacts(preferably without any special developer integration). Our eyes turned to the open source build\nsystems - Bazel and Buck. Comparing these two, we chose Bazel since it\nprovides better support for custom actions\nwith its Starlak language and it’s more popular in the iOS community.\nBazel is Google’s build system that supports C++, Android, iOS, Go and a wide variety of other\nlanguage platforms on Windows, macOS, and Linux. One of its key features is its caching mechanism - both local and\nremote.\n\nBazel already provides sets of Apple rules that can build a complete application but it didn’t meet our requirements\nsince mixing Swift and Obj-C is not possible. Another problem is that we would need to do the whole transition at once\nsince you cannot simply migrate only a part of the project. We decided to create a custom rule that would use\nxcodebuild to build frameworks - this means we would use the same build system we currently use in everyday development\nand we wouldn’t have to change our current project.\nCustom rules can be written in Starlak language. In our case we needed to wrap\nxcodebuild into a sh_binary action:\n\nsh_binary(\n    name = \"xcodebuild\",\n    srcs = [\"/usr/bin/xcodebuild\"],\n    visibility = [\"//visibility:public\"]\n)\n\n\nThen, we can create a rule that will call xcodebuild and produce target.framework:\n\ndef _impl(ctx):\n  name = ctx.label.name\n  pbxProj = ctx.file.project\n  output_config = \"CONFIGURATION_BUILD_DIR=../%s\" % ctx.outputs.framework.dirname\n\n  ctx.actions.run(\n        inputs = [pbxProj] + ctx.files.srcs,\n        outputs = [ctx.outputs.framework],\n        arguments = [\"build\", \"-project\", pbxProj.path, \"-scheme\", name, output_config],\n        progress_message = \"Building framework %s\" % name,\n        executable = ctx.executable.xcodebuild,\n    )\n\nframework = rule(\n    implementation = _impl,\n    attrs = {\n        \"srcs\": attr.label_list(allow_files = True),\n        \"project\": attr.label(\n            allow_single_file = True,\n            mandatory = True,\n        ),\n        \"xcodebuild\": attr.label(\n            executable = True,\n            cfg = \"host\",\n            allow_files = True,\n            default = Label(\"//bazel/xcodebuild\")\n        ),\n      },\n      outputs = {\"framework\": \"%{name}.framework\"},\n)\n\n\nWith that we can now build any project we want to, in this case AFNetworking library:\n\n\nload(\"//bazel:xcodebuild.bzl\", \"framework\")\n\nframework(\n   name = \"AFNetworking\",\n   project = \"Pods/AFNetworking.xcodeproj\",\n   srcs = glob([\"Pods/AFNetworking/**/*\"]),\n)\n\n\n\nThen we can call:\n\n./bazel/bazelisk build //:AFNetworking\n\n\nand this should be given as an output:\n\n** BUILD SUCCEEDED ** [11.279 sec]\n\nTarget //:AFNetworking:\n  bazel-bin/AFNetworking.framework\nINFO: Elapsed time: 12.427s, Critical Path: 12.28s\nINFO: 1 process: 1 local.\nINFO: Build completed successfully, 2 total actions`\n\n\nThanks to Bazel, build will only be performed once and rebuild only when any of the target files change.\nOnce we point to a remote cache with –remote_http_cache we can share this artefact in a shared remote cache.\nIt’s amazing how easy it is to set up a remote cache.\nHow can we use Bazel from Xcode, though? Unfortunately, Xcode is not known for great support of external build systems\nand there is no way of doing it ourselves since it’s closed source. The only way of extending it are plugins whose\ncapabilities are very limited. Fortunately, there is a way: we can use Build Phases that are run each time a project is\nbuilt. It’s a simple Run Script phase that invokes Bazel and copies created frameworks to BUILT_PRODUCTS_DIR.\nWhen developers are not working on a given module, we use our special tool that will generate a workspace without it\nand this target will be built with Bazel in this Build Phase. Thanks to shared remote cache, most of the time instead\nof compiling it we would just download precompiled frameworks.\nAfter migrating all of our modules to Bazel we were able to significantly reduce our clean build time. It dropped over\nthreefold, going from 260s to just 85s. Developers’ experience improved as well, because Xcode is a lot more responsive\nthan before because of reducing the number of projects included in the workspace.\nIt’s worth noting that if any of our scripts or build artefacts contain e.g. local paths they will cause misses in\nour cache. To prevent this we monitor our local and CI builds times and cache hits to detect such situations.\nTests\nA couple years ago we moved all of our iOS projects to a single monorepo.\nThis has drastically simplified development since we don’t have to maintain a pyramid of hundreds of dependencies\nbetween dozens of repositories anymore. One downside is that all projects combined produce over 15.000 unit tests that\ntake over an hour to build and run. We didn’t want to wait that long in each PR, so we decided to run only a selected\nportion of tests affected by introduced changes. To achieve this we had to maintain a list of dependencies between\ndifferent projects and that was obviously very error prone.\nThe chart below shows just a small portion of our dependency tree (generated in Bazel).\n\nAfter the migration to Bazel we can query our dependency graph to get a list of targets that a given file affects\nand run unit tests for that target. That improved our experience since we used to manually maintain list of\ndependencies beetwen our module which was error prone and time consuming.\n\nBuild results can be cached the same way as build artifacts.\nThis has dramatically reduced test times of our master branch test plan, as we can run bazel test //... and only test\ntargets that have not been run previously. Take a look at the below chart to see how good our result are:\n\nConclusion\nIntegrating Bazel into an iOS project requires some effort, but in our opinion it’s worth it, especially in large scale\nprojects. We observe more and more companies struggling with fast and scalable builds. Some of the key tech players,\nincluding Lyft, Pinterest and LinkedIn, switched to Bazel for building iOS apps as well. It’s worth watching Keith\nSmiley \u0026 Dave Lee talk from Bazel Conf about migration of Lyft app to\nBazel.\nWe still have the main app target with a large amount of source code that always needs to be compiled.\nCurrently we are working on splitting the app target into modules, so we can cache this code as well and reduce build\ntime even further. In the future we will try to make the same Bazel migration with our Android application to achieve\nthe same build speed improvement and have single build tool for both platforms. We will also try out try another\npromising feature, called Remote Execution - so we can use remote workers to perform remote builds. We estimate that\nafter completion of these plans, we can further reduce our build times to about 10 seconds.","guid":"https://blog.allegro.tech/2020/12/speeding-up-ios-builds-with-bazel.html","categories":["ios","bazel"],"isoDate":"2020-12-16T23:00:00.000Z","thumbnail":"images/post-headers/bazel.png"}],"jobs":[{"id":"743999734961589","name":"Front-End Software Engineer","uuid":"3e762319-5f6c-4130-9f46-fe0d0c0ced09","refNumber":"REF2552L","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-02-12T08:37:44.000Z","location":{"city":"Poznań, Warszawa","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro"},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999734961589","creator":{"name":"Justyna Kucharska-Minicka"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999734708244","name":"Product Manager (Produktyzacja)","uuid":"39515517-b254-4701-8e38-6bbd230c0f15","refNumber":"REF2238M","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-02-11T07:00:17.000Z","location":{"city":"Toruń, Poznań, Warszawa","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"1013462","label":"Technology - Product Development"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"1013462","valueLabel":"Technology - Product Development"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro"},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"product manager, product management, product"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999734708244","creator":{"name":"Małgorzata Sejdak"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999734575802","name":"Data Analyst (UX \u0026 Conversion)","uuid":"49526f62-8665-4b1b-bfeb-3844190cc4f7","refNumber":"REF2547B","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-02-10T09:41:50.000Z","location":{"city":"Poznań","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"1013462","label":"Technology - Product Development"},"function":{"id":"analyst","label":"Analyst"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"associate","label":"Associate"},"customField":[{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"1013462","valueLabel":"Technology - Product Development"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"data, analysis, analyst, analityk, dane, big data, sql, python"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999734575802","creator":{"name":"Izabela Dudkowiak"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999734423003","name":"IT Security Specialist","uuid":"f397db6f-9982-4382-a5c2-5886d25371e0","refNumber":"REF2548W","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-02-09T08:21:47.000Z","location":{"city":"Warszawa, Poznań, Toruń","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"1013445","label":"Technology - Technical Platform"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"1013445","valueLabel":"Technology - Technical Platform"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro"},{"fieldId":"5dee624907e370138f7ad0bd","fieldLabel":"Kompetencje Allegro","valueId":"236b702e-45b9-4c4b-82d4-01c640aaf881","valueLabel":"Nie"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"SEC, RED, BLUE, Security"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999734423003","creator":{"name":"Angelika Szymkiewicz"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999734285388","name":"Team Leader - Technology","uuid":"205bae41-fc6c-49f6-9d1c-a13d66bdcf09","refNumber":"REF2540R","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-02-08T08:53:04.000Z","location":{"city":"Poznań","region":"Greater Poland Voivodeship","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"1013445","label":"Technology - Technical Platform"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"1013445","valueLabel":"Technology - Technical Platform"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro"},{"fieldId":"5dee624907e370138f7ad0bd","fieldLabel":"Kompetencje Allegro","valueId":"236b702e-45b9-4c4b-82d4-01c640aaf881","valueLabel":"Nie"},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"Team Leader, Tech, Technical platform"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999734285388","creator":{"name":"Filip Lewandowski"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}}],"events":[{"created":1596114124000,"duration":5400000,"id":"272249143","name":"Allegro Tech Talks #13 - Cyfrodziewczyny","date_in_series_pattern":false,"status":"past","time":1596643200000,"local_date":"2020-08-05","local_time":"18:00","updated":1596650397000,"utc_offset":7200000,"waitlist_count":0,"yes_rsvp_count":40,"venue":{"id":26906060,"name":"Online event","repinned":false,"country":"","localized_country_name":""},"is_online_event":true,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/272249143/","description":"Allegro Tech Live to nowa (w 100% zdalna) odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale tym razem to…","how_to_find_us":"https://www.facebook.com/allegro.tech/","visibility":"public","member_pay_fee":false},{"created":1593525736000,"duration":3600000,"id":"271624844","name":"Allegro Tech Live #12 - Wszystko o licencjach Open Source","date_in_series_pattern":false,"status":"past","time":1593619200000,"local_date":"2020-07-01","local_time":"18:00","updated":1593625843000,"utc_offset":7200000,"waitlist_count":0,"yes_rsvp_count":34,"venue":{"id":26906060,"name":"Online event","repinned":false,"country":"","localized_country_name":""},"is_online_event":true,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/271624844/","description":"Allegro Tech Live to nowa (w 100% zdalna) odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale tym razem to…","how_to_find_us":"https://www.facebook.com/allegro.tech","visibility":"public","member_pay_fee":false},{"created":1592578931000,"duration":7200000,"id":"271396824","name":"Allegro Tech Live #11","date_in_series_pattern":false,"status":"past","time":1593014400000,"local_date":"2020-06-24","local_time":"18:00","updated":1593026541000,"utc_offset":7200000,"waitlist_count":0,"yes_rsvp_count":62,"venue":{"id":26906060,"name":"Online event","repinned":false,"country":"","localized_country_name":""},"is_online_event":true,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/271396824/","description":"Allegro Tech Live to nowa (w 100% zdalna) odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale tym razem to…","how_to_find_us":"https://www.facebook.com/allegro.tech","visibility":"public","member_pay_fee":false},{"created":1591785401000,"duration":7200000,"id":"271201706","name":"Allegro Tech Live #10 - ML","date_in_series_pattern":false,"status":"past","time":1592409600000,"local_date":"2020-06-17","local_time":"18:00","updated":1592418866000,"utc_offset":7200000,"waitlist_count":0,"yes_rsvp_count":69,"venue":{"id":26906060,"name":"Online event","repinned":false,"country":"","localized_country_name":""},"is_online_event":true,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/271201706/","description":"Allegro Tech Live to nowa (w 100% zdalna) odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale tym razem to…","how_to_find_us":"https://www.facebook.com/allegro.tech/","visibility":"public","member_pay_fee":false}],"podcasts":[{"creator":{"name":["Łukasz Ściga"]},"title":"Zbiory danych w Allegro","link":"https://podcast.allegro.tech/zbiory_danych_w_allegro","pubDate":"Wed, 10 Feb 2021 00:00:00 GMT","author":{"name":["Łukasz Ściga"]},"enclosure":{"url":"https://www.buzzsprout.com/887914/7426294-sezon-ii-1-zbiory-danych-w-allegro-lukasz-scigak.mp3","type":"audio/mpeg"},"content":"Czym zajmuje się inżynier danych? Jak powstało Big Data? Jak wykorzystuje się oraz kto korzysta z nowych zbiorów danych? Czym różni się Data Scientist od Data Engineera? Jak połączyć przetwarzanie streamingowe z przetwarzaniem batchowym? Z jakich narzędzi korzysta Data Engineer? Na te pytania odpowie Łukasz Ściga - Data Engineer w Allegro, którego pasją jest programowanie gier komputerowych.","contentSnippet":"Czym zajmuje się inżynier danych? Jak powstało Big Data? Jak wykorzystuje się oraz kto korzysta z nowych zbiorów danych? Czym różni się Data Scientist od Data Engineera? Jak połączyć przetwarzanie streamingowe z przetwarzaniem batchowym? Z jakich narzędzi korzysta Data Engineer? Na te pytania odpowie Łukasz Ściga - Data Engineer w Allegro, którego pasją jest programowanie gier komputerowych.","guid":"https://podcast.allegro.tech/zbiory_danych_w_allegro","isoDate":"2021-02-10T00:00:00.000Z","itunes":{"author":"Łukasz Ściga","summary":"Czym zajmuje się inżynier danych? Jak powstało Big Data? Jak wykorzystuje się oraz kto korzysta z nowych zbiorów danych? Czym różni się Data Scientist od Data Engineera? Jak połączyć przetwarzanie streamingowe z przetwarzaniem batchowym? Z jakich narzędzi korzysta Data Engineer? Na te pytania odpowie Łukasz Ściga - Data Engineer w Allegro, którego pasją jest programowanie gier komputerowych.","explicit":"false"}},{"creator":{"name":["Ireneusz Gawlik"]},"title":"Badania i rozwój ML w Allegro","link":"https://podcast.allegro.tech/badania_i_rozwoj_ml_w_allegro","pubDate":"Mon, 29 Jun 2020 00:00:00 GMT","author":{"name":["Ireneusz Gawlik"]},"enclosure":{"url":"https://www.buzzsprout.com/887914/2998819-13-badania-i-rozwoj-ml-w-allegro-ireneusz-gawlik.mp3","type":"audio/mpeg"},"content":"Gdzie kryje się Machine Learning w Allegro? Jakie projekty już dzisiaj korzystają z mocy sztucznej inteligencji? Jak na codzień pracuje grupa badaczy nie tylko aplikująca, ale też rozwijająca algorytmy uczenia maszynowego? Irek, Team Manager w grupie Allegro ML Research, opowiada więcej o tym jak się tworzy AI w Polsce.","contentSnippet":"Gdzie kryje się Machine Learning w Allegro? Jakie projekty już dzisiaj korzystają z mocy sztucznej inteligencji? Jak na codzień pracuje grupa badaczy nie tylko aplikująca, ale też rozwijająca algorytmy uczenia maszynowego? Irek, Team Manager w grupie Allegro ML Research, opowiada więcej o tym jak się tworzy AI w Polsce.","guid":"https://podcast.allegro.tech/badania_i_rozwoj_ml_w_allegro","isoDate":"2020-06-29T00:00:00.000Z","itunes":{"author":"Ireneusz Gawlik","summary":"Gdzie kryje się Machine Learning w Allegro? Jakie projekty już dzisiaj korzystają z mocy sztucznej inteligencji? Jak na codzień pracuje grupa badaczy nie tylko aplikująca, ale też rozwijająca algorytmy uczenia maszynowego? Irek, Team Manager w grupie Allegro ML Research, opowiada więcej o tym jak się tworzy AI w Polsce.","explicit":"false"}},{"creator":{"name":["Kasia Wróbel"]},"title":"Projektowanie UX w Allegro, czyli wszystko zależy od doświadczenia","link":"https://podcast.allegro.tech/projektowanie_ux_w_allegro","pubDate":"Mon, 15 Jun 2020 00:00:00 GMT","author":{"name":["Kasia Wróbel"]},"enclosure":{"url":"https://www.buzzsprout.com/887914/3011998-11-projektowanie-ux-w-allegro-czyli-wszystko-zalezy-od-doswiadczenia-katarzyna-wrobel.mp3","type":"audio/mpeg"},"content":"Projektowanie na styku produktu, biznesu i potrzeb użytkownika. Budzenie ciekawości, czyli czy jesteś w stanie zmienić coś, co sprawia problem tak wielu osobom na raz? Kasia opowiada o \"układaniu klocków\", których użytkownik wie jak użyć.","contentSnippet":"Projektowanie na styku produktu, biznesu i potrzeb użytkownika. Budzenie ciekawości, czyli czy jesteś w stanie zmienić coś, co sprawia problem tak wielu osobom na raz? Kasia opowiada o \"układaniu klocków\", których użytkownik wie jak użyć.","guid":"https://podcast.allegro.tech/projektowanie_ux_w_allegro","isoDate":"2020-06-15T00:00:00.000Z","itunes":{"author":"Kasia Wróbel","summary":"Projektowanie na styku produktu, biznesu i potrzeb użytkownika. Budzenie ciekawości, czyli czy jesteś w stanie zmienić coś, co sprawia problem tak wielu osobom na raz? Kasia opowiada o \"układaniu klocków\", których użytkownik wie jak użyć.","explicit":"false"}},{"creator":{"name":["Kamil Borzym"]},"title":"Mobile w Allegro","link":"https://podcast.allegro.tech/mobile_w_allegro","pubDate":"Mon, 01 Jun 2020 00:00:00 GMT","author":{"name":["Kamil Borzym"]},"enclosure":{"url":"https://www.buzzsprout.com/887914/3011989-11-mobile-w-allegro-kamil-borzym.mp3","type":"audio/mpeg"},"content":"Cały świat obserwuje jak telefony przejmują władzę nad Internetem. Ponad połowa ruchu na Allegro pochodzi z urządzeń mobilnych, a większość tego ruchu to aplikacje natywne. Żarty się skończyły ;) Kamil opowie Wam jak specjaliści mobilni z Allegro skalują development swojej aplikacji.","contentSnippet":"Cały świat obserwuje jak telefony przejmują władzę nad Internetem. Ponad połowa ruchu na Allegro pochodzi z urządzeń mobilnych, a większość tego ruchu to aplikacje natywne. Żarty się skończyły ;) Kamil opowie Wam jak specjaliści mobilni z Allegro skalują development swojej aplikacji.","guid":"https://podcast.allegro.tech/mobile_w_allegro","isoDate":"2020-06-01T00:00:00.000Z","itunes":{"author":"Kamil Borzym","summary":"Cały świat obserwuje jak telefony przejmują władzę nad Internetem. Ponad połowa ruchu na Allegro pochodzi z urządzeń mobilnych, a większość tego ruchu to aplikacje natywne. Żarty się skończyły ;) Kamil opowie Wam jak specjaliści mobilni z Allegro skalują development swojej aplikacji.","explicit":"false"}}]},"__N_SSG":true},"page":"/","query":{},"buildId":"KwlZP99Dv_a2UHYXdvD_o","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-3cb8f7ab5d3930a1a759.js"></script><script src="/_next/static/chunks/main-23f4f2620a057c84f895.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.b1290caeda235fc7bf40.js" async=""></script><script src="/_next/static/chunks/b651a894a35ea1e7d121ee74b6c7e8aa31faf049.71d68ec00d361c7548dd.js" async=""></script><script src="/_next/static/chunks/6753331a3a54fd35bc7d92cbaee2b67e833d028a.8bec33551a885abbb7ba.js" async=""></script><script src="/_next/static/chunks/pages/_app-3ea8ca3d27590bc99614.js" async=""></script><script src="/_next/static/chunks/pages/index-93b51828b776106500ba.js" async=""></script><script src="/_next/static/KwlZP99Dv_a2UHYXdvD_o/_buildManifest.js" async=""></script><script src="/_next/static/KwlZP99Dv_a2UHYXdvD_o/_ssgManifest.js" async=""></script></body></html>