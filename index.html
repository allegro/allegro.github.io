<!DOCTYPE html><html lang="pl"><head><meta charSet="utf-8"/><link rel="prefetch" href="https://allegrotechio.disqus.com/count.js"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="description" content="Allegro Tech to miejsce, w którym nasi inżynierowie dzielą się wiedzą oraz case study z wybranych projektów w firmie - w formie artykułów, podcastów oraz eventów."/><title>Allegro Tech</title><meta property="og:site_name" content="allegro.tech"/><meta property="og:title" content="allegro.tech"/><meta property="og:url" content="https://allegro.tech"/><meta property="og:type" content="site"/><meta property="og:image" content="https://allegro.tech/images/allegro-tech.png"/><link rel="shortcut icon" href="favicon.ico"/><link rel="canonical" href="https://allegro.tech" itemProp="url"/><link rel="preload" href="images/splash.jpg" as="image"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-1M1FJ5PXWW"></script><script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){dataLayer.push(arguments);}
                    gtag('js', new Date());
                    gtag('config', 'G-1M1FJ5PXWW');
                </script><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/e5a9b65c57af5a2ed385.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e5a9b65c57af5a2ed385.css" data-n-g=""/><link rel="preload" href="/_next/static/css/8df955f35e5a737ca619.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8df955f35e5a737ca619.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-7da1b803342e313adbbe.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.d92cd1f5a85f231dd617.js" as="script"/><link rel="preload" href="/_next/static/chunks/b651a894a35ea1e7d121ee74b6c7e8aa31faf049.71d68ec00d361c7548dd.js" as="script"/><link rel="preload" href="/_next/static/chunks/6753331a3a54fd35bc7d92cbaee2b67e833d028a.41151956cb3ac59ffc26.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-b8da8a2456a23c81c70b.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/index-95d218a9f8cafc4e6d3f.js" as="script"/></head><body><div id="__next"><header class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card Header_navbar__2vWRp m-color-bg_card"><nav class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-display-flex m-flex-justify-between m-flex-items-center"><a href="/"><img src="images/logo.svg" alt="Allegro Tech" width="205" height="45"/></a><div><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0 m-display-flex@lg m-display-none"><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://blog.allegro.tech">Blog</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://podcast.allegro.tech">Podcast</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://github.com/Allegro">Open Source</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://www.meetup.com/allegrotech/events">Wydarzenia</a></li><li class="m-margin-left-16@lg"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display-block m-display-inline@lg m-padding-left-16 m-padding-right-16 m-padding-top-16 m-padding-bottom-16 m-padding-left-0@lg m-padding-top-0@lg m-padding-right-0@lg m-padding-bottom-0@lg m-link--signal m-line-height_21" href="https://praca.allegro.pl">Praca</a></li></ul><button class="m-display-none@lg m-height_40 m-line-height_40 m-border-style-top_none m-border-style-right_none m-border-style-bottom_none m-border-style-left_none m-border-radius-top-left_2 m-border-radius-top-right_2 m-border-radius-bottom-left_2 m-border-radius-bottom-right_2 m-cursor_pointer m-overflow_hidden m-appearance_none m-padding-left_4 m-padding-right_4 m-padding-top_4 m-padding-bottom_4 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button" style="background:transparent" aria-label="Otwórz menu"><img src="https://assets.allegrostatic.com/metrum/icon/menu-23e046bf68.svg" alt="" class="m-icon" width="32" height="32"/></button></div></nav></header><div class="Header_hero__n5PN5"><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-display-flex m-flex-column m-flex-justify-end Header_image__15JNc"><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-color-bg_desk"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text  m-font-weight_100 m-font-size_32 m-font-size_43_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125">O nas</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">Allegro to jedna z najbardziej zaawansowanych technologicznie firm w naszej części Europy. Allegro to również ponad 1000 specjalistów IT, różnych specjalizacji, rozwijających nasz serwis. Unikatowa skala i złożoność problemów, które rozwiązujemy na co dzień, dają nam możliwość rozwoju przy bardzo różnorodnych projektach. Allegro Tech to miejsce, w którym nasi inżynierowie dzielą się wiedzą oraz case study z wybranych projektów w firmie – w formie artykułów, podcastów oraz eventów.</p></div></div></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Blog</h2><div class="m-display_flex m-flex-wrap_1 m-flex-grow_1 m-grid"><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2021/04/kotlin-scripting.html" title="Kotlin - a language for everyone and for everything. Even scripts."><img width="388" src="images/post-headers/default.jpg" alt="Kotlin - a language for everyone and for everything. Even scripts." class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2021/04/kotlin-scripting.html" title="Kotlin - a language for everyone and for everything. Even scripts." class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Kotlin - a language for everyone and for everything. Even scripts.</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">13 dni temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/tech">#<!-- -->tech</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/kotlin">#<!-- -->kotlin</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/script">#<!-- -->script</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">According to Wikipedia there are approximately 700 computer languages available. Seven hundred.
This is an unbelievable number and it’s the reason why programmers face the problem…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__1CeVw"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Weronika Orczyk" src="https://blog.allegro.tech/img/authors/weronika.orczyk.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/weronika.orczyk">Weronika Orczyk</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2021/04/kotlin-scripting.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2021/04/kotlin-scripting.html">przejdź do wpisu</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2021/03/digging-into-allegro-how-i-started-testing-career.html" title="Digging into Allegro, or how I started my testing career"><img width="388" src="images/post-headers/testing.png" alt="Digging into Allegro, or how I started my testing career" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2021/03/digging-into-allegro-how-i-started-testing-career.html" title="Digging into Allegro, or how I started my testing career" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Digging into Allegro, or how I started my testing career</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">około miesiąc temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/tech">#<!-- -->tech</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/testing">#<!-- -->testing</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/intern">#<!-- -->intern</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/career change">#<!-- -->career change</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">Maybe it’s another “How I’ve changed my worklife” story, but I hope it is an interesting one. It seems quite important to tell: before the…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__1CeVw"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Aleksandra Kulesz" src="https://blog.allegro.tech/img/authors/aleksandra.kulesz.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/aleksandra.kulesz">Aleksandra Kulesz</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2021/03/digging-into-allegro-how-i-started-testing-career.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2021/03/digging-into-allegro-how-i-started-testing-career.html">przejdź do wpisu</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2021/03/state-machines-made-easy.html" title="Finite-state machines made easy"><img width="388" src="images/post-headers/default.jpg" alt="Finite-state machines made easy" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2021/03/state-machines-made-easy.html" title="Finite-state machines made easy" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Finite-state machines made easy</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">około 2 miesiące temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/tech">#<!-- -->tech</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/dotnet">#<!-- -->dotnet</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/state_machine">#<!-- -->state_machine</a></li><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/allegro_pay">#<!-- -->allegro_pay</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">Coordinating complex processes, both business and technical, can be a challenging issue in a distributed system.
Especially when the complications associated with them, such as concurrency,…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__1CeVw"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Tymon Felski" src="https://blog.allegro.tech/img/authors/tymon.felski.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/tymon.felski">Tymon Felski</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2021/03/state-machines-made-easy.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2021/03/state-machines-made-easy.html">przejdź do wpisu</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://blog.allegro.tech/2021/02/first-days-at-allegro.html" title="My first days at Allegro"><img width="388" src="images/post-headers/default.jpg" alt="My first days at Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://blog.allegro.tech/2021/02/first-days-at-allegro.html" title="My first days at Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">My first days at Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">2 miesiące temu</time><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0"><li class="m-margin-right-8 m-display-inline-block"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/hashtag/tech">#<!-- -->tech</a></li></ul><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1 m-padding-top-16">So you’re new to Allegro, have just finished your tech onboarding and are stunned with information overflow? Or perhaps you
are planning to join Allegro and…</p><div class="m-display-flex m-flex-justify-between m-padding-top-16 m-flex-items_center"><div class="m-display-flex m-flex-items_center"><div class="MuiAvatarGroup-root m-padding-right_16 Post_avatars__1CeVw"><div class="MuiAvatar-root MuiAvatar-circle MuiAvatarGroup-avatar" style="z-index:1"><img alt="Krzysztof Przychodzki" src="https://blog.allegro.tech/img/authors/krzysztof.przychodzki.jpg" class="MuiAvatar-img" width="32" height="32"/></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/authors/krzysztof.przychodzki">Krzysztof Przychodzki</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://blog.allegro.tech/2021/02/first-days-at-allegro.html#disqus_thread">0 Comments</a></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech/2021/02/first-days-at-allegro.html">przejdź do wpisu</a></div></article></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://blog.allegro.tech">Zobacz więcej wpisów</a></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Podcasty</h2><div class="m-display_flex m-flex-wrap_1 m-flex-grow_1 m-grid"><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/inzynier_w_zespole_produktowym" title="Inżynier w zespole produktowym"><img src="images/podcast.png" alt="Inżynier w zespole produktowym" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/inzynier_w_zespole_produktowym" title="Inżynier w zespole produktowym" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Inżynier w zespole produktowym</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">3 dni temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Czym zajmuje się Team Leader w Allegro? Jak wygląda cykl życia oprogramowania w zespole produktowym? Jaka jest rola inżyniera oprogramowania w rozwoju produktu? W jaki sposób wykorzystujemy w Allegro Event Storming? Jakich technologii używają programiści w zespołach produktowych? Między innymi o tym opowie Michał Bareja, Team Manager w Allegro, w rozmowie z Piotrem Betkierem.</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/inzynier_w_zespole_produktowym">Posłuchaj odcinka</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/data_scientist_w_allegro" title="Data Scientist w Allegro"><img src="images/podcast.png" alt="Data Scientist w Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/data_scientist_w_allegro" title="Data Scientist w Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Data Scientist w Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">9 dni temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Czym zajmuje się Data Scientist? Jak wygląda proces budowania modeli danych? Jak klasyczne i bayesowskie metody statystyczne pozwalają nam odpowiedzieć na pytanie “dlaczego”? Czym różni się korelacja od kauzacji i jak estymować efekty różnego rodzaju zmian, nawet gdy nie możemy przeprowadzić testów AB? Odpowiedzi na te pytania znajdziecie w najnowszym podcascie, którego gościem jest Julia Bluszcz.</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/data_scientist_w_allegro">Posłuchaj odcinka</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/swiat_product_managera_w_allegro" title="Świat Product Managera w Allegro"><img src="images/podcast.png" alt="Świat Product Managera w Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/swiat_product_managera_w_allegro" title="Świat Product Managera w Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Świat Product Managera w Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">17 dni temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Jak tworzy się produkty dla milionów kupujących? Jak wygląda warsztat i ekosystem Product Managera w Allegro? Jak zaskakujące jest Allegro od środka? Jak mądrze wykorzystywać dane w pracy Product Managera? I jak w Allegro jeśli się chce, to można realizować się nie tylko jako pracownik, ale człowiek? Nie tylko to, ale też wiele wiele więcej w rozmowie z Piotrkiem, odkryje przed Wami Ola Wasielewska - Senior Product Manager w Allegro.</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/swiat_product_managera_w_allegro">Posłuchaj odcinka</a></div></article></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--3@xl m-display-flex m-flex-direction_column"><article class="m-margin-bottom_16 m-display-flex m-flex-column m-flex-grow_1"><a href="https://podcast.allegro.tech/logistyka_na_platformie_allegro" title="Logistyka na platformie Allegro"><img src="images/podcast.png" alt="Logistyka na platformie Allegro" class="m-display-block m-width-fluid"/></a><div class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-column m-flex-grow_1 m-padding-bottom-0 m-color-bg_card"><a href="https://podcast.allegro.tech/logistyka_na_platformie_allegro" title="Logistyka na platformie Allegro" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Logistyka na platformie Allegro</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-bottom-16">około miesiąc temu</time><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-flex-grow-1">Jak zarządzać zespołem ponad 100 osób? Jak rozwijać motywację, pasję i potencjał swoich pracowników? Na co zwracać uwagę? Jakie inspiracje można czerpać ze sportu w zarządzaniu? Jak zorganizować swoją pracę? O tym opowie Jakub Kaczmarski - Technology Director odpowiadając za obszar Delivery Experience i Allegro Smart! na platformie Allegro.</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech/logistyka_na_platformie_allegro">Posłuchaj odcinka</a></div></article></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://podcast.allegro.tech">Zobacz więcej podcastów</a></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Wydarzenia</h2><div class="m-display_flex m-flex-wrap_1 m-flex-grow_1 m-grid"><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/277660388/" title="Allegro Tech Labs #8 Online: Praktyczne prognozowanie w Allegro " class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="Allegro Tech Labs #8 Online: Praktyczne prognozowanie w Allegro "/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/277660388/" title="Allegro Tech Labs #8 Online: Praktyczne prognozowanie w Allegro " class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Allegro Tech Labs #8 Online: Praktyczne prognozowanie w Allegro </h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">za 11 dni<!-- -->, <!-- -->Online event</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">***REJESTRACJA***Ze względu na ograniczoną liczbę miejsc, prosimy o rejestrację na wydarzenie poprzez stronę: https://app.evenea.pl/event/allegro-tech-labs-8/Wybierając przycisk &quot;Chcę wziąć udział w warsztatach&quot; przeniesiesz się na formularz rejestracyjny…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/277660388/">Szczegóły</a></article></div></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/277320825/" title="Allegro Tech Live #17 - iOS pod maską" class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="Allegro Tech Live #17 - iOS pod maską"/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/277320825/" title="Allegro Tech Live #17 - iOS pod maską" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Allegro Tech Live #17 - iOS pod maską</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">10 dni temu<!-- -->, <!-- -->Online event</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale tym razem to my…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/277320825/">Szczegóły</a></article></div></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/277005370/" title="Allegro Tech Labs #7 Online: System design workshop" class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="Allegro Tech Labs #7 Online: System design workshop"/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/277005370/" title="Allegro Tech Labs #7 Online: System design workshop" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">Allegro Tech Labs #7 Online: System design workshop</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">18 dni temu<!-- -->, <!-- -->Online event</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">***REJESTRACJA***Prosimy o rejestrację na wydarzenie poprzez stronę: https://app.evenea.pl/event/allegro-tech-labs-7/. Po kliknięciu przycisku &quot;Chcę wziąć udział w warsztatach&quot; przeniesiesz się na formularz rejestracyjny - prosimy o udzielenie…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/277005370/">Szczegóły</a></article></div></div><div class="m-grid__col m-grid__col--12 m-grid__col--6@sm m-grid__col--6@xl m-display-flex m-flex-direction_column"><div class="m-margin-bottom_16 m-display-flex m-flex-direction_column m-flex-direction_row_sm m-padding-bottom_0"><a href="https://www.meetup.com/allegrotech/events/276893259/" title="#16 Allegro Tech Live - Jak dostać się do Allegro?" class="m-display_none m-display_block_lg" style="background-color:#fd4a02"><img width="218" src="images/event.png" alt="#16 Allegro Tech Live - Jak dostać się do Allegro?"/></a><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-display-flex m-flex-direction_column m-padding-bottom_0 m-flex_1 m-flex-justify_between m-color-bg_card"><a href="https://www.meetup.com/allegrotech/events/276893259/" title="#16 Allegro Tech Live - Jak dostać się do Allegro?" class="m-text-decoration_none"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm" style="text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;min-height:2em;overflow:hidden">#16 Allegro Tech Live - Jak dostać się do Allegro?</h2></a><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text">24 dni temu<!-- -->, <!-- -->Online event</time><time class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-padding-top-8">Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale tym razem to my…</time><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-margin-top-16 m-display_block m-border-width_1 m-border-color_gray m-border-style-top_solid m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/276893259/">Szczegóły</a></article></div></div></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.meetup.com/allegrotech/events/">Zobacz więcej wydarzeń</a></div><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_300 m-font-size_27 m-font-size_36_sm m-margin-bottom_16 m-margin-bottom_24_sm m-line-height_125 m-padding-left-24 m-padding-right-24">Oferty pracy</h2><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto"><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Database Engineer</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Poznań, Warszawa, Toruń</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999744024026-database-engineer?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">UX Researcher</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Poznań, Kraków, Toruń</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999743961962-ux-researcher?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Front-End Software Engineer</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Poznań, Warszawa</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999743960660-front-end-software-engineer?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Team Leader - DAX</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Warszawa, Poznań, Kraków, Toruń</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999743853021-team-leader-dax?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article><article class="m-padding-top_16 m-padding-top_24_lg m-padding-right_16 m-padding-right_24_lg m-padding-bottom_16 m-padding-bottom_24_lg m-padding-left_16 m-padding-left_24_lg m-card m-margin-bottom_16 m-display-flex m-flex-justify_between m-flex-items-center m-flex-direction_column m-flex-direction_row_md m-color-bg_card"><h2 class="m-font-family_roboto m-margin-left_0 m-margin-right_0 m-margin-top_0 m-color_text m-font-weight_500 m-line-height_130 m-margin-bottom_8 m-margin-bottom_16_sm m-font-size_21 m-font-size_25_sm m-margin-bottom_0_sm m-flex-grow_1">Business Application Administrator (Cognos)</h2><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-font-size_21 m-font-size_25_sm m-font-weight_300 m-line-height_normal m-margin-top_16 m-text-align_left m-padding-right_16">Poznań, Warszawa</p><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://www.smartrecruiters.com/Allegro/743999743641840-business-application-administrator-cognos?trid=de9dfdf3-7f9e-4ebf-8a64-49f6c69ad640">Sprawdź</a></article></div><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-display_block m-margin-bottom_8 m-width_100 m-height_40 m-line-height_40 m-text-transform_uppercase m-letter-spacing_2 m-white-space_nowrap m-cursor_pointer m-overflow_hidden m-padding-left_16 m-padding-right_16 m-padding-top_0 m-padding-bottom_0 m-outline-style_dotted--focus m-outline-width_2 m-outline-color_teal m-outline-offset_n2 m-button m-box_border m-text-align_center m-display_inline-block m-color_secondary m-background-position_50p m-background-size_5000p m-transition-property_background-color m-transition-duration_fast m-button--secondary" href="https://allegro.pl/praca">Zobacz więcej ofert</a></div><footer class="m-color-bg_navy m-margin-top-32"><div class="m-width-max_1600 m-margin-left_auto m-margin-right_auto m-padding-top-24 m-padding-bottom-24 m-display-flex@sm m-flex-justify-between m-flex-items-center m-text-align_center"><p class="m-font-family_sans m-line-height_21 m-font-size_14 m-text-size-adjust_100p m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-color_text m-color_white m-padding-left-24@sm">Proudly built by Allegro Tech engineers</p><ul class="m-font-family_sans m-font-size_14 m-line-height_21 m-color_text m-text-size-adjust_100p m-list-style-type_none m-margin-top_0 m-margin-right_0 m-margin-bottom_0 m-margin-left_0 m-padding-top_0 m-padding-right_0 m-padding-bottom_0 m-padding-left_0 m-display-flex m-flex-justify-center"><li style="filter:brightness(0) invert(1);opacity:0.5" class="m-margin-right-8 m-margin-top-16 m-margin-top-0@sm m-color_white"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://github.com/allegro"><img src="https://assets.allegrostatic.com/metrum/icon/github-6a18df1729.svg" alt="Github" class="m-icon"/></a></li><li style="filter:brightness(0) invert(1);opacity:0.5" class="m-margin-right-8 m-margin-top-16 m-margin-top-0@sm m-color_white"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://www.facebook.com/allegro.tech/"><img src="https://assets.allegrostatic.com/metrum/icon/facebook-a2b92f9dcb.svg" alt="Facebook" class="m-icon"/></a></li><li style="filter:brightness(0) invert(1);opacity:0.5" class="m-margin-right-8 m-margin-top-16 m-margin-top-0@sm m-color_white"><a class="m-font-size_14 m-font-family_sans m-color_text m-text-decoration_none m-text-size-adjust_100p m-cursor_pointer m-link m-line-height_21" href="https://twitter.com/allegrotech"><img src="https://assets.allegrostatic.com/metrum/icon/twitter-25164a58aa.svg" alt="Twitter" class="m-icon"/></a></li></ul></div></footer><div style="visibility:hidden;height:0;overflow:hidden;position:relative"><img alt="doubleclick" width="1" height="1" style="position:absolute" src="https://pubads.g.doubleclick.net/activity;dc_iu=/21612525419/DFPAudiencePixel;ord=8287801882942.651;dc_seg=507368552?"/><img alt="fb" height="1" width="1" style="position:absolute" src="https://www.facebook.com/tr?id=1650870088530325&amp;ev=PageView&amp;noscript=1"/></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"title":"Kotlin - a language for everyone and for everything. Even scripts.","link":"https://blog.allegro.tech/2021/04/kotlin-scripting.html","pubDate":"Tue, 13 Apr 2021 00:00:00 +0200","authors":{"author":[{"name":["Weronika Orczyk"],"photo":["https://blog.allegro.tech/img/authors/weronika.orczyk.jpg"],"url":["https://blog.allegro.tech/authors/weronika.orczyk"]}]},"content":"\u003cp\u003eAccording to Wikipedia there are approximately 700 computer languages available. Seven hundred.\nThis is an unbelievable number and it’s the reason why programmers face the problem of\nchoosing a programming language to work with, which frameworks to use and which tech stack to learn.\nAll of them have pros and cons, but when looking for an all-purpose language you should take Kotlin\ninto consideration and ask yourself the question: “Do I really need another programming language?”.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-04-13-scripting.jpg\" alt=\"scripting\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eKotlin is an open source, statically typed and powerful language. It takes inspiration from many programming languages like Java,\nScala, C#, Groovy, Python and it attempts to combine the best features from each. The support for multiplatform programming\nis one of Kotlin’s key benefits. It is able to compile to many platforms including Android, JVM, JavaScript and native.\u003c/p\u003e\n\n\u003cp\u003eKotlin is great for building applications, but what if you need to write a script? The first thing that comes to mind is to use\na classic, traditional shell script or Python, what gives you the ability to move files, copy, delete and more by running\na program from command-line. But if Kotlin is your cup of tea, it can be also used as a scripting language!\u003c/p\u003e\n\n\u003cp\u003eWhen talking about shell scripts, I have to mention their syntax, which can be unclear and enigmatic. It is really hard to write\na clear piece of code in a complex script. Another drawback is long execution time. Shell scripts are simply slow due to almost\nevery executed shell command’s need to launch a new process. Additionally, there are compatibility problems between platforms.\nThe creator of Perl, Larry Wall, famously wrote that “It is easier to port a shell than a shell script.”\u003c/p\u003e\n\n\u003cp\u003eI’ve mentioned slow execution of shell scripts due to creation of a new process every command. It’s true,\nbut on the other hand spinning up a new JVM to execute a script and a compilation process is also long. The execution time usually\ndepends on a machine and distribution of JVM. It can be a bit frustrating when Java version is inappropriate for an executed script\nor when some machines use different operating system, what can lead to compatibility issues.\u003c/p\u003e\n\n\u003cp\u003eSo how about Python? It provides lots of useful libraries covering almost any needs and is available on most systems,\nessentially eliminating the problem of compatibility.\u003c/p\u003e\n\n\u003cp\u003eWhile scripts written in Python are more readable than shell scripts, they aren’t type-safe in the way that Kotlin\nis. Kotlin is statically typed, what means that types are verified during compilation, and strongly typed, i.e.\nthe type of a variable cannot change after its declaration. In contrast to a dynamically typed language, including Python,\nit helps prevent all kinds of incompatible type errors. It brings the opportunity to create scripts that help automate\nmundane tasks, but doing it in a much safer way.\u003c/p\u003e\n\n\u003cp\u003eLet’s move to the code and see Kotlin scripts in practice.\u003c/p\u003e\n\n\u003ch3 id=\"install-kotlin-for-scripting\"\u003eInstall Kotlin for scripting\u003c/h3\u003e\n\u003cp\u003eIn order to allow scripting, you need to make Kotlin available for the entire system. Open a terminal and check if Kotlin is\ninstalled:\u003c/p\u003e\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ekotlinc -version\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp\u003eIf the command was not found, the easiest way to install Kotlin on UNIX-based systems such as OS X,\nLinux, Cygwin, FreeBSD, and Solaris is SDKMAN!. Install Kotlin with the command:\u003c/p\u003e\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003esdk install kotlin\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAlternatively, on OS X you can install the compiler via Homebrew:\u003c/p\u003e\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ebrew install kotlin\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp\u003eCheck the Kotlin version again.\u003c/p\u003e\n\n\u003ch3 id=\"first-script\"\u003eFirst script\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/Kotlin/KEEP/blob/master/proposals/scripting-support.md\"\u003eKotlin Evolution and Enhancement Process (KEEP) document\u003c/a\u003e\nwas created to explain Kotlin scripting. It presents use cases of scripting with examples and contains the general proposal,\nbut it is still a draft. According to this file, a Kotlin script is a simple Kotlin snippet. Each command in the file is\nexecuted as if it was in the main function. To make a file executable, the file has to be named \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e*.kts\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eCreate the first script and name the file \u003ccode class=\"language-plaintext highlighter-rouge\"\u003efirst-script.kts\u003c/code\u003e.\u003c/p\u003e\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003etouch first-script.kts\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp\u003eEdit file and add some code:\u003c/p\u003e\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003eprintln(\"Hello, it’s your first script called with args:\")\nargs.forEach {\n    println(\"* $it\")\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp\u003eAnd run it with example arguments:\u003c/p\u003e\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ekotlinc -script first-script.kts test 'test with space'\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp\u003eYou should see the result:\u003c/p\u003e\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003eHello, it’s your first script called with args:\n* test\n* test with space\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp\u003eReally simple! In addition, scripts can use Java or Kotlin stlib to have access to more powerful libraries.\nOf course, functions and classes can be used to make the script more readable and easy to maintain.\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003eimport java.io.File\n\nfun printDirs() {\n    File(\".\").listFiles { file -\u0026gt; file.isDirectory }?.forEach {\n        println(it)\n    }\n}\n\nprintDirs()\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3 id=\"kotlin-main-kts\"\u003eKotlin-main-kts\u003c/h3\u003e\n\u003cp\u003eKotlin-main-kts is a solution provided by the Kotlin team. The 1.3.70 version brought a set of improvements that\nprovide a better experience of using Kotlin scripts with IntelliJ IDEA and Kotlin command-line tools.\nMore details can be found in \u003ca href=\"https://blog.jetbrains.com/kotlin/2020/03/kotlin-1-3-70-released/\"\u003ea release blog post\u003c/a\u003e.\nAll you need to use kotlin-main-kts is to create a file named \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e*.main.kts\u003c/code\u003e and execute script.\u003c/p\u003e\n\n\u003cp\u003eMoreover, from 1.3.70 on, it is easier to run the program. The command is:\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ekotlin myscript.main.kts\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eUsing kotlin-main-kts has a lot of advantages. \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e*.main.kts\u003c/code\u003e scripts are supported out of the box in IntelliJ,\neven outside the source directories. It gives you highlighting and navigation, autocompletes code\nand resolves dynamic dependencies. What’s more, third party libraries can be used in scripts by\nincluding them as dependencies using directives or annotations specified with gradle-style with group ID,\nartifact ID and version. For example, if you write a script which copies data from a CSV file and inserts the data\ninto a database, you need to use a connector. You can achieve this by \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e@file:DependsOn\u003c/code\u003e annotation. The example below shows\nhow to connect to a MongoDB database. A database \u003cem\u003eURL\u003c/em\u003e is required as an argument e.g. \u003ccode class=\"language-plaintext highlighter-rouge\"\u003emongodb://localhost:27017/test-db\u003c/code\u003e\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e@file:Repository(\"https://jcenter.bintray.com\")\n@file:DependsOn(\"org.mongodb:mongo-java-driver:3.12.8\")\n\nimport com.mongodb.client.MongoClients\n\nfun createConnection(url: String) =\n    MongoClients.create(url).use {\n        println(\"Connected to MongoDB!\")\n    }\n\nval (mongoUrl) = args\ncreateConnection(mongoUrl)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWhat’s interesting, it is also possible to execute a script exactly in the same way as an executable file - for example by\ncommand \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e./kotlin-script.main.kts\u003c/code\u003e. The first line in a file makes difference. It is required to add \u003ccode class=\"language-plaintext highlighter-rouge\"\u003e#!/usr/bin/env kotlin\u003c/code\u003e\nat the beginning of script to run it in such way.\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e#!/usr/bin/env kotlin\nprintln(\"Hello, world!\")\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3 id=\"kscript\"\u003eKscript\u003c/h3\u003e\n\n\u003cp\u003eAlso, I have to mention \u003ca href=\"https://github.com/holgerbrandl/kscript\"\u003eKscript\u003c/a\u003e. It is one of the ways to support scripting in\nKotlin. Actually, it is a wrapper around kotlinc which adds some features. After Kscript installation you can easily run\nscript by command:\u003c/p\u003e\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003ekscript first-script.kts\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThis tool was created in 2016. In the beginning, Kotlin wasn’t feature-rich enough to be a viable alternative to the\nshell. \u003ca href=\"https://www.youtube.com/watch?v=cOJPKhlRa8c\"\u003eThe great talk on Kotlin Conf by Holger Brandl\u003c/a\u003e shows the\nhistory of its creation and explains that initially the tool was created for data science purposes.\u003c/p\u003e\n\n\u003cp\u003eThe creators listed such advantages as:\u003c/p\u003e\n\u003cul\u003e\n  \u003cli\u003ecompiled script caching (using md5 checksums)\u003c/li\u003e\n  \u003cli\u003edependency declarations using gradle-style resource locators and automatic dependency resolution\u003c/li\u003e\n  \u003cli\u003epossibility to deploy scripts as standalone binaries\u003c/li\u003e\n  \u003cli\u003einlined usage - you don’t need to create script file\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIn my opinion, the cache mechanism is the biggest advantage of using Kscript tool. Whenever you run a script with kotlinc\nit is recompiled, which makes it slow. Each time the script is started, Kscripts checks if code has been modified since the last\ncompilation (by hashing the content of the script). If file wasn’t changed, cached version is immediately executed. The\ntable below shows time of execution of the same script by \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ekotlinc\u003c/code\u003e command and Kscript. As we can see, the cache has a\npositive effect on execution time.\u003c/p\u003e\n\n\u003ctable\u003e\n  \u003cthead\u003e\n    \u003ctr\u003e\n      \u003cth\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etime kotlinc -script script.kts\u003c/code\u003e\u003c/th\u003e\n      \u003cth\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003etime kscript script.kts\u003c/code\u003e\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003ctd\u003e2.930s\u003c/td\u003e\n      \u003ctd\u003e3.972s\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd\u003e2.991s\u003c/td\u003e\n      \u003ctd\u003e0.868s\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd\u003e2.968s\u003c/td\u003e\n      \u003ctd\u003e0.912s\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eKotlin v1.4 brought a much improved scripting integration. But until Kotlin scripting interpreter isn’t rich and\nversatile, Kscript will be supported and developed.\u003c/p\u003e\n\n\u003ch3 id=\"conclusion\"\u003eConclusion\u003c/h3\u003e\n\u003cp\u003eKotlin makes scripting really easy. Powerful scripts can be created with the autocompletion and the strong typing,\nmaking them really readable and highly maintainable.\u003c/p\u003e\n\n\u003cp\u003eHappy scripting!\u003c/p\u003e\n","contentSnippet":"According to Wikipedia there are approximately 700 computer languages available. Seven hundred.\nThis is an unbelievable number and it’s the reason why programmers face the problem of\nchoosing a programming language to work with, which frameworks to use and which tech stack to learn.\nAll of them have pros and cons, but when looking for an all-purpose language you should take Kotlin\ninto consideration and ask yourself the question: “Do I really need another programming language?”.\n\nKotlin is an open source, statically typed and powerful language. It takes inspiration from many programming languages like Java,\nScala, C#, Groovy, Python and it attempts to combine the best features from each. The support for multiplatform programming\nis one of Kotlin’s key benefits. It is able to compile to many platforms including Android, JVM, JavaScript and native.\nKotlin is great for building applications, but what if you need to write a script? The first thing that comes to mind is to use\na classic, traditional shell script or Python, what gives you the ability to move files, copy, delete and more by running\na program from command-line. But if Kotlin is your cup of tea, it can be also used as a scripting language!\nWhen talking about shell scripts, I have to mention their syntax, which can be unclear and enigmatic. It is really hard to write\na clear piece of code in a complex script. Another drawback is long execution time. Shell scripts are simply slow due to almost\nevery executed shell command’s need to launch a new process. Additionally, there are compatibility problems between platforms.\nThe creator of Perl, Larry Wall, famously wrote that “It is easier to port a shell than a shell script.”\nI’ve mentioned slow execution of shell scripts due to creation of a new process every command. It’s true,\nbut on the other hand spinning up a new JVM to execute a script and a compilation process is also long. The execution time usually\ndepends on a machine and distribution of JVM. It can be a bit frustrating when Java version is inappropriate for an executed script\nor when some machines use different operating system, what can lead to compatibility issues.\nSo how about Python? It provides lots of useful libraries covering almost any needs and is available on most systems,\nessentially eliminating the problem of compatibility.\nWhile scripts written in Python are more readable than shell scripts, they aren’t type-safe in the way that Kotlin\nis. Kotlin is statically typed, what means that types are verified during compilation, and strongly typed, i.e.\nthe type of a variable cannot change after its declaration. In contrast to a dynamically typed language, including Python,\nit helps prevent all kinds of incompatible type errors. It brings the opportunity to create scripts that help automate\nmundane tasks, but doing it in a much safer way.\nLet’s move to the code and see Kotlin scripts in practice.\nInstall Kotlin for scripting\nIn order to allow scripting, you need to make Kotlin available for the entire system. Open a terminal and check if Kotlin is\ninstalled:\n\nkotlinc -version\n\n\nIf the command was not found, the easiest way to install Kotlin on UNIX-based systems such as OS X,\nLinux, Cygwin, FreeBSD, and Solaris is SDKMAN!. Install Kotlin with the command:\n\nsdk install kotlin\n\n\nAlternatively, on OS X you can install the compiler via Homebrew:\n\nbrew install kotlin\n\n\nCheck the Kotlin version again.\nFirst script\nKotlin Evolution and Enhancement Process (KEEP) document\nwas created to explain Kotlin scripting. It presents use cases of scripting with examples and contains the general proposal,\nbut it is still a draft. According to this file, a Kotlin script is a simple Kotlin snippet. Each command in the file is\nexecuted as if it was in the main function. To make a file executable, the file has to be named *.kts.\nCreate the first script and name the file first-script.kts.\n\ntouch first-script.kts\n\n\nEdit file and add some code:\n\nprintln(\"Hello, it’s your first script called with args:\")\nargs.forEach {\n    println(\"* $it\")\n}\n\n\nAnd run it with example arguments:\n\nkotlinc -script first-script.kts test 'test with space'\n\n\nYou should see the result:\n\nHello, it’s your first script called with args:\n* test\n* test with space\n\n\nReally simple! In addition, scripts can use Java or Kotlin stlib to have access to more powerful libraries.\nOf course, functions and classes can be used to make the script more readable and easy to maintain.\n\nimport java.io.File\n\nfun printDirs() {\n    File(\".\").listFiles { file -\u003e file.isDirectory }?.forEach {\n        println(it)\n    }\n}\n\nprintDirs()\n\n\nKotlin-main-kts\nKotlin-main-kts is a solution provided by the Kotlin team. The 1.3.70 version brought a set of improvements that\nprovide a better experience of using Kotlin scripts with IntelliJ IDEA and Kotlin command-line tools.\nMore details can be found in a release blog post.\nAll you need to use kotlin-main-kts is to create a file named *.main.kts and execute script.\nMoreover, from 1.3.70 on, it is easier to run the program. The command is:\n\nkotlin myscript.main.kts\n\n\nUsing kotlin-main-kts has a lot of advantages. *.main.kts scripts are supported out of the box in IntelliJ,\neven outside the source directories. It gives you highlighting and navigation, autocompletes code\nand resolves dynamic dependencies. What’s more, third party libraries can be used in scripts by\nincluding them as dependencies using directives or annotations specified with gradle-style with group ID,\nartifact ID and version. For example, if you write a script which copies data from a CSV file and inserts the data\ninto a database, you need to use a connector. You can achieve this by @file:DependsOn annotation. The example below shows\nhow to connect to a MongoDB database. A database URL is required as an argument e.g. mongodb://localhost:27017/test-db\n\n@file:Repository(\"https://jcenter.bintray.com\")\n@file:DependsOn(\"org.mongodb:mongo-java-driver:3.12.8\")\n\nimport com.mongodb.client.MongoClients\n\nfun createConnection(url: String) =\n    MongoClients.create(url).use {\n        println(\"Connected to MongoDB!\")\n    }\n\nval (mongoUrl) = args\ncreateConnection(mongoUrl)\n\n\nWhat’s interesting, it is also possible to execute a script exactly in the same way as an executable file - for example by\ncommand ./kotlin-script.main.kts. The first line in a file makes difference. It is required to add #!/usr/bin/env kotlin\nat the beginning of script to run it in such way.\n\n#!/usr/bin/env kotlin\nprintln(\"Hello, world!\")\n\n\nKscript\nAlso, I have to mention Kscript. It is one of the ways to support scripting in\nKotlin. Actually, it is a wrapper around kotlinc which adds some features. After Kscript installation you can easily run\nscript by command:\n\nkscript first-script.kts\n\n\nThis tool was created in 2016. In the beginning, Kotlin wasn’t feature-rich enough to be a viable alternative to the\nshell. The great talk on Kotlin Conf by Holger Brandl shows the\nhistory of its creation and explains that initially the tool was created for data science purposes.\nThe creators listed such advantages as:\ncompiled script caching (using md5 checksums)\ndependency declarations using gradle-style resource locators and automatic dependency resolution\npossibility to deploy scripts as standalone binaries\ninlined usage - you don’t need to create script file\nIn my opinion, the cache mechanism is the biggest advantage of using Kscript tool. Whenever you run a script with kotlinc\nit is recompiled, which makes it slow. Each time the script is started, Kscripts checks if code has been modified since the last\ncompilation (by hashing the content of the script). If file wasn’t changed, cached version is immediately executed. The\ntable below shows time of execution of the same script by kotlinc command and Kscript. As we can see, the cache has a\npositive effect on execution time.\ntime kotlinc -script script.kts\n      time kscript script.kts\n    \n2.930s\n      3.972s\n    \n2.991s\n      0.868s\n    \n2.968s\n      0.912s\n    \nKotlin v1.4 brought a much improved scripting integration. But until Kotlin scripting interpreter isn’t rich and\nversatile, Kscript will be supported and developed.\nConclusion\nKotlin makes scripting really easy. Powerful scripts can be created with the autocompletion and the strong typing,\nmaking them really readable and highly maintainable.\nHappy scripting!","guid":"https://blog.allegro.tech/2021/04/kotlin-scripting.html","categories":["tech","kotlin","script"],"isoDate":"2021-04-12T22:00:00.000Z","thumbnail":"images/post-headers/default.jpg"},{"title":"Digging into Allegro, or how I started my testing career","link":"https://blog.allegro.tech/2021/03/digging-into-allegro-how-i-started-testing-career.html","pubDate":"Tue, 23 Mar 2021 00:00:00 +0100","authors":{"author":[{"name":["Aleksandra Kulesz"],"photo":["https://blog.allegro.tech/img/authors/aleksandra.kulesz.jpg"],"url":["https://blog.allegro.tech/authors/aleksandra.kulesz"]}]},"content":"\u003cp\u003eMaybe it’s another “How I’ve changed my worklife” story, but I hope it is an interesting one. It seems quite important to tell: before the beginning of my\nAllegro adventure, I was working as… an archaeologist. It was both physical work on excavations and research work at my PhD studies. And the only thing that\nconnects my past work and the current one is: attention to detail.\u003c/p\u003e\n\n\u003cp\u003eI had been thinking about changing my career path for some time. I’ve got some IT-experienced friends and they convinced me to try my luck in that field. In the\nbeginning I learned some front-end technologies on my own. Later I systematized and developed my knowledge at a programming bootcamp. And started looking for a\njob. I sent my application to Allegro for a front-end developer offer. Unfortunately, my lack of experience (and probably knowledge, too) caused me not to get a\njob offer. However, someone from the HR squad encouraged me to not give up and try one more time with the \u003ca href=\"https://allegro.pl/praca/staze\"\u003eSummer eXperience internship program\u003c/a\u003e.\u003c/p\u003e\n\n\u003ch2 id=\"it-begins\"\u003eIt begins!\u003c/h2\u003e\n\n\u003cp\u003eI did it! I was invited to begin cooperation (as Test Engineer Intern) with Allegro’s teams responsible for developing listings (search result pages). First of\nJuly was the day when I and my 52 intern-colleagues started work. After a two-day long onboarding (a very intensive time filled with tons of useful pieces of\ninformation!), I met my teammates for the first time. During summertime anti-covid restrictions were not so strict and I was able to visit the office a few\ntimes. We discussed my responsibilities and they guided me through the listings domain.\u003c/p\u003e\n\n\u003cp\u003eIn the beginning of my internship I had to test manually our web and mobile-web solutions. For a person who never had anything to do with a complex\nmicroservices system it was quite a challenging experience. I needed to understand and learn how services work and communicate with each other. The next step\nwas to become familiar with test environments. Phoenix (development test environments) and Sandbox are very useful, but at the same time they are very fussy.\nYou have to be quite patient to work with those tools. And when you are a QA Engineer you work with them all the time! But it turned out to be just a warm up. I\nquickly learned how to test our mobile applications (both for Android and iOS) and write and maintain automatic tests in the \u003ca href=\"https://www.cypress.io/\"\u003eCypress framework\u003c/a\u003e.\nI was introduced to chaos and efficiency testing. I also wrote my first automatic tests in \u003ca href=\"https://developer.android.com/training/testing/espresso\"\u003eEspresso\u003c/a\u003e\nand TeaBiscuit (our internal tool). Every day brought something exciting and new, and still does.\u003c/p\u003e\n\n\u003ch2 id=\"what-do-i-like\"\u003eWhat do I like?\u003c/h2\u003e\n\n\u003cp\u003eMy favourite side of Allegro is knowledge sharing. Regarding common problems with technology or domain knowledge, I can always ask my supportive teammates, but\nthere is much more. We can take part in many interesting courses and workshops organised by people truly dedicated to their subjects. Among those are not only\ntech-courses, but you can also take part in workshops which develop your soft or leadership skills. In my opinion, the most important thing is talking to other\ntesters in our company. We have got a slack channel, a hot field of debates, sharing experiences and solving problems. There is also a monthly testers’ meeting.\nDuring these events we can present our tools, and share our feelings about them. After a short lecture we discuss a lot and it is really inspiring. Last but not\nleast are our conferences and hackathons. Allegro organizes amazing, huge meetings (in the past year, they were, of course, organised online). Subjects are very\ndiversified and broaden horizons.\u003c/p\u003e\n\n\u003cp\u003eAnother amazing issue is the attitude. The whole team is proud of their work and tries to cooperate agreeably in order to be effective and efficient. Even as an\nIntern you do not feel as a second-class employee, you are treated as seriously as your coworker with ten years of experience. I never met a person who was rude\nto me, or was angry with my lack of knowledge. Everybody knows that there are newbies in the company, and they are forgiving. When you achieve a goal your\ncolleagues are happy for you.\u003c/p\u003e\n\n\u003ch2 id=\"any-downsides\"\u003eAny downsides?\u003c/h2\u003e\n\n\u003cp\u003eI was thinking long and hard about downsides or disadvantages of working at Allegro. Beside problems with test environments I mentioned above, I have one little\nissue. Because the company is so big, there are so many teams and services it is sometimes difficult to find the source of needed information. From time to time\nit takes much longer than you assumed. It might be a little bit frustrating. It also causes that many teams develop similar/alternative tools at the same time.\nSix months later, we realize that it could have been achieved faster and with less effort.Therefore, communication seems to be the most important thing, and\nsometimes it can be a bit neglected.\u003c/p\u003e\n\n\u003cp\u003eThere is another minor difficulty. There are small pieces of code, small features that do not have an owner. When you find a bug there or would like to make\nsome changes on it, it is not obvious to whom you should communicate your actions.\u003c/p\u003e\n\n\u003ch2 id=\"lets-wrap-up\"\u003eLet’s wrap up!\u003c/h2\u003e\n\n\u003cp\u003eI like working with my teammates. I believe that I have developed a lot since I started work here. I am really happy to be part of this company, because Allegro\nis a great opportunity for everyone who wants to learn. It is good to be here! / Dobrze tu być!\u003c/p\u003e\n","contentSnippet":"Maybe it’s another “How I’ve changed my worklife” story, but I hope it is an interesting one. It seems quite important to tell: before the beginning of my\nAllegro adventure, I was working as… an archaeologist. It was both physical work on excavations and research work at my PhD studies. And the only thing that\nconnects my past work and the current one is: attention to detail.\nI had been thinking about changing my career path for some time. I’ve got some IT-experienced friends and they convinced me to try my luck in that field. In the\nbeginning I learned some front-end technologies on my own. Later I systematized and developed my knowledge at a programming bootcamp. And started looking for a\njob. I sent my application to Allegro for a front-end developer offer. Unfortunately, my lack of experience (and probably knowledge, too) caused me not to get a\njob offer. However, someone from the HR squad encouraged me to not give up and try one more time with the Summer eXperience internship program.\nIt begins!\nI did it! I was invited to begin cooperation (as Test Engineer Intern) with Allegro’s teams responsible for developing listings (search result pages). First of\nJuly was the day when I and my 52 intern-colleagues started work. After a two-day long onboarding (a very intensive time filled with tons of useful pieces of\ninformation!), I met my teammates for the first time. During summertime anti-covid restrictions were not so strict and I was able to visit the office a few\ntimes. We discussed my responsibilities and they guided me through the listings domain.\nIn the beginning of my internship I had to test manually our web and mobile-web solutions. For a person who never had anything to do with a complex\nmicroservices system it was quite a challenging experience. I needed to understand and learn how services work and communicate with each other. The next step\nwas to become familiar with test environments. Phoenix (development test environments) and Sandbox are very useful, but at the same time they are very fussy.\nYou have to be quite patient to work with those tools. And when you are a QA Engineer you work with them all the time! But it turned out to be just a warm up. I\nquickly learned how to test our mobile applications (both for Android and iOS) and write and maintain automatic tests in the Cypress framework.\nI was introduced to chaos and efficiency testing. I also wrote my first automatic tests in Espresso\nand TeaBiscuit (our internal tool). Every day brought something exciting and new, and still does.\nWhat do I like?\nMy favourite side of Allegro is knowledge sharing. Regarding common problems with technology or domain knowledge, I can always ask my supportive teammates, but\nthere is much more. We can take part in many interesting courses and workshops organised by people truly dedicated to their subjects. Among those are not only\ntech-courses, but you can also take part in workshops which develop your soft or leadership skills. In my opinion, the most important thing is talking to other\ntesters in our company. We have got a slack channel, a hot field of debates, sharing experiences and solving problems. There is also a monthly testers’ meeting.\nDuring these events we can present our tools, and share our feelings about them. After a short lecture we discuss a lot and it is really inspiring. Last but not\nleast are our conferences and hackathons. Allegro organizes amazing, huge meetings (in the past year, they were, of course, organised online). Subjects are very\ndiversified and broaden horizons.\nAnother amazing issue is the attitude. The whole team is proud of their work and tries to cooperate agreeably in order to be effective and efficient. Even as an\nIntern you do not feel as a second-class employee, you are treated as seriously as your coworker with ten years of experience. I never met a person who was rude\nto me, or was angry with my lack of knowledge. Everybody knows that there are newbies in the company, and they are forgiving. When you achieve a goal your\ncolleagues are happy for you.\nAny downsides?\nI was thinking long and hard about downsides or disadvantages of working at Allegro. Beside problems with test environments I mentioned above, I have one little\nissue. Because the company is so big, there are so many teams and services it is sometimes difficult to find the source of needed information. From time to time\nit takes much longer than you assumed. It might be a little bit frustrating. It also causes that many teams develop similar/alternative tools at the same time.\nSix months later, we realize that it could have been achieved faster and with less effort.Therefore, communication seems to be the most important thing, and\nsometimes it can be a bit neglected.\nThere is another minor difficulty. There are small pieces of code, small features that do not have an owner. When you find a bug there or would like to make\nsome changes on it, it is not obvious to whom you should communicate your actions.\nLet’s wrap up!\nI like working with my teammates. I believe that I have developed a lot since I started work here. I am really happy to be part of this company, because Allegro\nis a great opportunity for everyone who wants to learn. It is good to be here! / Dobrze tu być!","guid":"https://blog.allegro.tech/2021/03/digging-into-allegro-how-i-started-testing-career.html","categories":["tech","testing","intern","career change"],"isoDate":"2021-03-22T23:00:00.000Z","thumbnail":"images/post-headers/testing.png"},{"title":"Finite-state machines made easy","link":"https://blog.allegro.tech/2021/03/state-machines-made-easy.html","pubDate":"Fri, 05 Mar 2021 00:00:00 +0100","authors":{"author":[{"name":["Tymon Felski"],"photo":["https://blog.allegro.tech/img/authors/tymon.felski.jpg"],"url":["https://blog.allegro.tech/authors/tymon.felski"]}]},"content":"\u003cp\u003eCoordinating complex processes, both business and technical, can be a challenging issue in a distributed system.\nEspecially when the complications associated with them, such as concurrency, idempotency, scalability and hindered\ntestability, come into play — possibly all at once.\nThis is definitely something that can keep many programmers awake at night.\u003c/p\u003e\n\n\u003cp\u003eWhile this may sound dramatic, in reality there are many different solutions to this problem.\nOne group of such solutions extensively uses finite-state machines also known as finite-state automata.\nAs this article is meant for everyone, let’s start with some background information about what they are and how\nthey work.\u003c/p\u003e\n\n\u003ch2 id=\"what-are-finite-state-machines\"\u003eWhat are finite-state machines\u003c/h2\u003e\n\n\u003cp\u003eFor the sake of readability, I will sometimes be referring to finite-state machines as simply “state machines”.\nIf you’re already familiar with their formal definition, you may skip to the next section.\u003c/p\u003e\n\n\u003cp\u003eFormally speaking, a finite-state machine is a mathematical model of computation that describes an abstract system\nhaving a finite number of permissible states. At any given point in time, the system is in exactly one of these\nstates.\u003c/p\u003e\n\n\u003cp\u003eIn practical terms such a machine is described by:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003ean initial (start) state,\u003c/li\u003e\n  \u003cli\u003ea set of possible states,\u003c/li\u003e\n  \u003cli\u003ea sequence of possible inputs (events),\u003c/li\u003e\n  \u003cli\u003ea transition function which based on the last observed input and the machine’s current state, determines the next\nstate,\u003c/li\u003e\n  \u003cli\u003eand a set of terminal (end) states — optionally.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThe machine starts off in the initial state and inspects all inputs in sequence.\nUpon observing each input, it uses the transition function to change its state.\nThe processing ends once all inputs have been observed.\nIf the machine’s state at the end of processing is one of the terminal states, the machine is assumed to accept the\ngiven input, and to reject it otherwise.\u003c/p\u003e\n\n\u003cp\u003eAs a side note, the description provided above uses the deterministic model of a finite-state automaton.\nThere are also alternative, non-deterministic machines, but I won’t be delving into them too much, as they can be\nconverted to deterministic ones anyway.\u003c/p\u003e\n\n\u003cp\u003eIf you’ve read this far, hopefully the rest of this post will be easier on the mind!\nDespite the intimidating formal definition, finite-state machines are more widespread than you might imagine.\nUpon closer inspection you might be able to spot them in your everyday life under the hood of things such as vending\nmachines, traffic lights and elevators.\nIn .NET they are used in the implementation of \u003ccode class=\"language-plaintext highlighter-rouge\"\u003easync\u003c/code\u003e/\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eawait\u003c/code\u003e or \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eyield\u003c/code\u003e syntax.\nTry decompiling your code and see how the language authors implemented those features.\nYou have probably already used some sort of state machine in your code without even realising it!\u003c/p\u003e\n\n\u003ch2 id=\"a-simple-example-of-a-basic-state-machine-implementation\"\u003eA simple example of a basic state machine implementation\u003c/h2\u003e\n\n\u003cp\u003eLet’s take a closer look at the following piece of code:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eButton\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePlay\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eStop\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003eState\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePlaying\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eNotPlaying\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ePlayer\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eState\u003c/span\u003e \u003cspan class=\"n\"\u003eCurrentState\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotPlaying\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eHandleClick\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eButton\u003c/span\u003e \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebutton\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eButton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlay\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCurrentState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePlaying\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebutton\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eButton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStop\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCurrentState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotPlaying\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThis is an example of a very simple state machine with two states and two events.\nThe player can be either playing or not playing music.\nPressing the Play button will start or keep playing music, while pressing the Stop button will stop the music or keep\nit stopped.\u003c/p\u003e\n\n\u003cp\u003eThe code is manageable at this point, since the example is quite straightforward.\nHowever, I hope you can imagine how adding more media controls that are usually present in music players will quickly\nresult in complex code that will not be easily maintainable anymore.\nFor instance, consider a feature request to have the Previous button change to the previous track if the player is less\nthan 3 seconds into the current track, or stay at the current track but rewind it to the beginning otherwise.\u003c/p\u003e\n\n\u003cp\u003eThat being said, in many cases this kind of state machine implementation would be more than enough.\nYou don’t always have to use a state-of-the-art, bleeding-edge solution to achieve desired goals.\nHowever, this is not something I would recommend to someone who is trying to tackle coordination of asynchronous\noperations within a distributed system.\u003c/p\u003e\n\n\u003ch2 id=\"a-more-maintainable-approach\"\u003eA more maintainable approach\u003c/h2\u003e\n\n\u003cp\u003eLet me share our approach to this problem.\nWe have come up with a framework for building state machines in .NET with very little code that is maintainable and\ntestable.\nState machines built with this framework serve a purpose of orchestrating a wide range of business and technical\nprocesses in our microservice-based distributed architecture.\nThe framework is equipped with various features dictated by paradigms of distributed systems, which extend the\nstandard state machine definition.\u003c/p\u003e\n\n\u003cp\u003eBefore I move on to an example of its real-life application, I want to break down the state machine’s API, so that you\nknow what you’re looking at later on.\nTo keep things short, I will be showing you only snippets of simplified code, as implementation details can be\nexpanded upon in follow-up posts.\u003c/p\u003e\n\n\u003cp\u003eThe state machine is defined as follows:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eStateMachine\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTStateBase\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTEventBase\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eStateMachine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTStateBase\u003c/span\u003e \u003cspan class=\"n\"\u003einitialState\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIt is a generic class that requires a definition of base types for all states (\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eTStateBase\u003c/code\u003e) and for all transition\ntriggers (\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eTEventBase\u003c/code\u003e).\nThe constructor accepts an initial state from which the state machine will start its operation.\u003c/p\u003e\n\n\u003cp\u003eWe can create the state machine like so:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eStateMachine\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eStateBase\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eEventBase\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eInitialState\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eHaving created this object, we may start defining transitions.\nEach transtion consists of three required elements:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003ethe state from which the transition can be triggered,\u003c/li\u003e\n  \u003cli\u003ethe transition trigger (an event),\u003c/li\u003e\n  \u003cli\u003ethe state to which the transition leads.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eOptionally, a transition can have side effects, called simply commands.\nA command (or a set of commands) will be run after a successful transition.\nThose can be pretty much anything from sending a message to another state machine to calling a specific service and\ndelegating a task to it.\nCommands allow a seamless integration of the state machine with external components.\nThere is a drawback, however.\nCommand execution may fail, what requires an idempotent retry policy to be employed.\u003c/p\u003e\n\n\u003cp\u003eTransitions and commands can be conditional, meaning that a logical expression can be guarding and preventing the\nexecution of the whole transition, or just a command in some cases.\u003c/p\u003e\n\n\u003cp\u003eA builder pattern which combines all of the aforementioned requirements is used to compose a transition:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTStateFrom\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"cm\"\u003e/* Expression\u0026lt;Func\u0026lt;TStateFrom, TEvent, bool\u0026gt;\u0026gt; */\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTStateTo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"cm\"\u003e/* Expression\u0026lt;Func\u0026lt;TStateFrom, TEvent, TStateTo\u0026gt;\u0026gt; */\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewhen\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* Expression\u0026lt;Func\u0026lt;TStateFrom, TEvent, TStateTo, bool\u0026gt;\u0026gt; */\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* Expression\u0026lt;Func\u0026lt;TStateFrom, TEvent, TStateTo, TCommand\u0026gt;\u0026gt; */\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"cm\"\u003e/* ... */\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"cm\"\u003e/* ... */\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThis structure may be overwhelming at first, but bear with me.\nIt will all make sense in a bit.\nAs for now you need to know that:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003eif the state machine is in a state of \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eTStateFrom\u003c/code\u003e type,\u003c/li\u003e\n  \u003cli\u003eand an event of type \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eTEvent\u003c/code\u003e occured,\u003c/li\u003e\n  \u003cli\u003eand the condition (if defined) passed to \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eWhen\u003c/code\u003e method is satisfied,\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003ethe transition will fire up and the state machine will switch to a new state of type \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eTStateTo\u003c/code\u003e using the factory method\nexpression passed to \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eToState\u003c/code\u003e method.\u003c/p\u003e\n\n\u003cp\u003eThe state machine class exposes a method which can be used to trigger a transition with an event:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eTransitionResult\u003c/span\u003e \u003cspan class=\"nf\"\u003eApply\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTEventBase\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThis method applies the supplied event to the current state by trying to find a matching transition in the transition\nmapping and changes the internal state of the machine.\nThe result contains information about the performed transition, along with commands that should be run.\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTransitionResult\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eTStateBase\u003c/span\u003e \u003cspan class=\"n\"\u003eStateFrom\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eTEventBase\u003c/span\u003e \u003cspan class=\"n\"\u003eEvent\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eTStateBase\u003c/span\u003e \u003cspan class=\"n\"\u003eStateTo\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eCommands\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eIsValid\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIf no matching transition definition is found given the machine’s current state – or if a transition is found, but its\nprecondition is not met – the event application will result in an invalid transition.\nIn that case, the state machine will not react to the event and simply retain its state, possibly logging that an\ninvalid event was received.\u003c/p\u003e\n\n\u003cp\u003eIf there are multiple matching transitions, the first one will fire up (in definition order).\nWe should, however, avoid designing states machines in such way if possible.\u003c/p\u003e\n\n\u003cp\u003eAs you can see, the representation of the machine is primarily type-based, so we can use polymorphism to our advantage.\nBy calling \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eFromState\u0026lt;TStateBase\u0026gt;()\u003c/code\u003e we can have a transition that can be fired up from any state.\nSimilarily, if we use a type that only some selected states derive from, we will have a transition applicable to these\nstates only.\nIt would be equivalent to duplicating that same transition for every one of these states.\nThis syntax can be particularly useful, when dealing with processes that have an expiration date and have to be\ncompleted within a specific time frame.\nReceiving an event about the process’ expiration may have to be handled regardless of the machine’s current state and\nresult in termination immediately.\u003c/p\u003e\n\n\u003ch2 id=\"implementation-manifest\"\u003eImplementation manifest\u003c/h2\u003e\n\n\u003cp\u003eNow that I’ve described how a state machine can be defined in a declarative way using our framework, let’s talk a bit\nabout how that definition actually runs.\u003c/p\u003e\n\n\u003cp\u003eIn general, we use dependency injection to make the state machine definition work with other services and add-ons,\nsuch as specific command runners.\nI promised I would not dive deep into implementation details, but nonetheless I want to give you a little taste of\nwhat sits behind the scenes.\u003c/p\u003e\n\n\u003cp\u003eIf you don’t care for any of that, you may skip to the “Real-life example” section.\u003c/p\u003e\n\n\u003ch3 id=\"storage\"\u003eStorage\u003c/h3\u003e\n\n\u003cp\u003eThe state machine implementation is based on event sourcing.\nIn summary, this means that we don’t save the state of our application objects, but rather a series of events that\nchange the object’s state.\nThese events will give us the current view of the object when aggregated (“replayed”) in the order in which they\noccured.\nFor this purpose we currently use an open-source library,\n\u003ca href=\"https://github.com/SQLStreamStore/SQLStreamStore\"\u003eSQLStreamStore\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eSQLStreamStore offers an atomic and idempotent stream append operation.\nThanks to this, we don’t have to worry about race conditions between multiple instances of the same state machine\nhandling events in parallel, what is great for scalability.\nWe can also recognize a situation when the same event is being fed into the state machine again, what can happen\nwhen dealing with retry policies.\nThat, on the other hand, gives us a pretty good way of achieving deduplication.\u003c/p\u003e\n\n\u003ch3 id=\"caching\"\u003eCaching\u003c/h3\u003e\n\n\u003cp\u003eReplaying all events every single time is an unnecessary overhead that we decided to mitigate by introducing\na lock-free cache for state snapshots.\nAfter each transition a state machine will cache its current state along with the stream version which it\ncorresponds to.\nThis gives us the ability to restore the state machine to the state it was in after handling \u003ccode class=\"language-plaintext highlighter-rouge\"\u003en-1\u003c/code\u003e events, when we want\nto handle the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003en\u003c/code\u003e-th event.\u003c/p\u003e\n\n\u003cp\u003eIt requires, however, the states to be immutable, or else we may end up with an unexpected behaviour.\nIf states were not immutable, we could not be certain that the state object we cached after handling the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003en\u003c/code\u003e-th event\nis still the same and has not been modified in the meantime.\nMoreover, immutable objects are inherently thread-safe.\u003c/p\u003e\n\n\u003ch3 id=\"instrumentation\"\u003eInstrumentation\u003c/h3\u003e\n\n\u003cp\u003eThis state machine framework is also equipped with heavy instrumentation.\nEvery executed transition and state change is logged, so we can easily track any errors.\nThis data is also useful for our data analytics team to keep track of business processes.\nA lot of different metrics come into play to measure performance of each and every state machine deployed.\u003c/p\u003e\n\n\u003cp\u003eFinally, every historical transition is saved in a stream — separate from the event stream — and can be viewed with our\ninternal back-office tools.\u003c/p\u003e\n\n\u003cp\u003eThanks to the finite nature of the state machines, we can always log the current state and trace what made the system\nto be in that state, along with all its previous states.\nThis is something quite invaluable and helps immensely when diagnosing issues, especially in complex and\ninter-dependent business scenarios where a lot of things happen at the same time.\u003c/p\u003e\n\n\u003ch2 id=\"real-life-example\"\u003eReal-life example\u003c/h2\u003e\n\n\u003cp\u003eSo finally, the big question: how is this framework used on our platform?\nTo answer that we don’t need to reach far.\u003c/p\u003e\n\n\u003cp\u003eIn July of 2020 we launched a new payment method called Allegro Pay, which will eventually be available to every buyer\non Allegro.\nThis service allows the users to buy items now and pay for them later in a single payment after 30 days, or\nin multiple smaller monthly payments, depending on the value of purchased goods.\u003c/p\u003e\n\n\u003cp\u003eRepayments can be easily made online using our Allegro Pay dashboard.\nUsers are even able to pay for multiple purchases at once.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-03-05-state-machines-made-easy/allegro-pay-dashboard.png\" alt=\"Allegro Pay dashboard\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eFor more detailed information, I encourage you to read our\n\u003ca href=\"https://allegro.pl/pomoc/dla-kupujacych/allegro-pay/\"\u003eAllegro Pay FAQ\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eI suspect you already know where I’m going with this — my goal is to show you how our state machine framework is used\nto coordinate an actual business process of handling a repayment within Allegro Pay.\u003c/p\u003e\n\n\u003ch3 id=\"the-process-specification\"\u003eThe process specification\u003c/h3\u003e\n\n\u003cp\u003eBefore we create our state machine, we need to have a rough idea of which states and events we want to handle.\u003c/p\u003e\n\n\u003cp\u003eThe repayment process is started in two different ways, but will end alike in both cases.\u003c/p\u003e\n\n\u003col\u003e\n  \u003cli\u003e\n    \u003cp\u003eThe user can initialize an immediate online repayment via the Allegro Pay dashboard.\n They are redirected to the payment provider’s website and complete the process there.\u003c/p\u003e\n  \u003c/li\u003e\n  \u003cli\u003e\n    \u003cp\u003eAlternatively, the user can request to repay their purchase with a traditional wire transfer, what we call an\noffline repayment.\n We know nothing about it until the money actually arrives at the target bank account.\n That method may take up to a couple of days.\u003c/p\u003e\n  \u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eAt this point both repayment paths merge, since from now on we can discard any knowledge about how the money\nwas received and focus on the fact that we have it.\nThe money source won’t be useful during the process coordination anymore.\u003c/p\u003e\n\n\u003cp\u003eThe next step is to register the repayment in our bookkeeping system.\nThe registration part is important for us, because it will tell us whether the purchase was paid in full or if further\nrepayments are required.\nAfter receiving information about successful registration, an email is sent to the user confirming that the\nrepayment was registered.\u003c/p\u003e\n\n\u003cp\u003eAfter repayment is registered, we asynchronously await the feedback from the bookkeeping system on the transaction\nbeing settled and the repayment is to be marked as completed.\u003c/p\u003e\n\n\u003ch3 id=\"designing-the-state-machine\"\u003eDesigning the state machine\u003c/h3\u003e\n\n\u003cp\u003eI could show you the finished state machine and just paste a wall of text here, describing what it does, but where’s\nthe fun in that?\nInstead, I’d like to show you the step-by-step process I would go through when designing this kind of state machine.\u003c/p\u003e\n\n\u003cp\u003eI’ll start off by simply creating a state machine that handles a repayment of a single purchase and then extend it\nto work for all cases.\nFirst we need to define the base types for all states and events:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eStateBase\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eUserId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eStateBase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eStateBase\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eother\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eUserId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eEventBase\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAs you can see, I already equipped the base state with all the properties we will need later to orchestrate this\nprocess:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eUserId\u003c/code\u003e — tells us who is repaying,\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eRepaymentId\u003c/code\u003e — uniquely identifies the repayment process,\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePaymentId\u003c/code\u003e — identifies the payment made by the user for this repayment.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAs for the event base, we don’t need anything special there, so it’s empty.\u003c/p\u003e\n\n\u003cp\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eStateBase\u003c/code\u003e class features a copy constructor, which rewrites all properties from the previous state when creating\na new one.\u003c/p\u003e\n\n\u003cp\u003eNone of the states will have any special properties, so there’s no point in painstakingly showing all individual\nsubclasses representing each state.\nHere are just a few sample classes of the initial state (\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eNotStarted\u003c/code\u003e) and one of the subsequent states:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eNotStarted\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eStateBase\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eNotStarted\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eCreated\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eStateBase\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreated\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eStateBase\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAll of the remaining states are defined similarly to \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eCreated\u003c/code\u003e state.\nThose states are:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePaid\u003c/code\u003e,\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eFailed\u003c/code\u003e,\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eRegistered\u003c/code\u003e,\u003c/li\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eCompleted\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eOnce we have our states, we can focus on events and introduce transitions, one by one.\u003c/p\u003e\n\n\u003cp\u003eWe’ll start by handling an online repayment.\nIt begins with the user creating a repayment entity by selecting a payment in the Allegro Pay dashboard.\nThis generates an event, let’s call it \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eOnlineRepaymentCreated\u003c/code\u003e:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eOnlineRepaymentCreated\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eEventBase\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eUserId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWe want this event to trigger a transition from \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eNotStarted\u003c/code\u003e to \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eCreated\u003c/code\u003e state.\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 1. NotStarted : OnlineRepaymentCreated -\u0026gt; Created\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eNotStarted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOnlineRepaymentCreated\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCreated\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreated\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eUserId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAt this point the user sees the repayment form, where they select a payment method.\nThey are then redirected to the payment provider’s website to finish the repayment.\nIn most cases it will succeed, but in some it fails due to a multitude of reasons, such as insufficient\nfunds on the account or the user providing wrong confirmation code.\u003c/p\u003e\n\n\u003cp\u003eTherefore, we need two events:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eOnlineRepaymentPaid\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eEventBase\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eOnlineRepaymentFailed\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eEventBase\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWe could go about a single event called \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eRepaymentResult\u003c/code\u003e with an enum property indicating a success or a failure, but\nin my opinion the former approach is cleaner and more open to future changes.\nThese events will play a role in tranistions no. 2 and 3:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 2. Created : OnlineRepaymentPaid -\u0026gt; Paid\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCreated\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOnlineRepaymentPaid\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaid\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePaid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRegisterPaymentCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 3. Created : OnlineRepaymentFailed -\u0026gt; Failed\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCreated\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOnlineRepaymentFailed\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFailed\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eFailed\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eYou might notice that transition no. 2 has a command that I didn’t mention earlier specified.\nIt’s a simple class wrapping the payment identifier, which is interpreted by the command runner as a request to our\nbookkeeping system for registering this payment.\u003c/p\u003e\n\n\u003cp\u003eThis concludes the online path and we can move on to the offline repayment.\nIt is significantly easier, since we are simply notified that the money has been transferred to us.\nBecause of this, we can completely skip the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eCreated\u003c/code\u003e state and go straight to \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePaid\u003c/code\u003e.\nWe need an event called \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eOfflineRepaymentPaid\u003c/code\u003e which contains the same properties as \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eOnlineRepaymentCreated\u003c/code\u003e:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eOfflineRepaymentPaid\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eEventBase\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eUserId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eLet’s use it in the fourth transition that will once again call the registration command:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 4. NotStarted : OfflineRepaymentPaid -\u0026gt; Paid\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eNotStarted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOfflineRepaymentPaid\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaid\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePaid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eUserId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRegisterPaymentCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThis is where both repayment types merge and we can focus on our bookkeeping system.\nAs mentioned before, we are mostly interested in registration events published by the bookkeeping system.\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ePaymentRegistered\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eEventBase\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eOnce we know that a payment is registered in our bookkeeping system, we are able to send an email to the user\nsummarizing what they paid for and follow-up information whether they still have more payments to be made.\nThis can be done with a transition like this:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 5. Paid : PaymentRegistered -\u0026gt; Registered\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaid\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentRegistered\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRegistered\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRegistered\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendRepaymentRegisteredEmailCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAgain, \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eSendRepaymentRegisteredEmailCommand\u003c/code\u003e is a simple class wrapping two properties that will be interpreted by the\ncommand runner and result in an email sent to the user.\u003c/p\u003e\n\n\u003cp\u003eThe last step is to wait for the final event \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePaymentCompleted\u003c/code\u003e.\nTheoretically it could be omitted in this state machine, but it’s useful for auditing purposes.\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ePaymentCompleted\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eEventBase\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIt’s time to create the final transition:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 6. Registered : PaymentCompleted -\u0026gt; Completed\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRegistered\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAnd we’re done!\nRight?\nNot really.\u003c/p\u003e\n\n\u003cp\u003eAs is usually the case with event-sourced systems, the order of incoming events can’t always be relied on.\nThe bookkeeping system will sometimes — for reasons I don’t want to delve into — publish events \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePaymentRegistered\u003c/code\u003e and\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePaymentCompleted\u003c/code\u003e at the same time.\nDue to a lack of message ordering guarantees, it’s possible for us to receive \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePaymentCompleted\u003c/code\u003e event before\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePaymentRegistered\u003c/code\u003e.\nThe current definition of the state machine is not prepared for that.\u003c/p\u003e\n\n\u003cp\u003eFortunately, the fix is quite easy, as we can simply introduce two more transitions:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 7. Paid : PaymentCompleted -\u0026gt; Completed\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaid\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 8. Completed : PaymentRegistered -\u0026gt; Completed\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentRegistered\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendRepaymentRegisteredEmailCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eIn this scenario we completely skip \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eRegistered\u003c/code\u003e state, but that’s something we just have to deal with.\nEvents are important from analytics and diagnostics standpoints, states — not so much.\u003c/p\u003e\n\n\u003cp\u003eThat wraps up the event flow for this scenario.\nIt can be visualized with a diagram like this:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-03-05-state-machines-made-easy/repayment-state-machine-v1.png\" alt=\"Repayment state machine diagram (V1)\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eOur state machine framework is equipped with a pretty useful visualisation extension.\nIt’s a pretty neat tool that makes it easy to figure out how the state machine works, without having to delve into the\ncode.\nA simple unit test that calls this extension can render a state machine diagram like one above using PlantUML\nsyntax, which in this case would go as follows:\u003c/p\u003e\n\n\u003cdiv class=\"language-plaintext highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e@startuml\nhide empty description\n[*] --\u0026gt; NotStarted\nNotStarted --\u0026gt; Created: \u0026lt;b\u0026gt;OnlineRepaymentCreated\u0026lt;/b\u0026gt;\nCreated --\u0026gt; Paid: \u0026lt;b\u0026gt;OnlineRepaymentPaid\u0026lt;/b\u0026gt;\\n\u0026lt;i\u0026gt;then:\u0026lt;/i\u0026gt; RegisterPaymentCommand\nCreated --\u0026gt; Failed: \u0026lt;b\u0026gt;OnlineRepaymentFailed\u0026lt;/b\u0026gt;\nNotStarted --\u0026gt; Paid: \u0026lt;b\u0026gt;OfflineRepaymentPaid\u0026lt;/b\u0026gt;\\n\u0026lt;i\u0026gt;then:\u0026lt;/i\u0026gt; RegisterPaymentCommand\nPaid --\u0026gt; Registered: \u0026lt;b\u0026gt;PaymentRegistered\u0026lt;/b\u0026gt;\\n\u0026lt;i\u0026gt;then:\u0026lt;/i\u0026gt; SendRepaymentRegisteredEmailCommand\nRegistered --\u0026gt; Completed: \u0026lt;b\u0026gt;PaymentCompleted\u0026lt;/b\u0026gt;\nPaid --\u0026gt; Completed: \u0026lt;b\u0026gt;PaymentCompleted\u0026lt;/b\u0026gt;\nCompleted --\u0026gt; Completed: \u0026lt;b\u0026gt;PaymentRegistered\u0026lt;/b\u0026gt;\\n\u0026lt;i\u0026gt;then:\u0026lt;/i\u0026gt; SendRepaymentRegisteredEmailCommand\n@enduml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eHowever, recall that this is just a state machine to handle a repayment for a single payment selected by the user.\nI promised we would extend it to handle multiple payments.\nLet’s do that.\nFirst we’ll extend the base state definition:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eabstract\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eStateBase\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eUserId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eHashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ePaymentIds\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eHashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eRegisteredPaymentIds\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eHashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eCompletedPaymentIds\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eStateBase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eStateBase\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eother\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eUserId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePaymentIds\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eRegisteredPaymentIds\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRegisteredPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCompletedPaymentIds\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompletedPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThree things have changed:\u003c/p\u003e\n\n\u003cul\u003e\n  \u003cli\u003e\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePaymentId\u003c/code\u003e changed from a \u003ccode class=\"language-plaintext highlighter-rouge\"\u003estring\u003c/code\u003e to a \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eHashSet\u0026lt;string\u0026gt;\u003c/code\u003e and is now called \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePaymentIds\u003c/code\u003e to represent multiple\npayments selected by the user,\u003c/li\u003e\n  \u003cli\u003ea \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eHashSet\u0026lt;string\u0026gt;\u003c/code\u003e called \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eRegisteredPaymentIds\u003c/code\u003e was added to keep track of registered payments,\u003c/li\u003e\n  \u003cli\u003ea \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eHashSet\u0026lt;string\u0026gt;\u003c/code\u003e called \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eCompletedPaymentIds\u003c/code\u003e was added to keep track of completed payments.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWe also have to modify \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eOnlineRepaymentCreated\u003c/code\u003e event by introducing a collection of payment identifiers, like so:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eOnlineRepaymentCreated\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eEventBase\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eUserId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eIEnumerable\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ePaymentIds\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eBecause of this, we need to introduce a small change to transition no. 1:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 1'. NotStarted : OnlineRepaymentCreated -\u0026gt; Created\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eNotStarted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eOnlineRepaymentCreated\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCreated\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCreated\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eUserId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePaymentIds\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eHashSet\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eTransition no. 2 is similarly adjusted to these changes by passing the set of payment identifiers to the\nbookkeeping system:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRegisterPaymentsCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eNow we can move to the remaining transitions.\nTransition no. 5 has to be split into two.\nWe want to stay in the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePaid\u003c/code\u003e state until all registration events are received and only then switch to \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eRegistered\u003c/code\u003e.\nThis can be achieved with:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 5'. Paid : PaymentRegistered -\u0026gt; Paid\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaid\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentRegistered\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAll\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRegisteredPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaid\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003ePaid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRegisteredPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 5''. Paid : PaymentRegistered -\u0026gt; Registered\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaid\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentRegistered\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAll\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRegisteredPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRegistered\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRegistered\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRegisteredPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendRepaymentRegisteredEmailCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAs you can see, the command is now defined only for the second transition that triggers after all payments are\nregistered.\nWe have to slightly adjust transition no. 8, which is responsible for sending the email, too:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 8'. Completed : PaymentRegistered -\u0026gt; Completed\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentRegistered\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRegisteredPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewhen\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSetEquals\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRegisteredPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendRepaymentRegisteredEmailCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUserId\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRepaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThis time the transition is not conditional, however the command is.\nIt will execute only after we handle final registration event and the payment identifier sets \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePaymentIds\u003c/code\u003e and\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003eRegisteredPaymentIds\u003c/code\u003e become equal.\u003c/p\u003e\n\n\u003cp\u003eWe cannot forget about all transitions that are triggered by \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePaymentCompleted\u003c/code\u003e event.\nThose will have to be changed like so:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 6'. Registered : PaymentCompleted -\u0026gt; Registered\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRegistered\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAll\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompletedPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRegistered\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eRegistered\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompletedPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 6''. Registered : PaymentCompleted -\u0026gt; Completed\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRegistered\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAll\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompletedPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompletedPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 7'. Paid : PaymentCompleted -\u0026gt; Paid\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaid\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAll\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompletedPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompletedPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 7''. Paid : PaymentCompleted -\u0026gt; Completed\u003c/span\u003e\n\u003cspan class=\"n\"\u003estateMachine\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFromState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaid\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAll\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompletedPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCompletedPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAnd we’re done!\nThis time for real.\nAfter all this work we ended up with something that can be visualized with a diagram like this:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-03-05-state-machines-made-easy/repayment-state-machine-v2.png\" alt=\"Repayment state machine diagram (V2)\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eI mentioned earlier that we have internal back-office tools to view state machines and their transition history.\nHere is an example view of a repayment process that was coordinated with the state machine we defined above (sensitive\ndata was redacted, since this was taken in production):\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/img/articles/2021-03-05-state-machines-made-easy/back-office-state-machine-view.png\" alt=\"Back-office state machine view\" /\u003e\u003c/p\u003e\n\n\u003ch3 id=\"caveats\"\u003eCaveats\u003c/h3\u003e\n\n\u003cp\u003eYou may have noticed some problems here.\nWhat would happen if we received an event with a wrong payment identifier?\nRight now the state machine is not ready for that.\nHowever, that can be remedied relatively easily by adding another condition to \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eWhen\u003c/code\u003e methods of all transitions for\n\u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePaymentRegistered\u003c/code\u003e and \u003ccode class=\"language-plaintext highlighter-rouge\"\u003ePaymentCompleted\u003c/code\u003e events, such as:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* ... */\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThis would essentialy ensure that we react only to events with correct identifiers.\u003c/p\u003e\n\n\u003cp\u003eAnd what about retries and duplicated events?\nTransition no. 8’ is especially susceptible to that, because it may result in the email being sent to the user twice.\nAnd we don’t want that!\nFortunately, achieving deduplication is just as easy — we have to ignore events for payments that are already\nregistered:\u003c/p\u003e\n\n\u003cdiv class=\"language-csharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRegisteredPaymentIds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eContains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e@event\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePaymentId\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* ... */\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eFor the sake of readability I also decided to skip a lot of other validations, which would otherwise have to be there,\nsuch as simple null checks.\u003c/p\u003e\n\n\u003ch3 id=\"how-to-test\"\u003eHow to test\u003c/h3\u003e\n\n\u003cp\u003eTesting state machines is important, because, well, ideally all code should be tested.\nIn this case, apart from the usual assurance that we are able to handle both happy paths and edge cases, we can also\nensure that we keep the transitions backwards compatible.\nAn event that is once inserted into the stream will stay there forever.\u003c/p\u003e\n\n\u003cp\u003eWe developed a simple DSL in F# to help us test state machines created with our framework.\nThis is a perfect solution to test a declarative definition of a state machine like the one we developed in this post.\nHere’s an example of a happy path test for our state machine:\u003c/p\u003e\n\n\u003cdiv class=\"language-fsharp highlighter-rouge\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eFact\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;]\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"n\"\u003e``Online repayment - single payment happy path``\u003c/span\u003e \u003cspan class=\"bp\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"nc\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nn\"\u003eEvents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eOnlineRepaymentCreated\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"paymentId1\"\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e|\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eGoToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eCreated\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e|\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoNothing\u003c/span\u003e\n        \u003cspan class=\"nc\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nn\"\u003eEvents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eOnlineRepaymentPaid\u003c/span\u003e \u003cspan class=\"bp\"\u003e()\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e|\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eGoToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003ePaid\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e|\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eDo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eRegisterPaymentsCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nc\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nn\"\u003eEvents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003ePaymentRegistered\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"paymentId1\"\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e|\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eGoToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eRegistered\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e|\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eDo\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eSendRepaymentRegisteredEmailCommand\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nc\"\u003eWhen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nn\"\u003eEvents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003ePaymentCompleted\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"paymentId1\"\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e|\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eGoToState\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eCompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e|\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoNothing\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e|\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eapply\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eA test like this is essentially a list of events with expected side effects that are then aggregated using the \u003ccode class=\"language-plaintext highlighter-rouge\"\u003eapply\u003c/code\u003e\nfunction that feeds them one by one into the state machine and verifies the outcome.\u003c/p\u003e\n\n\u003ch2 id=\"summary\"\u003eSummary\u003c/h2\u003e\n\n\u003cp\u003eI hope I was able to convince you how a framework like this can make designing complex state machines easy.\nIt provides numerous advantages, such as declarative syntax, effortless testability, thorough instrumentation and\nvisualization.\u003c/p\u003e\n\n\u003cp\u003eThis is precisely why state machines became an integral part of pretty much every business process architecture\nin our project.\nHaving such a robust and scalable solution for asynchronous process orchestration and isolation is crucial in\ndistributed systems.\nThe presented code, albeit extremely simplified, is from an actual state machine — one of many used in our\napplications.\u003c/p\u003e\n\n\u003cp\u003eWhile the presented solution is a strictly internal framework right now, who knows what the future might bring?\nStay tuned!\u003c/p\u003e\n","contentSnippet":"Coordinating complex processes, both business and technical, can be a challenging issue in a distributed system.\nEspecially when the complications associated with them, such as concurrency, idempotency, scalability and hindered\ntestability, come into play — possibly all at once.\nThis is definitely something that can keep many programmers awake at night.\nWhile this may sound dramatic, in reality there are many different solutions to this problem.\nOne group of such solutions extensively uses finite-state machines also known as finite-state automata.\nAs this article is meant for everyone, let’s start with some background information about what they are and how\nthey work.\nWhat are finite-state machines\nFor the sake of readability, I will sometimes be referring to finite-state machines as simply “state machines”.\nIf you’re already familiar with their formal definition, you may skip to the next section.\nFormally speaking, a finite-state machine is a mathematical model of computation that describes an abstract system\nhaving a finite number of permissible states. At any given point in time, the system is in exactly one of these\nstates.\nIn practical terms such a machine is described by:\nan initial (start) state,\na set of possible states,\na sequence of possible inputs (events),\na transition function which based on the last observed input and the machine’s current state, determines the next\nstate,\nand a set of terminal (end) states — optionally.\nThe machine starts off in the initial state and inspects all inputs in sequence.\nUpon observing each input, it uses the transition function to change its state.\nThe processing ends once all inputs have been observed.\nIf the machine’s state at the end of processing is one of the terminal states, the machine is assumed to accept the\ngiven input, and to reject it otherwise.\nAs a side note, the description provided above uses the deterministic model of a finite-state automaton.\nThere are also alternative, non-deterministic machines, but I won’t be delving into them too much, as they can be\nconverted to deterministic ones anyway.\nIf you’ve read this far, hopefully the rest of this post will be easier on the mind!\nDespite the intimidating formal definition, finite-state machines are more widespread than you might imagine.\nUpon closer inspection you might be able to spot them in your everyday life under the hood of things such as vending\nmachines, traffic lights and elevators.\nIn .NET they are used in the implementation of async/await or yield syntax.\nTry decompiling your code and see how the language authors implemented those features.\nYou have probably already used some sort of state machine in your code without even realising it!\nA simple example of a basic state machine implementation\nLet’s take a closer look at the following piece of code:\n\npublic enum Button\n{\n    Play,\n    Stop\n}\n\npublic enum State\n{\n    Playing,\n    NotPlaying\n}\n\npublic class Player\n{\n    public State CurrentState { get; private set; } = State.NotPlaying;\n\n    public void HandleClick(Button button)\n    {\n        if (button == Button.Play)\n        {\n            CurrentState = State.Playing;\n        }\n        else if (button == Button.Stop)\n        {\n            CurrentState = State.NotPlaying;\n        }\n    }\n}\n\n\nThis is an example of a very simple state machine with two states and two events.\nThe player can be either playing or not playing music.\nPressing the Play button will start or keep playing music, while pressing the Stop button will stop the music or keep\nit stopped.\nThe code is manageable at this point, since the example is quite straightforward.\nHowever, I hope you can imagine how adding more media controls that are usually present in music players will quickly\nresult in complex code that will not be easily maintainable anymore.\nFor instance, consider a feature request to have the Previous button change to the previous track if the player is less\nthan 3 seconds into the current track, or stay at the current track but rewind it to the beginning otherwise.\nThat being said, in many cases this kind of state machine implementation would be more than enough.\nYou don’t always have to use a state-of-the-art, bleeding-edge solution to achieve desired goals.\nHowever, this is not something I would recommend to someone who is trying to tackle coordination of asynchronous\noperations within a distributed system.\nA more maintainable approach\nLet me share our approach to this problem.\nWe have come up with a framework for building state machines in .NET with very little code that is maintainable and\ntestable.\nState machines built with this framework serve a purpose of orchestrating a wide range of business and technical\nprocesses in our microservice-based distributed architecture.\nThe framework is equipped with various features dictated by paradigms of distributed systems, which extend the\nstandard state machine definition.\nBefore I move on to an example of its real-life application, I want to break down the state machine’s API, so that you\nknow what you’re looking at later on.\nTo keep things short, I will be showing you only snippets of simplified code, as implementation details can be\nexpanded upon in follow-up posts.\nThe state machine is defined as follows:\n\npublic class StateMachine\u003cTStateBase, TEventBase\u003e\n{\n    public StateMachine(TStateBase initialState)\n    {\n        // ...\n    }\n}\n\n\nIt is a generic class that requires a definition of base types for all states (TStateBase) and for all transition\ntriggers (TEventBase).\nThe constructor accepts an initial state from which the state machine will start its operation.\nWe can create the state machine like so:\n\nvar stateMachine = new StateMachine\u003cStateBase, EventBase\u003e(new InitialState());\n\n\nHaving created this object, we may start defining transitions.\nEach transtion consists of three required elements:\nthe state from which the transition can be triggered,\nthe transition trigger (an event),\nthe state to which the transition leads.\nOptionally, a transition can have side effects, called simply commands.\nA command (or a set of commands) will be run after a successful transition.\nThose can be pretty much anything from sending a message to another state machine to calling a specific service and\ndelegating a task to it.\nCommands allow a seamless integration of the state machine with external components.\nThere is a drawback, however.\nCommand execution may fail, what requires an idempotent retry policy to be employed.\nTransitions and commands can be conditional, meaning that a logical expression can be guarding and preventing the\nexecution of the whole transition, or just a command in some cases.\nA builder pattern which combines all of the aforementioned requirements is used to compose a transition:\n\nstateMachine\n    .FromState\u003cTStateFrom\u003e()\n    .When\u003cTEvent\u003e(/* Expression\u003cFunc\u003cTStateFrom, TEvent, bool\u003e\u003e */)\n    .ToState\u003cTStateTo\u003e(/* Expression\u003cFunc\u003cTStateFrom, TEvent, TStateTo\u003e\u003e */)\n    .RunCommand(\n        when: /* Expression\u003cFunc\u003cTStateFrom, TEvent, TStateTo, bool\u003e\u003e */,\n        then: /* Expression\u003cFunc\u003cTStateFrom, TEvent, TStateTo, TCommand\u003e\u003e */)\n    .RunCommand(/* ... */)\n    // ...\n    .RunCommand(/* ... */);\n\n\nThis structure may be overwhelming at first, but bear with me.\nIt will all make sense in a bit.\nAs for now you need to know that:\nif the state machine is in a state of TStateFrom type,\nand an event of type TEvent occured,\nand the condition (if defined) passed to When method is satisfied,\nthe transition will fire up and the state machine will switch to a new state of type TStateTo using the factory method\nexpression passed to ToState method.\nThe state machine class exposes a method which can be used to trigger a transition with an event:\n\npublic TransitionResult Apply(TEventBase @event);\n\n\nThis method applies the supplied event to the current state by trying to find a matching transition in the transition\nmapping and changes the internal state of the machine.\nThe result contains information about the performed transition, along with commands that should be run.\n\npublic class TransitionResult\n{\n    public TStateBase StateFrom { get; }\n    public TEventBase Event { get; }\n    public TStateBase StateTo { get; }\n    public IEnumerable\u003cobject\u003e Commands { get; }\n    public bool IsValid { get; }\n}\n\n\nIf no matching transition definition is found given the machine’s current state – or if a transition is found, but its\nprecondition is not met – the event application will result in an invalid transition.\nIn that case, the state machine will not react to the event and simply retain its state, possibly logging that an\ninvalid event was received.\nIf there are multiple matching transitions, the first one will fire up (in definition order).\nWe should, however, avoid designing states machines in such way if possible.\nAs you can see, the representation of the machine is primarily type-based, so we can use polymorphism to our advantage.\nBy calling FromState\u003cTStateBase\u003e() we can have a transition that can be fired up from any state.\nSimilarily, if we use a type that only some selected states derive from, we will have a transition applicable to these\nstates only.\nIt would be equivalent to duplicating that same transition for every one of these states.\nThis syntax can be particularly useful, when dealing with processes that have an expiration date and have to be\ncompleted within a specific time frame.\nReceiving an event about the process’ expiration may have to be handled regardless of the machine’s current state and\nresult in termination immediately.\nImplementation manifest\nNow that I’ve described how a state machine can be defined in a declarative way using our framework, let’s talk a bit\nabout how that definition actually runs.\nIn general, we use dependency injection to make the state machine definition work with other services and add-ons,\nsuch as specific command runners.\nI promised I would not dive deep into implementation details, but nonetheless I want to give you a little taste of\nwhat sits behind the scenes.\nIf you don’t care for any of that, you may skip to the “Real-life example” section.\nStorage\nThe state machine implementation is based on event sourcing.\nIn summary, this means that we don’t save the state of our application objects, but rather a series of events that\nchange the object’s state.\nThese events will give us the current view of the object when aggregated (“replayed”) in the order in which they\noccured.\nFor this purpose we currently use an open-source library,\nSQLStreamStore.\nSQLStreamStore offers an atomic and idempotent stream append operation.\nThanks to this, we don’t have to worry about race conditions between multiple instances of the same state machine\nhandling events in parallel, what is great for scalability.\nWe can also recognize a situation when the same event is being fed into the state machine again, what can happen\nwhen dealing with retry policies.\nThat, on the other hand, gives us a pretty good way of achieving deduplication.\nCaching\nReplaying all events every single time is an unnecessary overhead that we decided to mitigate by introducing\na lock-free cache for state snapshots.\nAfter each transition a state machine will cache its current state along with the stream version which it\ncorresponds to.\nThis gives us the ability to restore the state machine to the state it was in after handling n-1 events, when we want\nto handle the n-th event.\nIt requires, however, the states to be immutable, or else we may end up with an unexpected behaviour.\nIf states were not immutable, we could not be certain that the state object we cached after handling the n-th event\nis still the same and has not been modified in the meantime.\nMoreover, immutable objects are inherently thread-safe.\nInstrumentation\nThis state machine framework is also equipped with heavy instrumentation.\nEvery executed transition and state change is logged, so we can easily track any errors.\nThis data is also useful for our data analytics team to keep track of business processes.\nA lot of different metrics come into play to measure performance of each and every state machine deployed.\nFinally, every historical transition is saved in a stream — separate from the event stream — and can be viewed with our\ninternal back-office tools.\nThanks to the finite nature of the state machines, we can always log the current state and trace what made the system\nto be in that state, along with all its previous states.\nThis is something quite invaluable and helps immensely when diagnosing issues, especially in complex and\ninter-dependent business scenarios where a lot of things happen at the same time.\nReal-life example\nSo finally, the big question: how is this framework used on our platform?\nTo answer that we don’t need to reach far.\nIn July of 2020 we launched a new payment method called Allegro Pay, which will eventually be available to every buyer\non Allegro.\nThis service allows the users to buy items now and pay for them later in a single payment after 30 days, or\nin multiple smaller monthly payments, depending on the value of purchased goods.\nRepayments can be easily made online using our Allegro Pay dashboard.\nUsers are even able to pay for multiple purchases at once.\n\nFor more detailed information, I encourage you to read our\nAllegro Pay FAQ.\nI suspect you already know where I’m going with this — my goal is to show you how our state machine framework is used\nto coordinate an actual business process of handling a repayment within Allegro Pay.\nThe process specification\nBefore we create our state machine, we need to have a rough idea of which states and events we want to handle.\nThe repayment process is started in two different ways, but will end alike in both cases.\nThe user can initialize an immediate online repayment via the Allegro Pay dashboard.\n They are redirected to the payment provider’s website and complete the process there.\nAlternatively, the user can request to repay their purchase with a traditional wire transfer, what we call an\noffline repayment.\n We know nothing about it until the money actually arrives at the target bank account.\n That method may take up to a couple of days.\nAt this point both repayment paths merge, since from now on we can discard any knowledge about how the money\nwas received and focus on the fact that we have it.\nThe money source won’t be useful during the process coordination anymore.\nThe next step is to register the repayment in our bookkeeping system.\nThe registration part is important for us, because it will tell us whether the purchase was paid in full or if further\nrepayments are required.\nAfter receiving information about successful registration, an email is sent to the user confirming that the\nrepayment was registered.\nAfter repayment is registered, we asynchronously await the feedback from the bookkeeping system on the transaction\nbeing settled and the repayment is to be marked as completed.\nDesigning the state machine\nI could show you the finished state machine and just paste a wall of text here, describing what it does, but where’s\nthe fun in that?\nInstead, I’d like to show you the step-by-step process I would go through when designing this kind of state machine.\nI’ll start off by simply creating a state machine that handles a repayment of a single purchase and then extend it\nto work for all cases.\nFirst we need to define the base types for all states and events:\n\npublic abstract class StateBase\n{\n    public string UserId { get; init; }\n    public string RepaymentId { get; init; }\n    public string PaymentId { get; init; }\n\n    public StateBase(StateBase other)\n    {\n        if (other == null) return;\n\n        UserId = other.UserId;\n        RepaymentId = other.RepaymentId;\n        PaymentId = other.PaymentId;\n    }\n}\n\npublic abstract class EventBase { }\n\n\nAs you can see, I already equipped the base state with all the properties we will need later to orchestrate this\nprocess:\nUserId — tells us who is repaying,\nRepaymentId — uniquely identifies the repayment process,\nPaymentId — identifies the payment made by the user for this repayment.\nAs for the event base, we don’t need anything special there, so it’s empty.\nStateBase class features a copy constructor, which rewrites all properties from the previous state when creating\na new one.\nNone of the states will have any special properties, so there’s no point in painstakingly showing all individual\nsubclasses representing each state.\nHere are just a few sample classes of the initial state (NotStarted) and one of the subsequent states:\n\npublic class NotStarted : StateBase\n{\n    public NotStarted() : base(null) { }\n}\n\npublic class Created : StateBase\n{\n    public Created(StateBase other) : base(other) { }\n}\n\n\nAll of the remaining states are defined similarly to Created state.\nThose states are:\nPaid,\nFailed,\nRegistered,\nCompleted.\nOnce we have our states, we can focus on events and introduce transitions, one by one.\nWe’ll start by handling an online repayment.\nIt begins with the user creating a repayment entity by selecting a payment in the Allegro Pay dashboard.\nThis generates an event, let’s call it OnlineRepaymentCreated:\n\npublic class OnlineRepaymentCreated : EventBase\n{\n    public string UserId { get; init; }\n    public string RepaymentId { get; init; }\n    public string PaymentId { get; init; }\n}\n\n\nWe want this event to trigger a transition from NotStarted to Created state.\n\n// 1. NotStarted : OnlineRepaymentCreated -\u003e Created\nstateMachine\n    .FromState\u003cNotStarted\u003e()\n    .When\u003cOnlineRepaymentCreated\u003e()\n    .ToState\u003cCreated\u003e((from, @event) =\u003e new Created(from)\n    {\n        UserId = @event.UserId,\n        RepaymentId = @event.RepaymentId,\n        PaymentId = @event.PaymentId\n    });\n\n\nAt this point the user sees the repayment form, where they select a payment method.\nThey are then redirected to the payment provider’s website to finish the repayment.\nIn most cases it will succeed, but in some it fails due to a multitude of reasons, such as insufficient\nfunds on the account or the user providing wrong confirmation code.\nTherefore, we need two events:\n\npublic class OnlineRepaymentPaid : EventBase { }\n\npublic class OnlineRepaymentFailed : EventBase { }\n\n\nWe could go about a single event called RepaymentResult with an enum property indicating a success or a failure, but\nin my opinion the former approach is cleaner and more open to future changes.\nThese events will play a role in tranistions no. 2 and 3:\n\n// 2. Created : OnlineRepaymentPaid -\u003e Paid\nstateMachine\n    .FromState\u003cCreated\u003e()\n    .When\u003cOnlineRepaymentPaid\u003e()\n    .ToState\u003cPaid\u003e((from, @event) =\u003e new Paid(from))\n    .RunCommand((from, @event, to) =\u003e new RegisterPaymentCommand(to.PaymentId));\n\n// 3. Created : OnlineRepaymentFailed -\u003e Failed\nstateMachine\n    .FromState\u003cCreated\u003e()\n    .When\u003cOnlineRepaymentFailed\u003e()\n    .ToState\u003cFailed\u003e((from, @event) =\u003e new Failed(from));\n\n\nYou might notice that transition no. 2 has a command that I didn’t mention earlier specified.\nIt’s a simple class wrapping the payment identifier, which is interpreted by the command runner as a request to our\nbookkeeping system for registering this payment.\nThis concludes the online path and we can move on to the offline repayment.\nIt is significantly easier, since we are simply notified that the money has been transferred to us.\nBecause of this, we can completely skip the Created state and go straight to Paid.\nWe need an event called OfflineRepaymentPaid which contains the same properties as OnlineRepaymentCreated:\n\npublic class OfflineRepaymentPaid : EventBase\n{\n    public string UserId { get; init; }\n    public string RepaymentId { get; init; }\n    public string PaymentId { get; init; }\n}\n\n\nLet’s use it in the fourth transition that will once again call the registration command:\n\n// 4. NotStarted : OfflineRepaymentPaid -\u003e Paid\nstateMachine\n    .FromState\u003cNotStarted\u003e()\n    .When\u003cOfflineRepaymentPaid\u003e()\n    .ToState\u003cPaid\u003e((from, @event) =\u003e new Paid(from)\n    {\n        UserId = @event.UserId,\n        RepaymentId = @event.RepaymentId,\n        PaymentId = @event.PaymentId\n    })\n    .RunCommand((from, @event, to) =\u003e new RegisterPaymentCommand(@event.PaymentId));\n\n\nThis is where both repayment types merge and we can focus on our bookkeeping system.\nAs mentioned before, we are mostly interested in registration events published by the bookkeeping system.\n\npublic class PaymentRegistered : EventBase\n{\n    public string PaymentId { get; init; }\n}\n\n\nOnce we know that a payment is registered in our bookkeeping system, we are able to send an email to the user\nsummarizing what they paid for and follow-up information whether they still have more payments to be made.\nThis can be done with a transition like this:\n\n// 5. Paid : PaymentRegistered -\u003e Registered\nstateMachine\n    .FromState\u003cPaid\u003e()\n    .When\u003cPaymentRegistered\u003e()\n    .ToState\u003cRegistered\u003e((from, @event) =\u003e new Registered(from))\n    .RunCommand((from, @event, to) =\u003e new SendRepaymentRegisteredEmailCommand(to.UserId, to.RepaymentId));\n\n\nAgain, SendRepaymentRegisteredEmailCommand is a simple class wrapping two properties that will be interpreted by the\ncommand runner and result in an email sent to the user.\nThe last step is to wait for the final event PaymentCompleted.\nTheoretically it could be omitted in this state machine, but it’s useful for auditing purposes.\n\npublic class PaymentCompleted : EventBase\n{\n    public string PaymentId { get; init; }\n}\n\n\nIt’s time to create the final transition:\n\n// 6. Registered : PaymentCompleted -\u003e Completed\nstateMachine\n    .FromState\u003cRegistered\u003e()\n    .When\u003cPaymentCompleted\u003e()\n    .ToState\u003cCompleted\u003e((from, @event) =\u003e new Completed(from));\n\n\nAnd we’re done!\nRight?\nNot really.\nAs is usually the case with event-sourced systems, the order of incoming events can’t always be relied on.\nThe bookkeeping system will sometimes — for reasons I don’t want to delve into — publish events PaymentRegistered and\nPaymentCompleted at the same time.\nDue to a lack of message ordering guarantees, it’s possible for us to receive PaymentCompleted event before\nPaymentRegistered.\nThe current definition of the state machine is not prepared for that.\nFortunately, the fix is quite easy, as we can simply introduce two more transitions:\n\n// 7. Paid : PaymentCompleted -\u003e Completed\nstateMachine\n    .FromState\u003cPaid\u003e()\n    .When\u003cPaymentCompleted\u003e()\n    .ToState\u003cCompleted\u003e((from, @event) =\u003e new Completed(from));\n\n// 8. Completed : PaymentRegistered -\u003e Completed\nstateMachine\n    .FromState\u003cCompleted\u003e()\n    .When\u003cPaymentRegistered\u003e()\n    .ToState\u003cCompleted\u003e((from, @event) =\u003e new Completed(from))\n    .RunCommand((from, @event, to) =\u003e new SendRepaymentRegisteredEmailCommand(to.UserId, to.RepaymentId));\n\n\nIn this scenario we completely skip Registered state, but that’s something we just have to deal with.\nEvents are important from analytics and diagnostics standpoints, states — not so much.\nThat wraps up the event flow for this scenario.\nIt can be visualized with a diagram like this:\n\nOur state machine framework is equipped with a pretty useful visualisation extension.\nIt’s a pretty neat tool that makes it easy to figure out how the state machine works, without having to delve into the\ncode.\nA simple unit test that calls this extension can render a state machine diagram like one above using PlantUML\nsyntax, which in this case would go as follows:\n\n@startuml\nhide empty description\n[*] --\u003e NotStarted\nNotStarted --\u003e Created: \u003cb\u003eOnlineRepaymentCreated\u003c/b\u003e\nCreated --\u003e Paid: \u003cb\u003eOnlineRepaymentPaid\u003c/b\u003e\\n\u003ci\u003ethen:\u003c/i\u003e RegisterPaymentCommand\nCreated --\u003e Failed: \u003cb\u003eOnlineRepaymentFailed\u003c/b\u003e\nNotStarted --\u003e Paid: \u003cb\u003eOfflineRepaymentPaid\u003c/b\u003e\\n\u003ci\u003ethen:\u003c/i\u003e RegisterPaymentCommand\nPaid --\u003e Registered: \u003cb\u003ePaymentRegistered\u003c/b\u003e\\n\u003ci\u003ethen:\u003c/i\u003e SendRepaymentRegisteredEmailCommand\nRegistered --\u003e Completed: \u003cb\u003ePaymentCompleted\u003c/b\u003e\nPaid --\u003e Completed: \u003cb\u003ePaymentCompleted\u003c/b\u003e\nCompleted --\u003e Completed: \u003cb\u003ePaymentRegistered\u003c/b\u003e\\n\u003ci\u003ethen:\u003c/i\u003e SendRepaymentRegisteredEmailCommand\n@enduml\n\n\nHowever, recall that this is just a state machine to handle a repayment for a single payment selected by the user.\nI promised we would extend it to handle multiple payments.\nLet’s do that.\nFirst we’ll extend the base state definition:\n\npublic abstract class StateBase\n{\n    public string UserId { get; init; }\n    public string RepaymentId { get; init; }\n    public HashSet\u003cstring\u003e PaymentIds { get; init; }\n    public HashSet\u003cstring\u003e RegisteredPaymentIds { get; init; }\n    public HashSet\u003cstring\u003e CompletedPaymentIds { get; init; }\n\n    public StateBase(StateBase other)\n    {\n        if (other == null) return;\n\n        UserId = other.UserId;\n        RepaymentId = other.RepaymentId;\n        PaymentIds = new HashSet\u003cstring\u003e(other.PaymentIds);\n        RegisteredPaymentIds = new HashSet\u003cstring\u003e(other.RegisteredPaymentIds);\n        CompletedPaymentIds = new HashSet\u003cstring\u003e(other.CompletedPaymentIds);\n    }\n}\n\n\nThree things have changed:\nPaymentId changed from a string to a HashSet\u003cstring\u003e and is now called PaymentIds to represent multiple\npayments selected by the user,\na HashSet\u003cstring\u003e called RegisteredPaymentIds was added to keep track of registered payments,\na HashSet\u003cstring\u003e called CompletedPaymentIds was added to keep track of completed payments.\nWe also have to modify OnlineRepaymentCreated event by introducing a collection of payment identifiers, like so:\n\npublic class OnlineRepaymentCreated : EventBase\n{\n    public string UserId { get; init; }\n    public string RepaymentId { get; init; }\n    public IEnumerable\u003cstring\u003e PaymentIds { get; init; }\n}\n\n\nBecause of this, we need to introduce a small change to transition no. 1:\n\n// 1'. NotStarted : OnlineRepaymentCreated -\u003e Created\nstateMachine\n    .FromState\u003cNotStarted\u003e()\n    .When\u003cOnlineRepaymentCreated\u003e()\n    .ToState\u003cCreated\u003e((from, @event) =\u003e new Created(from)\n    {\n        UserId = @event.UserId,\n        RepaymentId = @event.RepaymentId,\n        PaymentIds = new HashSet\u003cstring\u003e(@event.PaymentIds)\n    });\n\n\nTransition no. 2 is similarly adjusted to these changes by passing the set of payment identifiers to the\nbookkeeping system:\n\n(from, @event, to) =\u003e new RegisterPaymentsCommand(to.PaymentIds)\n\n\nNow we can move to the remaining transitions.\nTransition no. 5 has to be split into two.\nWe want to stay in the Paid state until all registration events are received and only then switch to Registered.\nThis can be achieved with:\n\n// 5'. Paid : PaymentRegistered -\u003e Paid\nstateMachine\n    .FromState\u003cPaid\u003e()\n    .When\u003cPaymentRegistered\u003e((from, @event) =\u003e !from.PaymentIds.All(\n        id =\u003e from.RegisteredPaymentIds.Contains(id) || id == @event.PaymentId))\n    .ToState\u003cPaid\u003e((from, @event) =\u003e\n    {\n        var to = new Paid(from);\n        to.RegisteredPaymentIds.Add(@event.PaymentId);\n        return to;\n    });\n\n// 5''. Paid : PaymentRegistered -\u003e Registered\nstateMachine\n    .FromState\u003cPaid\u003e()\n    .When\u003cPaymentRegistered\u003e((from, @event) =\u003e from.PaymentIds.All(\n        id =\u003e from.RegisteredPaymentIds.Contains(id) || id == @event.PaymentId))\n    .ToState\u003cRegistered\u003e((from, @event) =\u003e\n    {\n        var to = new Registered(from);\n        to.RegisteredPaymentIds.Add(@event.PaymentId);\n        return to;\n    });\n    .RunCommand((from, @event, to) =\u003e new SendRepaymentRegisteredEmailCommand(to.UserId, to.RepaymentId));\n\n\nAs you can see, the command is now defined only for the second transition that triggers after all payments are\nregistered.\nWe have to slightly adjust transition no. 8, which is responsible for sending the email, too:\n\n// 8'. Completed : PaymentRegistered -\u003e Completed\nstateMachine\n    .FromState\u003cCompleted\u003e()\n    .When\u003cPaymentRegistered\u003e()\n    .ToState\u003cCompleted\u003e((from, @event) =\u003e\n    {\n        var to = new Completed(from);\n        to.RegisteredPaymentIds.Add(@event.PaymentId);\n        return to;\n    })\n    .RunCommand(\n        when: (from, @event, to) =\u003e to.PaymentIds.SetEquals(to.RegisteredPaymentIds),\n        then: (from, @event, to) =\u003e new SendRepaymentRegisteredEmailCommand(to.UserId, to.RepaymentId));\n\n\nThis time the transition is not conditional, however the command is.\nIt will execute only after we handle final registration event and the payment identifier sets PaymentIds and\nRegisteredPaymentIds become equal.\nWe cannot forget about all transitions that are triggered by PaymentCompleted event.\nThose will have to be changed like so:\n\n// 6'. Registered : PaymentCompleted -\u003e Registered\nstateMachine\n    .FromState\u003cRegistered\u003e()\n    .When\u003cPaymentCompleted\u003e((from, @event) =\u003e !from.PaymentIds.All(\n        id =\u003e from.CompletedPaymentIds.Contains(id) || id == @event.PaymentId))\n    .ToState\u003cRegistered\u003e((from, @event) =\u003e\n    {\n        var to = new Registered(from);\n        to.CompletedPaymentIds.Add(@event.PaymentId);\n        return to;\n    });\n\n// 6''. Registered : PaymentCompleted -\u003e Completed\nstateMachine\n    .FromState\u003cRegistered\u003e()\n    .When\u003cPaymentCompleted\u003e((from, @event) =\u003e from.PaymentIds.All(\n        id =\u003e from.CompletedPaymentIds.Contains(id) || id == @event.PaymentId))\n    .ToState\u003cCompleted\u003e((from, @event) =\u003e\n    {\n        var to = new Completed(from);\n        to.CompletedPaymentIds.Add(@event.PaymentId);\n        return to;\n    });\n\n// 7'. Paid : PaymentCompleted -\u003e Paid\nstateMachine\n    .FromState\u003cPaid\u003e()\n    .When\u003cPaymentCompleted\u003e((from, @event) =\u003e !from.PaymentIds.All(\n        id =\u003e from.CompletedPaymentIds.Contains(id) || id == @event.PaymentId))\n    .ToState\u003cCompleted\u003e((from, @event) =\u003e\n    {\n        var to = new Completed(from);\n        to.CompletedPaymentIds.Add(@event.PaymentId);\n        return to;\n    });\n\n// 7''. Paid : PaymentCompleted -\u003e Completed\nstateMachine\n    .FromState\u003cPaid\u003e()\n    .When\u003cPaymentCompleted\u003e((from, @event) =\u003e from.PaymentIds.All(\n        id =\u003e from.CompletedPaymentIds.Contains(id) || id == @event.PaymentId))\n    .ToState\u003cCompleted\u003e((from, @event) =\u003e\n    {\n        var to = new Completed(from);\n        to.CompletedPaymentIds.Add(@event.PaymentId);\n        return to;\n    });\n\n\nAnd we’re done!\nThis time for real.\nAfter all this work we ended up with something that can be visualized with a diagram like this:\n\nI mentioned earlier that we have internal back-office tools to view state machines and their transition history.\nHere is an example view of a repayment process that was coordinated with the state machine we defined above (sensitive\ndata was redacted, since this was taken in production):\n\nCaveats\nYou may have noticed some problems here.\nWhat would happen if we received an event with a wrong payment identifier?\nRight now the state machine is not ready for that.\nHowever, that can be remedied relatively easily by adding another condition to When methods of all transitions for\nPaymentRegistered and PaymentCompleted events, such as:\n\n.When((from, @event) =\u003e from.PaymentIds.Contains(@event.PaymentId) \u0026\u0026 /* ... */)\n\n\nThis would essentialy ensure that we react only to events with correct identifiers.\nAnd what about retries and duplicated events?\nTransition no. 8’ is especially susceptible to that, because it may result in the email being sent to the user twice.\nAnd we don’t want that!\nFortunately, achieving deduplication is just as easy — we have to ignore events for payments that are already\nregistered:\n\n.When((from, @event) =\u003e !from.RegisteredPaymentIds.Contains(@event.PaymentId) \u0026\u0026 /* ... */)\n\n\nFor the sake of readability I also decided to skip a lot of other validations, which would otherwise have to be there,\nsuch as simple null checks.\nHow to test\nTesting state machines is important, because, well, ideally all code should be tested.\nIn this case, apart from the usual assurance that we are able to handle both happy paths and edge cases, we can also\nensure that we keep the transitions backwards compatible.\nAn event that is once inserted into the stream will stay there forever.\nWe developed a simple DSL in F# to help us test state machines created with our framework.\nThis is a perfect solution to test a declarative definition of a state machine like the one we developed in this post.\nHere’s an example of a happy path test for our state machine:\n\n[\u003cFact\u003e]\nlet ``Online repayment - single payment happy path`` () =\n    [\n        When(Events.OnlineRepaymentCreated (\"paymentId1\"))\n            |\u003e GoToState\u003cCreated\u003e\n            |\u003e DoNothing\n        When(Events.OnlineRepaymentPaid ())\n            |\u003e GoToState\u003cPaid\u003e\n            |\u003e Do\u003cRegisterPaymentsCommand\u003e\n        When(Events.PaymentRegistered (\"paymentId1\"))\n            |\u003e GoToState\u003cRegistered\u003e\n            |\u003e Do\u003cSendRepaymentRegisteredEmailCommand\u003e\n        When(Events.PaymentCompleted (\"paymentId1\"))\n            |\u003e GoToState\u003cCompleted\u003e\n            |\u003e DoNothing\n    ]\n    |\u003e apply\n\n\nA test like this is essentially a list of events with expected side effects that are then aggregated using the apply\nfunction that feeds them one by one into the state machine and verifies the outcome.\nSummary\nI hope I was able to convince you how a framework like this can make designing complex state machines easy.\nIt provides numerous advantages, such as declarative syntax, effortless testability, thorough instrumentation and\nvisualization.\nThis is precisely why state machines became an integral part of pretty much every business process architecture\nin our project.\nHaving such a robust and scalable solution for asynchronous process orchestration and isolation is crucial in\ndistributed systems.\nThe presented code, albeit extremely simplified, is from an actual state machine — one of many used in our\napplications.\nWhile the presented solution is a strictly internal framework right now, who knows what the future might bring?\nStay tuned!","guid":"https://blog.allegro.tech/2021/03/state-machines-made-easy.html","categories":["tech","dotnet","state_machine","allegro_pay"],"isoDate":"2021-03-04T23:00:00.000Z","thumbnail":"images/post-headers/default.jpg"},{"title":"My first days at Allegro","link":"https://blog.allegro.tech/2021/02/first-days-at-allegro.html","pubDate":"Mon, 15 Feb 2021 00:00:00 +0100","authors":{"author":[{"name":["Krzysztof Przychodzki"],"photo":["https://blog.allegro.tech/img/authors/krzysztof.przychodzki.jpg"],"url":["https://blog.allegro.tech/authors/krzysztof.przychodzki"]}]},"content":"\u003cp\u003eSo you’re new to \u003ca href=\"https://blog.allegro.tech/about-us/\"\u003eAllegro\u003c/a\u003e, have just finished your tech onboarding and are stunned with information overflow? Or perhaps you\nare planning to join Allegro and don’t know what it looks like in here? I am about to try and describe how I felt just a few months ago and what startled or\ndismayed me. I hope this short article will answer all your concerns.\u003c/p\u003e\n\n\u003cp\u003eBut first I would like to give you a little background of my professional work life.\u003c/p\u003e\n\n\u003ch2 id=\"background\"\u003eBackground\u003c/h2\u003e\n\n\u003cp\u003eLong before becoming a developer, I was a chemical engineer, and I was designing distilleries, cosmetic and oil refinery plants, etc. During my work, I often\nused Microsoft Excel and VBA as my main apps for solving complex problems. I enjoyed it more than the job I was assigned. So I decided to take a Java bootcamp\nand afterwards I got hired by an IT company in my area. At my first IT job, I was hired as a junior, but I was already treated as a regular programmer.\nIt was nice, I owe them a lot, but on the other hand the only feedback I got was when something was not working. From the beginning, I was fully aware of how\nbasic my knowledge was after the bootcamp. While catching up I realized that at this company I would not develop anymore, and I would be working with legacy\ntechnologies throughout the rest of my career.\u003c/p\u003e\n\n\u003ch2 id=\"a-piece-of-cake\"\u003eA piece of cake?\u003c/h2\u003e\n\n\u003cp\u003eThe recruitment process at Allegro — let me tell you straight, is not a piece of cake. I am pretty sure that a year after the recruitment meeting you are\nstill going to remember the questions you were torpedoed with.\u003c/p\u003e\n\n\u003cp\u003eFirst of all — after applying, you will receive an email with all the necessary information about the recruitment process. Each step is briefly\ncharacterized, so you know what is going to happen next and what to expect. The first step is a task on DevSkiller. Then, you will take part in technical\ninterviews in the form of conversation about the technologies and architecture of modern IT systems, touching on aspects of design, performance, monitoring, etc.\nIt was very different from the previous recruitment processes in which I sometimes spoke to people who had no clue what I was talking about. At Allegro I really\nappreciate that these meetings are with real professionals! What is more, during my recruitments I have never encountered such a human approach. They treat you\nlike a human, not like a robot. That’s cool. In the last step you will meet with a team leader and people from HR.\u003c/p\u003e\n\n\u003ch2 id=\"first-days\"\u003eFirst days\u003c/h2\u003e\n\n\u003cp\u003eMy first days at Allegro — what a rollercoaster, considering the current coronavirus situation. Onboarding normally takes 3 days and is conducted at the\ncompany’s headquarters in Poznań. There is another two-day long technical onboarding for technical employees at the workplace. However, due to the COVID-19\nsituation, the entire onboarding process was carried out remotely. This tech onboarding is conducted with a workshop on how to create a new service and\neverything that goes with it like deploying, running and maintaining. I understood why (this was not possible remotely), but it is a pity that it did not take\nplace. Fortunately, everybody wants to help you with any issue you have — and this is the great power of Allegro: people and their readiness to help.\nIt is natural for everyone that a new person needs support and time to get to know the organization. Moreover, if you are a junior like me, and have never\nwritten a line of code for example in Kotlin, you can spend some time learning a new programming language and everybody is okay with that.\u003c/p\u003e\n\n\u003cp\u003eSomeone might ask: What is difficult in the beginning? That depends, because everything is new. I work in a team responsible for Allegro Smart! loyalty\nprogramme — ensuring proper marking of offers qualified for free delivery — so the most confusing thing for me was the business complexity of those\nprocesses.\u003c/p\u003e\n\n\u003cp\u003eNevertheless, there are over 1200 microservices communicating with each other — a status quo you have to deal with. Thousands of decisions were made and\na lot of them don’t sound reasonable when you first hear about them, but after a day passes, everything starts to clarify. I think this is what everyone deals\nwith when they come to a new place.\u003c/p\u003e\n\n\u003ch2 id=\"somebody-is-reading-my-code\"\u003eSomebody is reading my code\u003c/h2\u003e\n\n\u003cp\u003eOne of my favorite things at Allegro is code review. Virtually nothing gets merged unless it is reviewed and approved. Code review is mandatory and necessary\n— reading others’ code is not only about finding bugs, it is mainly to provide code that is clear, understandable, and maintainable. For me, it is mainly\nfor learning and better understanding our services and business domain.\u003c/p\u003e\n\n\u003cp\u003eAnother great thing is pair programming. During these sessions it is easier to understand the business domain and to catch the wider context of our services.\u003c/p\u003e\n\n\u003ch2 id=\"unit-integration-and-end-to-end-testing\"\u003eUnit, integration, and end-to-end testing\u003c/h2\u003e\n\n\u003cp\u003eAs I wrote, unreviewed code will not be deployed to production and without tests it is not going to pass the review. At Allegro, each change in code needs\nto be tested. We write unit and integration tests, and we work with two test environments.\u003c/p\u003e\n\n\u003cp\u003eOne is totally a developer’s playground where you make your ‘little Allegro’. It is called phoenix. Every team has its own phoenix env for\nexperiments. However, it has some issues. Since there are so many dependencies to other services, your already set up environment may not work properly until it\nis manually updated. So a very common situation is that before you start testing your change, you need to spend some time to get the whole environment working.\nThis is frustrating, especially in the beginning.\u003c/p\u003e\n\n\u003cp\u003eThe second one is a pre-prod sandbox — it is like normal Allegro, but unlike the dev environment, the sandbox is more consistent and works almost like\nprod. So there are a lot of possibilities to test your change and it’s good to have this feeling of confidence.\u003c/p\u003e\n\n\u003cp\u003eSometimes despite all these tests, code reviews, etc. a mistake happens — the app is already deployed to production, and our clients are complaining.\nWe have to act quickly to fix the error. I really appreciate that we look for bugs, not the guilty party. When somebody makes a mistake, we don’t blame each\nother, but we look for the best solution to the problem and fix it.\u003c/p\u003e\n\n\u003ch2 id=\"hack-the-day\"\u003eHack the day\u003c/h2\u003e\n\n\u003cp\u003eSometimes teams do internal hackathons (called fedex-days) — we divide into two or three teams and we work on subjects that we choose. We want\nto try a new programming language — we just do it; make an application for sharing memes — perfectly fine; write an extension for Slack — why\nnot, go have some fun! Usually, we spend two working days getting off work. That’s very refreshing.\u003c/p\u003e\n\n\u003cp\u003eI also know that once in a while there are hackathons for the whole Allegro — but I didn’t have a chance to participate.\u003c/p\u003e\n\n\u003ch2 id=\"dobrze-tu-być\"\u003eDobrze tu być?\u003c/h2\u003e\n\n\u003cp\u003eAt Allegro we all understand the great importance of ensuring the code we are working on is of the highest quality. We care about our services to the point\nwhere we sometimes spend hours discussing if it is better to throw an exception or just 404?\u003c/p\u003e\n\n\u003cp\u003eHowever, Allegro is not only about programming, it is a place with a lot of experts in many other disciplines — and every one of us has a straightforward\ngoal to make Allegro the best place/platform not only for shoppers and sellers, but also for each other.\u003c/p\u003e\n\n\u003cp\u003eHope you enjoyed this article. I know it sounds like a chorus of praise, but in my situation it arises from my work experiences — for me, it is really a\n“Good to be here!” place. Or as we say \u003ca href=\"https://www.linkedin.com/company/allegro-pl/life/team\"\u003e#dobrzetubyć\u003c/a\u003e.\u003c/p\u003e\n","contentSnippet":"So you’re new to Allegro, have just finished your tech onboarding and are stunned with information overflow? Or perhaps you\nare planning to join Allegro and don’t know what it looks like in here? I am about to try and describe how I felt just a few months ago and what startled or\ndismayed me. I hope this short article will answer all your concerns.\nBut first I would like to give you a little background of my professional work life.\nBackground\nLong before becoming a developer, I was a chemical engineer, and I was designing distilleries, cosmetic and oil refinery plants, etc. During my work, I often\nused Microsoft Excel and VBA as my main apps for solving complex problems. I enjoyed it more than the job I was assigned. So I decided to take a Java bootcamp\nand afterwards I got hired by an IT company in my area. At my first IT job, I was hired as a junior, but I was already treated as a regular programmer.\nIt was nice, I owe them a lot, but on the other hand the only feedback I got was when something was not working. From the beginning, I was fully aware of how\nbasic my knowledge was after the bootcamp. While catching up I realized that at this company I would not develop anymore, and I would be working with legacy\ntechnologies throughout the rest of my career.\nA piece of cake?\nThe recruitment process at Allegro — let me tell you straight, is not a piece of cake. I am pretty sure that a year after the recruitment meeting you are\nstill going to remember the questions you were torpedoed with.\nFirst of all — after applying, you will receive an email with all the necessary information about the recruitment process. Each step is briefly\ncharacterized, so you know what is going to happen next and what to expect. The first step is a task on DevSkiller. Then, you will take part in technical\ninterviews in the form of conversation about the technologies and architecture of modern IT systems, touching on aspects of design, performance, monitoring, etc.\nIt was very different from the previous recruitment processes in which I sometimes spoke to people who had no clue what I was talking about. At Allegro I really\nappreciate that these meetings are with real professionals! What is more, during my recruitments I have never encountered such a human approach. They treat you\nlike a human, not like a robot. That’s cool. In the last step you will meet with a team leader and people from HR.\nFirst days\nMy first days at Allegro — what a rollercoaster, considering the current coronavirus situation. Onboarding normally takes 3 days and is conducted at the\ncompany’s headquarters in Poznań. There is another two-day long technical onboarding for technical employees at the workplace. However, due to the COVID-19\nsituation, the entire onboarding process was carried out remotely. This tech onboarding is conducted with a workshop on how to create a new service and\neverything that goes with it like deploying, running and maintaining. I understood why (this was not possible remotely), but it is a pity that it did not take\nplace. Fortunately, everybody wants to help you with any issue you have — and this is the great power of Allegro: people and their readiness to help.\nIt is natural for everyone that a new person needs support and time to get to know the organization. Moreover, if you are a junior like me, and have never\nwritten a line of code for example in Kotlin, you can spend some time learning a new programming language and everybody is okay with that.\nSomeone might ask: What is difficult in the beginning? That depends, because everything is new. I work in a team responsible for Allegro Smart! loyalty\nprogramme — ensuring proper marking of offers qualified for free delivery — so the most confusing thing for me was the business complexity of those\nprocesses.\nNevertheless, there are over 1200 microservices communicating with each other — a status quo you have to deal with. Thousands of decisions were made and\na lot of them don’t sound reasonable when you first hear about them, but after a day passes, everything starts to clarify. I think this is what everyone deals\nwith when they come to a new place.\nSomebody is reading my code\nOne of my favorite things at Allegro is code review. Virtually nothing gets merged unless it is reviewed and approved. Code review is mandatory and necessary\n— reading others’ code is not only about finding bugs, it is mainly to provide code that is clear, understandable, and maintainable. For me, it is mainly\nfor learning and better understanding our services and business domain.\nAnother great thing is pair programming. During these sessions it is easier to understand the business domain and to catch the wider context of our services.\nUnit, integration, and end-to-end testing\nAs I wrote, unreviewed code will not be deployed to production and without tests it is not going to pass the review. At Allegro, each change in code needs\nto be tested. We write unit and integration tests, and we work with two test environments.\nOne is totally a developer’s playground where you make your ‘little Allegro’. It is called phoenix. Every team has its own phoenix env for\nexperiments. However, it has some issues. Since there are so many dependencies to other services, your already set up environment may not work properly until it\nis manually updated. So a very common situation is that before you start testing your change, you need to spend some time to get the whole environment working.\nThis is frustrating, especially in the beginning.\nThe second one is a pre-prod sandbox — it is like normal Allegro, but unlike the dev environment, the sandbox is more consistent and works almost like\nprod. So there are a lot of possibilities to test your change and it’s good to have this feeling of confidence.\nSometimes despite all these tests, code reviews, etc. a mistake happens — the app is already deployed to production, and our clients are complaining.\nWe have to act quickly to fix the error. I really appreciate that we look for bugs, not the guilty party. When somebody makes a mistake, we don’t blame each\nother, but we look for the best solution to the problem and fix it.\nHack the day\nSometimes teams do internal hackathons (called fedex-days) — we divide into two or three teams and we work on subjects that we choose. We want\nto try a new programming language — we just do it; make an application for sharing memes — perfectly fine; write an extension for Slack — why\nnot, go have some fun! Usually, we spend two working days getting off work. That’s very refreshing.\nI also know that once in a while there are hackathons for the whole Allegro — but I didn’t have a chance to participate.\nDobrze tu być?\nAt Allegro we all understand the great importance of ensuring the code we are working on is of the highest quality. We care about our services to the point\nwhere we sometimes spend hours discussing if it is better to throw an exception or just 404?\nHowever, Allegro is not only about programming, it is a place with a lot of experts in many other disciplines — and every one of us has a straightforward\ngoal to make Allegro the best place/platform not only for shoppers and sellers, but also for each other.\nHope you enjoyed this article. I know it sounds like a chorus of praise, but in my situation it arises from my work experiences — for me, it is really a\n“Good to be here!” place. Or as we say #dobrzetubyć.","guid":"https://blog.allegro.tech/2021/02/first-days-at-allegro.html","categories":["tech"],"isoDate":"2021-02-14T23:00:00.000Z","thumbnail":"images/post-headers/default.jpg"}],"jobs":[{"id":"743999744024026","name":"Database Engineer","uuid":"9d3a82fc-d9ef-48b3-ba39-641a1ac2d178","refNumber":"REF2698R","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-04-23T15:33:35.000Z","location":{"city":"Poznań, Warszawa, Toruń","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"2216093","label":"Development"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"2216093","valueLabel":"Development"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"administrator administracja bazy danych"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999744024026","creator":{"name":"Adriana Gesiarz"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999743961962","name":"UX Researcher","uuid":"939a857c-a358-402b-b66c-632c5227555a","refNumber":"REF2286W","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-04-23T09:59:41.000Z","location":{"city":"Warszawa, Poznań, Kraków, Toruń","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"1013462","label":"Technology - Product Development"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c1575ee4b01d4b19ddf797","fieldLabel":"Kraków","valueId":"2cfcfcc1-da44-43f7-8eaa-3907faf2797c","valueLabel":"Tak"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c1576ee4b0614667d59732","fieldLabel":"Toruń","valueId":"987e8884-bad1-4a8f-b149-99e4184cc221","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c15788e4b0614667d59733","fieldLabel":"Błonie","valueId":"25f6cb8c-81b3-434a-93ec-6dc851d5808d","valueLabel":"Nie"},{"fieldId":"58c15798e4b01d4b19ddf79b","fieldLabel":"Wrocław","valueId":"31873284-1e97-427d-8918-6ce504344351","valueLabel":"Nie"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"1013462","valueLabel":"Technology - Product Development"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999743961962","creator":{"name":"Martyna Maziarska"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999743960660","name":"Front-End Software Engineer","uuid":"2f78a5ed-bd30-4747-945c-800aec037db5","refNumber":"REF2753K","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-04-23T09:48:37.000Z","location":{"city":"Poznań, Warszawa","region":"Greater Poland Voivodeship","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"1013275","label":"IT Business Services"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"1013275","valueLabel":"IT Business Services"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999743960660","creator":{"name":"Paulina Tynecka"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999743853021","name":"Team Leader - DAX","uuid":"b675e247-7935-45bf-b0ce-0fbd607ac3d5","refNumber":"REF2754A","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-04-22T16:35:22.000Z","location":{"city":"Warszawa, Poznań, Kraków, Toruń","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"1013462","label":"Technology - Product Development"},"function":{"id":"engineering","label":"Engineering"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"1013462","valueLabel":"Technology - Product Development"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999743853021","creator":{"name":"Paulina Partyka"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}},{"id":"743999743641840","name":"Business Application Administrator (Cognos)","uuid":"055bdf55-3043-4e01-8d48-2e8fcb8d459f","refNumber":"REF2689W","company":{"identifier":"Allegro","name":"Allegro"},"releasedDate":"2021-04-21T13:22:49.000Z","location":{"city":"Poznań, Warszawa","country":"pl","remote":false},"industry":{"id":"internet","label":"Internet"},"department":{"id":"1013275","label":"IT Business Services"},"function":{"id":"information_technology","label":"Information Technology"},"typeOfEmployment":{"label":"Full-time"},"experienceLevel":{"id":"mid_senior_level","label":"Mid-Senior Level"},"customField":[{"fieldId":"58c15608e4b01d4b19ddf790","fieldLabel":"Proces rekrutacji","valueId":"c807eec2-8a53-4b55-b7c5-c03180f2059b","valueLabel":"IT Allegro"},{"fieldId":"COUNTRY","fieldLabel":"Country","valueId":"pl","valueLabel":"Poland"},{"fieldId":"58c13159e4b01d4b19ddf729","fieldLabel":"Department","valueId":"1013275","valueLabel":"IT Business Services"},{"fieldId":"58c158e9e4b0614667d5973e","fieldLabel":"Więcej lokalizacji","valueId":"3a186e8d-a82c-4955-af81-fcef9a63928a","valueLabel":"Tak"},{"fieldId":"58c13159e4b01d4b19ddf728","fieldLabel":"Brands","valueId":"4ccb4fab-6c3f-4ed0-9140-8533fe17447f","valueLabel":"Allegro.pl sp. z o.o."},{"fieldId":"58c156b9e4b01d4b19ddf792","fieldLabel":"Poznań","valueId":"ac20917b-cb6a-4280-aff3-4fae2532a33e","valueLabel":"Tak"},{"fieldId":"58c156e6e4b01d4b19ddf793","fieldLabel":"Warszawa","valueId":"6a428533-1586-4372-89ec-65fb45366363","valueLabel":"Tak"},{"fieldId":"5cdab2c84cedfd0006e7758c","fieldLabel":"Key words","valueLabel":"Cognos"}],"ref":"https://api.smartrecruiters.com/v1/companies/allegro/postings/743999743641840","creator":{"name":"Paulina Tynecka"},"language":{"code":"pl","label":"Polish","labelNative":"polski"}}],"events":[{"created":1618821709000,"duration":7200000,"id":"277660388","name":"Allegro Tech Labs #8 Online: Praktyczne prognozowanie w Allegro ","date_in_series_pattern":false,"status":"upcoming","time":1620316800000,"local_date":"2021-05-06","local_time":"18:00","updated":1618821709000,"utc_offset":7200000,"waitlist_count":0,"yes_rsvp_count":25,"venue":{"id":26906060,"name":"Online event","repinned":false,"country":"","localized_country_name":""},"is_online_event":true,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/277660388/","description":"***REJESTRACJA***Ze względu na ograniczoną liczbę miejsc, prosimy o rejestrację na wydarzenie poprzez stronę: https://app.evenea.pl/event/allegro-tech-labs-8/Wybierając przycisk \"Chcę wziąć udział w warsztatach\" przeniesiesz się na formularz rejestracyjny…","visibility":"public","member_pay_fee":false},{"created":1617359547000,"duration":9000000,"id":"277320825","name":"Allegro Tech Live #17 - iOS pod maską","date_in_series_pattern":false,"status":"past","time":1618502400000,"local_date":"2021-04-15","local_time":"18:00","updated":1618516317000,"utc_offset":7200000,"waitlist_count":0,"yes_rsvp_count":61,"venue":{"id":26906060,"name":"Online event","repinned":false,"country":"","localized_country_name":""},"is_online_event":true,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/277320825/","description":"Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale tym razem to my…","how_to_find_us":"https://youtu.be/Ra5T7MbUXW0","visibility":"public","member_pay_fee":false},{"created":1616053977000,"duration":7200000,"id":"277005370","name":"Allegro Tech Labs #7 Online: System design workshop","rsvp_limit":60,"date_in_series_pattern":false,"status":"past","time":1617811200000,"local_date":"2021-04-07","local_time":"18:00","updated":1617822969000,"utc_offset":7200000,"waitlist_count":0,"yes_rsvp_count":60,"venue":{"id":26906060,"name":"Online event","repinned":false,"country":"","localized_country_name":""},"is_online_event":true,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/277005370/","description":"***REJESTRACJA***Prosimy o rejestrację na wydarzenie poprzez stronę: https://app.evenea.pl/event/allegro-tech-labs-7/. Po kliknięciu przycisku \"Chcę wziąć udział w warsztatach\" przeniesiesz się na formularz rejestracyjny - prosimy o udzielenie…","visibility":"public","member_pay_fee":false},{"created":1615571910000,"duration":7200000,"id":"276893259","name":"#16 Allegro Tech Live - Jak dostać się do Allegro?","date_in_series_pattern":false,"status":"past","time":1617292800000,"local_date":"2021-04-01","local_time":"18:00","updated":1617303666000,"utc_offset":7200000,"waitlist_count":0,"yes_rsvp_count":171,"venue":{"id":26906060,"name":"Online event","repinned":false,"country":"","localized_country_name":""},"is_online_event":true,"group":{"created":1425052059000,"name":"allegro Tech","id":18465254,"join_mode":"open","lat":52.2599983215332,"lon":21.020000457763672,"urlname":"allegrotech","who":"Techs","localized_location":"Warsaw, Poland","state":"","country":"pl","region":"en_US","timezone":"Europe/Warsaw"},"link":"https://www.meetup.com/allegrotech/events/276893259/","description":"Allegro Tech Live to w 100% zdalna odsłona naszych stacjonarnych meetupów Allegro Tech Talks. Zazwyczaj spotykaliśmy się w naszych biurach, ale tym razem to my…","how_to_find_us":"https://youtu.be/qtvZm2RNoRc","visibility":"public","member_pay_fee":false}],"podcasts":[{"creator":{"name":["Michał Bareja"]},"title":"Inżynier w zespole produktowym","link":"https://podcast.allegro.tech/inzynier_w_zespole_produktowym","pubDate":"Thu, 22 Apr 2021 00:00:00 GMT","author":{"name":["Michał Bareja"]},"enclosure":{"url":"https://www.buzzsprout.com/887914/8371888.mp3","type":"audio/mpeg"},"content":"Czym zajmuje się Team Leader w Allegro? Jak wygląda cykl życia oprogramowania w zespole produktowym? Jaka jest rola inżyniera oprogramowania w rozwoju produktu? W jaki sposób wykorzystujemy w Allegro Event Storming? Jakich technologii używają programiści w zespołach produktowych? Między innymi o tym opowie Michał Bareja, Team Manager w Allegro, w rozmowie z Piotrem Betkierem.","contentSnippet":"Czym zajmuje się Team Leader w Allegro? Jak wygląda cykl życia oprogramowania w zespole produktowym? Jaka jest rola inżyniera oprogramowania w rozwoju produktu? W jaki sposób wykorzystujemy w Allegro Event Storming? Jakich technologii używają programiści w zespołach produktowych? Między innymi o tym opowie Michał Bareja, Team Manager w Allegro, w rozmowie z Piotrem Betkierem.","guid":"https://podcast.allegro.tech/inzynier_w_zespole_produktowym","isoDate":"2021-04-22T00:00:00.000Z","itunes":{"author":"Michał Bareja","summary":"Czym zajmuje się Team Leader w Allegro? Jak wygląda cykl życia oprogramowania w zespole produktowym? Jaka jest rola inżyniera oprogramowania w rozwoju produktu? W jaki sposób wykorzystujemy w Allegro Event Storming? Jakich technologii używają programiści w zespołach produktowych? Między innymi o tym opowie Michał Bareja, Team Manager w Allegro, w rozmowie z Piotrem Betkierem.","explicit":"false"}},{"creator":{"name":["Julia Bluszcz"]},"title":"Data Scientist w Allegro","link":"https://podcast.allegro.tech/data_scientist_w_allegro","pubDate":"Fri, 16 Apr 2021 00:00:00 GMT","author":{"name":["Julia Bluszcz"]},"enclosure":{"url":"https://www.buzzsprout.com/887914/8333231.mp3","type":"audio/mpeg"},"content":"Czym zajmuje się Data Scientist? Jak wygląda proces budowania modeli danych? Jak klasyczne i bayesowskie metody statystyczne pozwalają nam odpowiedzieć na pytanie “dlaczego”? Czym różni się korelacja od kauzacji i jak estymować efekty różnego rodzaju zmian, nawet gdy nie możemy przeprowadzić testów AB? Odpowiedzi na te pytania znajdziecie w najnowszym podcascie, którego gościem jest Julia Bluszcz.","contentSnippet":"Czym zajmuje się Data Scientist? Jak wygląda proces budowania modeli danych? Jak klasyczne i bayesowskie metody statystyczne pozwalają nam odpowiedzieć na pytanie “dlaczego”? Czym różni się korelacja od kauzacji i jak estymować efekty różnego rodzaju zmian, nawet gdy nie możemy przeprowadzić testów AB? Odpowiedzi na te pytania znajdziecie w najnowszym podcascie, którego gościem jest Julia Bluszcz.","guid":"https://podcast.allegro.tech/data_scientist_w_allegro","isoDate":"2021-04-16T00:00:00.000Z","itunes":{"author":"Julia Bluszcz","summary":"Czym zajmuje się Data Scientist? Jak wygląda proces budowania modeli danych? Jak klasyczne i bayesowskie metody statystyczne pozwalają nam odpowiedzieć na pytanie “dlaczego”? Czym różni się korelacja od kauzacji i jak estymować efekty różnego rodzaju zmian, nawet gdy nie możemy przeprowadzić testów AB? Odpowiedzi na te pytania znajdziecie w najnowszym podcascie, którego gościem jest Julia Bluszcz.","explicit":"false"}},{"creator":{"name":["Aleksandra Wasielewska"]},"title":"Świat Product Managera w Allegro","link":"https://podcast.allegro.tech/swiat_product_managera_w_allegro","pubDate":"Thu, 08 Apr 2021 00:00:00 GMT","author":{"name":["Aleksandra Wasielewska"]},"enclosure":{"url":"https://www.buzzsprout.com/887914/8163682.mp3","type":"audio/mpeg"},"content":"Jak tworzy się produkty dla milionów kupujących? Jak wygląda warsztat i ekosystem Product Managera w Allegro? Jak zaskakujące jest Allegro od środka? Jak mądrze wykorzystywać dane w pracy Product Managera? I jak w Allegro jeśli się chce, to można realizować się nie tylko jako pracownik, ale człowiek? Nie tylko to, ale też wiele wiele więcej w rozmowie z Piotrkiem, odkryje przed Wami Ola Wasielewska - Senior Product Manager w Allegro.","contentSnippet":"Jak tworzy się produkty dla milionów kupujących? Jak wygląda warsztat i ekosystem Product Managera w Allegro? Jak zaskakujące jest Allegro od środka? Jak mądrze wykorzystywać dane w pracy Product Managera? I jak w Allegro jeśli się chce, to można realizować się nie tylko jako pracownik, ale człowiek? Nie tylko to, ale też wiele wiele więcej w rozmowie z Piotrkiem, odkryje przed Wami Ola Wasielewska - Senior Product Manager w Allegro.","guid":"https://podcast.allegro.tech/swiat_product_managera_w_allegro","isoDate":"2021-04-08T00:00:00.000Z","itunes":{"author":"Aleksandra Wasielewska","summary":"Jak tworzy się produkty dla milionów kupujących? Jak wygląda warsztat i ekosystem Product Managera w Allegro? Jak zaskakujące jest Allegro od środka? Jak mądrze wykorzystywać dane w pracy Product Managera? I jak w Allegro jeśli się chce, to można realizować się nie tylko jako pracownik, ale człowiek? Nie tylko to, ale też wiele wiele więcej w rozmowie z Piotrkiem, odkryje przed Wami Ola Wasielewska - Senior Product Manager w Allegro.","explicit":"false"}},{"creator":{"name":["Jakub Kaczmarski"]},"title":"Logistyka na platformie Allegro","link":"https://podcast.allegro.tech/logistyka_na_platformie_allegro","pubDate":"Thu, 25 Mar 2021 00:00:00 GMT","author":{"name":["Jakub Kaczmarski"]},"enclosure":{"url":"https://www.buzzsprout.com/887914/8163669.mp3","type":"audio/mpeg"},"content":"Jak zarządzać zespołem ponad 100 osób? Jak rozwijać motywację, pasję i potencjał swoich pracowników? Na co zwracać uwagę? Jakie inspiracje można czerpać ze sportu w zarządzaniu? Jak zorganizować swoją pracę? O tym opowie Jakub Kaczmarski - Technology Director odpowiadając za obszar Delivery Experience i Allegro Smart! na platformie Allegro.","contentSnippet":"Jak zarządzać zespołem ponad 100 osób? Jak rozwijać motywację, pasję i potencjał swoich pracowników? Na co zwracać uwagę? Jakie inspiracje można czerpać ze sportu w zarządzaniu? Jak zorganizować swoją pracę? O tym opowie Jakub Kaczmarski - Technology Director odpowiadając za obszar Delivery Experience i Allegro Smart! na platformie Allegro.","guid":"https://podcast.allegro.tech/logistyka_na_platformie_allegro","isoDate":"2021-03-25T00:00:00.000Z","itunes":{"author":"Jakub Kaczmarski","summary":"Jak zarządzać zespołem ponad 100 osób? Jak rozwijać motywację, pasję i potencjał swoich pracowników? Na co zwracać uwagę? Jakie inspiracje można czerpać ze sportu w zarządzaniu? Jak zorganizować swoją pracę? O tym opowie Jakub Kaczmarski - Technology Director odpowiadając za obszar Delivery Experience i Allegro Smart! na platformie Allegro.","explicit":"false"}}]},"__N_SSG":true},"page":"/","query":{},"buildId":"VvQv-dEbC2isTFCYpeOKi","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-040103c5c51c5268569e.js"></script><script src="/_next/static/chunks/main-7da1b803342e313adbbe.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.d92cd1f5a85f231dd617.js" async=""></script><script src="/_next/static/chunks/b651a894a35ea1e7d121ee74b6c7e8aa31faf049.71d68ec00d361c7548dd.js" async=""></script><script src="/_next/static/chunks/6753331a3a54fd35bc7d92cbaee2b67e833d028a.41151956cb3ac59ffc26.js" async=""></script><script src="/_next/static/chunks/pages/_app-b8da8a2456a23c81c70b.js" async=""></script><script src="/_next/static/chunks/pages/index-95d218a9f8cafc4e6d3f.js" async=""></script><script src="/_next/static/VvQv-dEbC2isTFCYpeOKi/_buildManifest.js" async=""></script><script src="/_next/static/VvQv-dEbC2isTFCYpeOKi/_ssgManifest.js" async=""></script></body></html>